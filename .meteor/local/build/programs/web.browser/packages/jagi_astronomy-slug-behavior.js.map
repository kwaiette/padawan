{"version":3,"sources":["meteor://ðŸ’»app/packages/jagi:astronomy-slug-behavior/lib/main.js","meteor://ðŸ’»app/packages/jagi:astronomy-slug-behavior/lib/behavior/apply.js","meteor://ðŸ’»app/packages/jagi:astronomy-slug-behavior/lib/behavior/behavior.js","meteor://ðŸ’»app/packages/jagi:astronomy-slug-behavior/lib/behavior/check.js","meteor://ðŸ’»app/packages/jagi:astronomy-slug-behavior/lib/behavior/createClassDefinition.js","meteor://ðŸ’»app/packages/jagi:astronomy-slug-behavior/lib/behavior/diacriticsMap.js","meteor://ðŸ’»app/packages/jagi:astronomy-slug-behavior/lib/behavior/generateSlug.js","meteor://ðŸ’»app/packages/jagi:astronomy-slug-behavior/lib/class_events/afterInit.js","meteor://ðŸ’»app/packages/jagi:astronomy-slug-behavior/lib/class_events/beforeSave.js"],"names":["module","watch","require","apply","Class","extend","createClassDefinition","exportDefault","Behavior","v","default","generateSlug","create","name","options","generateOnInit","fieldName","helperName","slugFieldName","canUpdate","unique","separator","Module","throwParseError","get","utils","check","getName","hasField","hasHelper","bind","afterInit","beforeSave","definition","fields","type","String","immutable","optional","events","diacriticsMap","isNull","each","doc","constructor","call","value","oldSlug","newSlug","toLowerCase","diacriticMap","replace","letters","base","selector","count","find","disableEvents","prefix","re","RegExp","index","forEach","d","dSlug","dIndex","parseInt","set","e","currentTarget","isModified"],"mappings":"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","file":"/packages/jagi_astronomy-slug-behavior.js","sourcesContent":["import './behavior/behavior.js';","function apply(Class) {\n  Class.extend(this.createClassDefinition(), ['fields', 'events']);\n}\n\nexport default apply;","import {\n  Behavior\n} from 'meteor/jagi:astronomy';\nimport createClassDefinition from './createClassDefinition';\nimport apply from './apply';\nimport generateSlug from './generateSlug';\n\nBehavior.create({\n  name: 'slug',\n  options: {\n    generateOnInit: false,\n    fieldName: null,\n    helperName: null,\n    slugFieldName: 'slug',\n    canUpdate: false,\n    unique: true,\n    separator: '-'\n  },\n  createClassDefinition,\n  apply,\n  generateSlug\n});\n","import {\n  Module\n} from 'meteor/jagi:astronomy';\nconst throwParseError = Module.get('core').utils.throwParseError;\n\nfunction check(Class) {\n  if (this.options.fieldName && this.options.helperName) {\n    throwParseError([{\n        'class': Class.getName()\n      }, {\n        'behavior': 'slug'\n      },\n      'Can not generate a slug from the field and method at the same time'\n    ]);\n  }\n  else if (this.options.fieldName) {\n    if (!Class.hasField(this.options.fieldName)) {\n      throwParseError([{\n          'class': Class.getName()\n        }, {\n          'behavior': 'slug'\n        },\n        `The \"${this.options.fieldName}\" field that does not exist`\n      ]);\n    }\n  }\n  else if (this.options.helperName) {\n    if (!Class.hasHelper(this.options.helperName)) {\n      throwParseError([{\n          'class': Class.getName()\n        }, {\n          'behavior': 'slug'\n        },\n        `The \"${this.options.helperName}\" helper that does not exist`\n      ]);\n    }\n  }\n  else {\n    throwParseError([{\n        'class': Class.getName()\n      }, {\n        'behavior': 'slug'\n      },\n      'Provide \"fieldName\" or \"helperName\" as a source of a slug'\n    ]);\n  }\n}\n\nexport default check;","import {\n  bind\n} from 'lodash';\nimport afterInit from '../class_events/afterInit';\nimport beforeSave from '../class_events/beforeSave';\n\nfunction createClassDefinition() {\n  const definition = {\n    fields: {\n      [this.options.slugFieldName]: {\n        type: String,\n        immutable: !this.options.canUpdate,\n        optional: true\n      }\n    },\n    events: {\n      afterInit: bind(afterInit, this),\n      beforeSave: bind(beforeSave, this)\n    }\n  };\n\n  return definition;\n}\n\nexport default createClassDefinition;","const diacriticsMap = [{\n  'base': 'a',\n  'letters': /[\\u0061\\u24D0\\uFF41\\u1E9A\\u00E0\\u00E1\\u00E2\\u1EA7\\u1EA5\\u1EAB\\u1EA9\\u00E3\\u0101\\u0103\\u1EB1\\u1EAF\\u1EB5\\u1EB3\\u0227\\u01E1\\u00E4\\u01DF\\u1EA3\\u00E5\\u01FB\\u01CE\\u0201\\u0203\\u1EA1\\u1EAD\\u1EB7\\u1E01\\u0105\\u2C65\\u0250\\u0430]/g\n}, {\n  'base': 'aa',\n  'letters': /[\\uA733]/g\n}, {\n  'base': 'ae',\n  'letters': /[\\u00E6\\u01FD\\u01E3]/g\n}, {\n  'base': 'ao',\n  'letters': /[\\uA735]/g\n}, {\n  'base': 'au',\n  'letters': /[\\uA737]/g\n}, {\n  'base': 'av',\n  'letters': /[\\uA739\\uA73B]/g\n}, {\n  'base': 'ay',\n  'letters': /[\\uA73D]/g\n}, {\n  'base': 'b',\n  'letters': /[\\u0062\\u24D1\\uFF42\\u1E03\\u1E05\\u1E07\\u0180\\u0183\\u0253\\u0431]/g\n}, {\n  'base': 'c',\n  'letters': /[\\u0063\\u24D2\\uFF43\\u0107\\u0109\\u010B\\u010D\\u00E7\\u1E09\\u0188\\u023C\\uA73F\\u2184]/g\n}, {\n  'base': 'ch',\n  'letters': /[\\u0447]/g\n}, {\n  'base': 'd',\n  'letters': /[\\u0064\\u24D3\\uFF44\\u1E0B\\u010F\\u1E0D\\u1E11\\u1E13\\u1E0F\\u0111\\u018C\\u0256\\u0257\\uA77A\\u0434]/g\n}, {\n  'base': 'dz',\n  'letters': /[\\u01F3\\u01C6]/g\n}, {\n  'base': 'e',\n  'letters': /[\\u0065\\u24D4\\uFF45\\u00E8\\u00E9\\u00EA\\u1EC1\\u1EBF\\u1EC5\\u1EC3\\u1EBD\\u0113\\u1E15\\u1E17\\u0115\\u0117\\u00EB\\u1EBB\\u011B\\u0205\\u0207\\u1EB9\\u1EC7\\u0229\\u1E1D\\u0119\\u1E19\\u1E1B\\u0247\\u025B\\u01DD\\u0435\\u0451\\u044D]/g\n}, {\n  'base': 'f',\n  'letters': /[\\u0066\\u24D5\\uFF46\\u1E1F\\u0192\\uA77C\\u0444]/g\n}, {\n  'base': 'g',\n  'letters': /[\\u0067\\u24D6\\uFF47\\u01F5\\u011D\\u1E21\\u011F\\u0121\\u01E7\\u0123\\u01E5\\u0260\\uA7A1\\u1D79\\uA77F\\u0433]/g\n}, {\n  'base': 'h',\n  'letters': /[\\u0068\\u24D7\\uFF48\\u0125\\u1E23\\u1E27\\u021F\\u1E25\\u1E29\\u1E2B\\u1E96\\u0127\\u2C68\\u2C76\\u0265]/g\n}, {\n  'base': 'hv',\n  'letters': /[\\u0195]/g\n}, {\n  'base': 'i',\n  'letters': /[\\u0069\\u24D8\\uFF49\\u00EC\\u00ED\\u00EE\\u0129\\u012B\\u012D\\u00EF\\u1E2F\\u1EC9\\u01D0\\u0209\\u020B\\u1ECB\\u012F\\u1E2D\\u0268\\u0131\\u0438\\u0439]/g\n}, {\n  'base': 'ia',\n  'letters': /[\\u044F]/g\n}, {\n  'base': 'ie',\n  'letters': /[\\u044A]/g\n}, {\n  'base': 'iu',\n  'letters': /[\\u044E]/g\n}, {\n  'base': 'j',\n  'letters': /[\\u006A\\u24D9\\uFF4A\\u0135\\u01F0\\u0249]/g\n}, {\n  'base': 'k',\n  'letters': /[\\u006B\\u24DA\\uFF4B\\u1E31\\u01E9\\u1E33\\u0137\\u1E35\\u0199\\u2C6A\\uA741\\uA743\\uA745\\uA7A3\\u043A]/g\n}, {\n  'base': 'kh',\n  'letters': /[\\u0445]/g\n}, {\n  'base': 'l',\n  'letters': /[\\u006C\\u24DB\\uFF4C\\u0140\\u013A\\u013E\\u1E37\\u1E39\\u013C\\u1E3D\\u1E3B\\u017F\\u0142\\u019A\\u026B\\u2C61\\uA749\\uA781\\uA747\\u043B]/g\n}, {\n  'base': 'lj',\n  'letters': /[\\u01C9]/g\n}, {\n  'base': 'm',\n  'letters': /[\\u006D\\u24DC\\uFF4D\\u1E3F\\u1E41\\u1E43\\u0271\\u026F\\u043C]/g\n}, {\n  'base': 'n',\n  'letters': /[\\u006E\\u24DD\\uFF4E\\u01F9\\u0144\\u00F1\\u1E45\\u0148\\u1E47\\u0146\\u1E4B\\u1E49\\u019E\\u0272\\u0149\\uA791\\uA7A5\\u043D]/g\n}, {\n  'base': 'nj',\n  'letters': /[\\u01CC]/g\n}, {\n  'base': 'o',\n  'letters': /[\\u006F\\u24DE\\uFF4F\\u00F2\\u00F3\\u00F4\\u1ED3\\u1ED1\\u1ED7\\u1ED5\\u00F5\\u1E4D\\u022D\\u1E4F\\u014D\\u1E51\\u1E53\\u014F\\u022F\\u0231\\u00F6\\u022B\\u1ECF\\u0151\\u01D2\\u020D\\u020F\\u01A1\\u1EDD\\u1EDB\\u1EE1\\u1EDF\\u1EE3\\u1ECD\\u1ED9\\u01EB\\u01ED\\u00F8\\u01FF\\u0254\\uA74B\\uA74D\\u0275\\u043E]/g\n}, {\n  'base': 'oi',\n  'letters': /[\\u01A3]/g\n}, {\n  'base': 'ou',\n  'letters': /[\\u0223]/g\n}, {\n  'base': 'oo',\n  'letters': /[\\uA74F]/g\n}, {\n  'base': 'p',\n  'letters': /[\\u0070\\u24DF\\uFF50\\u1E55\\u1E57\\u01A5\\u1D7D\\uA751\\uA753\\uA755\\u043F]/g\n}, {\n  'base': 'q',\n  'letters': /[\\u0071\\u24E0\\uFF51\\u024B\\uA757\\uA759]/g\n}, {\n  'base': 'r',\n  'letters': /[\\u0072\\u24E1\\uFF52\\u0155\\u1E59\\u0159\\u0211\\u0213\\u1E5B\\u1E5D\\u0157\\u1E5F\\u024D\\u027D\\uA75B\\uA7A7\\uA783\\u0440]/g\n}, {\n  'base': 's',\n  'letters': /[\\u0073\\u24E2\\uFF53\\u00DF\\u015B\\u1E65\\u015D\\u1E61\\u0161\\u1E67\\u1E63\\u1E69\\u0219\\u015F\\u023F\\uA7A9\\uA785\\u1E9B\\u0441]/g\n}, {\n  'base': 'sh',\n  'letters': /[\\u0448]/g\n}, {\n  'base': 'shch',\n  'letters': /[\\u0449]/g\n}, {\n  'base': 't',\n  'letters': /[\\u0074\\u24E3\\uFF54\\u1E6B\\u1E97\\u0165\\u1E6D\\u021B\\u0163\\u1E71\\u1E6F\\u0167\\u01AD\\u0288\\u2C66\\uA787\\u0442]/g\n}, {\n  'base': 'ts',\n  'letters': /[\\u0446]/g\n}, {\n  'base': 'tz',\n  'letters': /[\\uA729]/g\n}, {\n  'base': 'u',\n  'letters': /[\\u0075\\u24E4\\uFF55\\u00F9\\u00FA\\u00FB\\u0169\\u1E79\\u016B\\u1E7B\\u016D\\u00FC\\u01DC\\u01D8\\u01D6\\u01DA\\u1EE7\\u016F\\u0171\\u01D4\\u0215\\u0217\\u01B0\\u1EEB\\u1EE9\\u1EEF\\u1EED\\u1EF1\\u1EE5\\u1E73\\u0173\\u1E77\\u1E75\\u0289\\u0443]/g\n}, {\n  'base': 'v',\n  'letters': /[\\u0076\\u24E5\\uFF56\\u1E7D\\u1E7F\\u028B\\uA75F\\u028C\\u0432]/g\n}, {\n  'base': 'vy',\n  'letters': /[\\uA761]/g\n}, {\n  'base': 'w',\n  'letters': /[\\u0077\\u24E6\\uFF57\\u1E81\\u1E83\\u0175\\u1E87\\u1E85\\u1E98\\u1E89\\u2C73]/g\n}, {\n  'base': 'x',\n  'letters': /[\\u0078\\u24E7\\uFF58\\u1E8B\\u1E8D]/g\n}, {\n  'base': 'y',\n  'letters': /[\\u0079\\u24E8\\uFF59\\u1EF3\\u00FD\\u0177\\u1EF9\\u0233\\u1E8F\\u00FF\\u1EF7\\u1E99\\u1EF5\\u01B4\\u024F\\u1EFF\\u044B]/g\n}, {\n  'base': 'z',\n  'letters': /[\\u007A\\u24E9\\uFF5A\\u017A\\u1E91\\u017C\\u017E\\u1E93\\u1E95\\u01B6\\u0225\\u0240\\u2C6C\\uA763\\u0437]/g\n}, {\n  'base': 'zh',\n  'letters': /[\\u0436]/g\n}];\n\nexport default diacriticsMap;","import {\n  isNull,\n  each\n} from 'lodash';\nimport check from './check';\nimport diacriticsMap from './diacriticsMap';\n\nfunction generateSlug(doc) {\n  const Class = doc.constructor;\n\n  // Check validity of the class for generating slug.\n  check.call(this, Class);\n\n  let value;\n  if (this.options.fieldName) {\n    // Get value of a field to make a slug from.\n    value = doc.get(this.options.fieldName);\n  }\n  else if (this.options.helperName) {\n    // Generate value by a method to make a slug from.\n    value = doc[this.options.helperName]();\n  }\n\n  // If a value is null then we can not create a slug.\n  if (isNull(value)) {\n    return;\n  }\n\n  // Take the current value of the slug field.\n  const oldSlug = doc.get(this.options.slugFieldName);\n  // If the current slug is not empty and we can not update, then we have to\n  // stop here.\n  if (oldSlug && !this.options.canUpdate) {\n    return;\n  }\n\n  // GENERATE A NEW SLUG.\n  // Lower case.\n  let newSlug = value.toLowerCase();\n  // Remove diacriticts.\n  each(diacriticsMap, function(diacriticMap) {\n    newSlug = newSlug.replace(diacriticMap.letters, diacriticMap.base);\n  });\n  // Remove unsupported characters.\n  newSlug = newSlug.replace(/[^\\w\\s-]+/g, '');\n  // Trim.\n  newSlug = newSlug.replace(/^\\s+|\\s+$/g, '');\n  // Replace white characters with separator.\n  newSlug = newSlug.replace(/\\s+/g, this.options.separator);\n\n  // If the \"unique\" option was set, then check whether there are any\n  // duplicates. If there is any document with the same slug, then we have to\n  // add number at the end of the slug.\n  if (newSlug !== oldSlug) {\n    // We have to check uniquness of the slug.\n    if (this.options.unique) {\n      const selector = {\n        [this.options.slugFieldName]: newSlug\n      };\n      const count = Class.find(selector, {\n        disableEvents: true\n      }).count();\n\n      if (count > 0) {\n        // Prepare the selector with a regular expression querying all the\n        // documents that contains our slug and ends with number.\n        const prefix = newSlug + this.options.separator;\n        const re = new RegExp('^' + prefix + '\\\\d+$');\n        selector[this.options.slugFieldName] = re;\n        // Limit the amount of fields being fetched to only the slug field.\n        const options = {\n          fields: {\n            [this.options.slugFieldName]: 1\n          },\n          disableEvents: true\n        };\n        // Set the first number that will be added at the end of the slug to 2.\n        let index = 2;\n        // Loop through all the documents with the same slug.\n        Class.find(selector, options).forEach((d) => {\n          let dSlug = d.get(this.options.slugFieldName);\n          let dIndex = parseInt(dSlug.replace(prefix, ''), 10);\n          if (dIndex >= index) {\n            index = dIndex + 1;\n          }\n        });\n\n        newSlug = prefix + index;\n      }\n    }\n\n    // Set a new slug.\n    doc.set(this.options.slugFieldName, newSlug);\n  }\n}\n\nexport default generateSlug;","function afterInit(e) {\n  if (this.options.generateOnInit) {\n    const doc = e.currentTarget;\n    const Class = doc.constructor;\n    this.generateSlug(doc);\n  }\n}\n\nexport default afterInit;","function beforeSave(e) {\n  const doc = e.currentTarget;\n  const Class = doc.constructor;\n  // Check if a field from which we want to create a slug has been\n  // modified.\n  if (this.options.fieldName) {\n    if (!doc.isModified(this.options.fieldName)) {\n      return;\n    }\n  }\n  this.generateSlug(doc);\n}\n\nexport default beforeSave;"]}