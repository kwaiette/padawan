[{"type":"js","data":"(function () {\n\n/* Imports */\nvar Meteor = Package.meteor.Meteor;\nvar global = Package.meteor.global;\nvar meteorEnv = Package.meteor.meteorEnv;\nvar ECMAScript = Package.ecmascript.ECMAScript;\nvar meteorInstall = Package.modules.meteorInstall;\nvar meteorBabelHelpers = Package['babel-runtime'].meteorBabelHelpers;\nvar Promise = Package.promise.Promise;\n\nvar require = meteorInstall({\"node_modules\":{\"meteor\":{\"jagi:astronomy-softremove-behavior\":{\"lib\":{\"main.js\":function(require,exports,module){\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                              //\n// packages/jagi_astronomy-softremove-behavior/lib/main.js                                                      //\n//                                                                                                              //\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                //\nmodule.watch(require(\"./behavior/behavior.js\"));\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"behavior\":{\"behavior.js\":function(require,exports,module){\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                              //\n// packages/jagi_astronomy-softremove-behavior/lib/behavior/behavior.js                                         //\n//                                                                                                              //\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                //\nconst module1 = module;\n\nlet _bind;\n\nmodule1.watch(require(\"lodash/bind\"), {\n  default(v) {\n    _bind = v;\n  }\n\n}, 0);\n\nlet _forEach;\n\nmodule1.watch(require(\"lodash/forEach\"), {\n  default(v) {\n    _forEach = v;\n  }\n\n}, 1);\n\nlet _zipObject;\n\nmodule1.watch(require(\"lodash/zipObject\"), {\n  default(v) {\n    _zipObject = v;\n  }\n\n}, 2);\nlet Module, Behavior, Event;\nmodule1.watch(require(\"meteor/jagi:astronomy\"), {\n  Module(v) {\n    Module = v;\n  },\n\n  Behavior(v) {\n    Behavior = v;\n  },\n\n  Event(v) {\n    Event = v;\n  }\n\n}, 3);\nlet beforeFind;\nmodule1.watch(require(\"../class_events/beforeFind\"), {\n  default(v) {\n    beforeFind = v;\n  }\n\n}, 4);\nlet softRemove;\nmodule1.watch(require(\"../class_prototype_methods/softRemove\"), {\n  default(v) {\n    softRemove = v;\n  }\n\n}, 5);\nlet softRestore;\nmodule1.watch(require(\"../class_prototype_methods/softRestore\"), {\n  default(v) {\n    softRestore = v;\n  }\n\n}, 6);\nlet meteorSoftRemove;\nmodule1.watch(require(\"../meteor_methods/softRemove\"), {\n  default(v) {\n    meteorSoftRemove = v;\n  }\n\n}, 7);\nlet meteorSoftRestore;\nmodule1.watch(require(\"../meteor_methods/softRestore\"), {\n  default(v) {\n    meteorSoftRestore = v;\n  }\n\n}, 8);\nconst hasMeteorMethod = Module.modules.storage.utils.hasMeteorMethod;\nBehavior.create({\n  name: \"softremove\",\n  options: {\n    removedFieldName: \"removed\",\n    hasRemovedAtField: true,\n    removedAtFieldName: \"removedAt\"\n  },\n\n  createClassDefinition() {\n    const behavior = this;\n    const definition = {\n      fields: {},\n      events: {\n        beforeFind: _bind(beforeFind, behavior)\n      },\n      // Fix for Astronomy 2.2.4 where I've changed name of the \"methods\" module\n      // to \"helpers\" module. I shouldn't do that even when changing property\n      // name in schema.\n      helpers: {\n        softRemove,\n        softRestore\n      }\n    }; // Add a field storing a removal flag.\n\n    definition.fields[behavior.options.removedFieldName] = {\n      type: Boolean,\n      default: false\n    };\n\n    if (behavior.options.hasRemovedAtField) {\n      // Add a field storing a removal date.\n      definition.fields[behavior.options.removedAtFieldName] = {\n        type: Date,\n        optional: true\n      };\n    }\n\n    return definition;\n  },\n\n  apply(Class) {\n    const Collection = Class.getCollection(); // If it's a remote collection then we register methods on the connection\n    // object of the collection.\n\n    let connection = Collection._connection;\n\n    if (connection) {\n      // Prepare meteor methods to be added.\n      let meteorMethods = {\n        \"/Astronomy/softRemove\": meteorSoftRemove,\n        \"/Astronomy/softRestore\": meteorSoftRestore\n      };\n\n      _forEach(meteorMethods, (meteorMethod, methodName) => {\n        if (!hasMeteorMethod(connection, methodName)) {\n          // Add meteor method.\n          connection.methods(_zipObject([methodName], [meteorMethod]));\n        }\n      });\n    }\n\n    Class.extend(this.createClassDefinition(), [\"fields\", \"events\", \"helpers\", \"methods\"]);\n  }\n\n});\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}},\"class_events\":{\"beforeFind.js\":function(require,exports,module){\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                              //\n// packages/jagi_astronomy-softremove-behavior/lib/class_events/beforeFind.js                                   //\n//                                                                                                              //\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                //\nconst beforeFind = function (e) {\n  const doc = e.currentTarget;\n  const Class = doc.constructor;\n  const selector = e.selector;\n  selector[this.options.removedFieldName] = {\n    $ne: true\n  };\n};\n\nmodule.exportDefault(beforeFind);\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}},\"class_prototype_methods\":{\"softRemove.js\":function(require,exports,module){\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                              //\n// packages/jagi_astronomy-softremove-behavior/lib/class_prototype_methods/softRemove.js                        //\n//                                                                                                              //\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                //\nlet Match;\nmodule.watch(require(\"meteor/check\"), {\n  Match(v) {\n    Match = v;\n  }\n\n}, 0);\nlet Module;\nmodule.watch(require(\"meteor/jagi:astronomy\"), {\n  Module(v) {\n    Module = v;\n  }\n\n}, 1);\nlet documentSoftRemove;\nmodule.watch(require(\"../utils/documentSoftRemove\"), {\n  default(v) {\n    documentSoftRemove = v;\n  }\n\n}, 2);\nconst isRemote = Module.modules.storage.utils.isRemote;\nconst callMeteorMethod = Module.modules.storage.utils.callMeteorMethod;\n\nconst softRemove = function (args = {}, callback) {\n  let doc = this;\n  let Class = doc.constructor; // If the first argument is callback function then reassign values.\n\n  if (arguments.length === 1 && Match.test(args, Function)) {\n    callback = args;\n    args = {};\n  } // Get variables from the first argument.\n\n\n  let {\n    simulation = true\n  } = args; // If we are dealing with a remote collection and we are not on the server.\n\n  if (isRemote(Class)) {\n    // Prepare meteor method name to be called.\n    let methodName = \"/Astronomy/softRemove\"; // Prepare arguments for the meteor method.\n\n    let methodArgs = {\n      className: Class.getName(),\n      selector: {\n        _id: doc._id\n      },\n      simulation\n    };\n\n    try {\n      // Run meteor method.\n      let result = callMeteorMethod(Class, methodName, [methodArgs], callback); // Return result of the meteor method call.\n\n      return result;\n    } catch (err) {\n      // Catch stub exceptions.\n      if (callback) {\n        callback(err);\n        return null;\n      }\n\n      throw err;\n    }\n  } // If we can just remove a document without calling the meteor method. We may\n  // be on the server or the collection may be local.\n\n\n  try {\n    // Prepare arguments.\n    let methodArgs = {\n      doc,\n      simulation,\n      trusted: true\n    };\n    let result = documentSoftRemove(methodArgs);\n\n    if (callback) {\n      callback(undefined, result);\n    }\n\n    return result;\n  } catch (err) {\n    if (callback) {\n      callback(err);\n      return null;\n    }\n\n    throw err;\n  }\n};\n\nmodule.exportDefault(softRemove);\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"softRestore.js\":function(require,exports,module){\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                              //\n// packages/jagi_astronomy-softremove-behavior/lib/class_prototype_methods/softRestore.js                       //\n//                                                                                                              //\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                //\nlet Match;\nmodule.watch(require(\"meteor/check\"), {\n  Match(v) {\n    Match = v;\n  }\n\n}, 0);\nlet Module;\nmodule.watch(require(\"meteor/jagi:astronomy\"), {\n  Module(v) {\n    Module = v;\n  }\n\n}, 1);\nlet documentSoftRestore;\nmodule.watch(require(\"../utils/documentSoftRestore\"), {\n  default(v) {\n    documentSoftRestore = v;\n  }\n\n}, 2);\nconst isRemote = Module.modules.storage.utils.isRemote;\nconst callMeteorMethod = Module.modules.storage.utils.callMeteorMethod;\n\nconst softRestore = function (args = {}, callback) {\n  let doc = this;\n  let Class = doc.constructor; // If the first argument is callback function then reassign values.\n\n  if (arguments.length === 1 && Match.test(args, Function)) {\n    callback = args;\n    args = {};\n  } // Get variables from the first argument.\n\n\n  let {\n    simulation = true\n  } = args; // If we are dealing with a remote collection and we are not on the server.\n\n  if (isRemote(Class)) {\n    // Prepare meteor method name to be called.\n    let methodName = \"/Astronomy/softRestore\"; // Prepare arguments for the meteor method.\n\n    let methodArgs = {\n      className: Class.getName(),\n      selector: {\n        _id: doc._id\n      },\n      simulation\n    };\n\n    try {\n      // Run meteor method.\n      let result = callMeteorMethod(Class, methodName, [methodArgs], callback); // Return result of the meteor method call.\n\n      return result;\n    } catch (err) {\n      // Catch stub exceptions.\n      if (callback) {\n        callback(err);\n        return null;\n      }\n\n      throw err;\n    }\n  } // If we can just remove a document without calling the meteor method. We may\n  // be on the server or the collection may be local.\n\n\n  try {\n    // Prepare arguments.\n    let methodArgs = {\n      doc,\n      simulation,\n      trusted: true\n    };\n    let result = documentSoftRestore(methodArgs);\n\n    if (callback) {\n      callback(undefined, result);\n    }\n\n    return result;\n  } catch (err) {\n    if (callback) {\n      callback(err);\n      return null;\n    }\n\n    throw err;\n  }\n};\n\nmodule.exportDefault(softRestore);\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}},\"meteor_methods\":{\"softRemove.js\":function(require,exports,module){\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                              //\n// packages/jagi_astronomy-softremove-behavior/lib/meteor_methods/softRemove.js                                 //\n//                                                                                                              //\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                //\nlet classSoftRemove;\nmodule.watch(require(\"../utils/classSoftRemove\"), {\n  default(v) {\n    classSoftRemove = v;\n  }\n\n}, 0);\n\nconst softRemove = function (args) {\n  return classSoftRemove(args);\n};\n\nmodule.exportDefault(softRemove);\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"softRestore.js\":function(require,exports,module){\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                              //\n// packages/jagi_astronomy-softremove-behavior/lib/meteor_methods/softRestore.js                                //\n//                                                                                                              //\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                //\nlet classSoftRestore;\nmodule.watch(require(\"../utils/classSoftRestore\"), {\n  default(v) {\n    classSoftRestore = v;\n  }\n\n}, 0);\n\nconst softRestore = function (args) {\n  return classSoftRestore(args);\n};\n\nmodule.exportDefault(softRestore);\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}},\"utils\":{\"classSoftRemove.js\":function(require,exports,module){\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                              //\n// packages/jagi_astronomy-softremove-behavior/lib/utils/classSoftRemove.js                                     //\n//                                                                                                              //\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                //\nlet AstroClass, Module;\nmodule.watch(require(\"meteor/jagi:astronomy\"), {\n  Class(v) {\n    AstroClass = v;\n  },\n\n  Module(v) {\n    Module = v;\n  }\n\n}, 0);\nlet documentSoftRemove;\nmodule.watch(require(\"./documentSoftRemove\"), {\n  default(v) {\n    documentSoftRemove = v;\n  }\n\n}, 1);\nconst throwIfSelectorIsNotId = Module.modules.storage.utils.throwIfSelectorIsNotId;\n\nconst classRemove = function (args = {}) {\n  let {\n    className,\n    selector,\n    simulation = true,\n    trusted = false\n  } = args; // Stop execution, if we are not on the server, when the \"simulation\" flag is\n  // not set.\n\n  if (!simulation && !Meteor.isServer) {\n    return;\n  } // Throw exception if we are trying to perform an operation on more than one\n  // document at once and it's not trusted call.\n\n\n  if (!trusted) {\n    throwIfSelectorIsNotId(selector, \"softRemove\");\n  }\n\n  let Class = AstroClass.get(className); // Get all documents matching selector.\n\n  let docs = Class.find(selector); // Prepare result of the method execution.\n\n  let result = 0;\n  docs.forEach(doc => {\n    // Update a document.\n    result += documentSoftRemove({\n      doc,\n      simulation,\n      trusted\n    });\n  });\n  return result;\n};\n\nmodule.exportDefault(classRemove);\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"classSoftRestore.js\":function(require,exports,module){\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                              //\n// packages/jagi_astronomy-softremove-behavior/lib/utils/classSoftRestore.js                                    //\n//                                                                                                              //\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                //\nlet AstroClass, Module;\nmodule.watch(require(\"meteor/jagi:astronomy\"), {\n  Class(v) {\n    AstroClass = v;\n  },\n\n  Module(v) {\n    Module = v;\n  }\n\n}, 0);\nlet documentSoftRestore;\nmodule.watch(require(\"./documentSoftRestore\"), {\n  default(v) {\n    documentSoftRestore = v;\n  }\n\n}, 1);\nconst throwIfSelectorIsNotId = Module.modules.storage.utils.throwIfSelectorIsNotId;\n\nconst classRestore = function (args = {}) {\n  let {\n    className,\n    selector,\n    simulation = true,\n    trusted = false\n  } = args; // Stop execution, if we are not on the server, when the \"simulation\" flag is\n  // not set.\n\n  if (!simulation && !Meteor.isServer) {\n    return;\n  } // Throw exception if we are trying to perform an operation on more than one\n  // document at once and it's not trusted call.\n\n\n  if (!trusted) {\n    throwIfSelectorIsNotId(selector, \"softRestore\");\n  }\n\n  let Class = AstroClass.get(className); // Get all documents matching selector.\n\n  let docs = Class.find(selector, {\n    disableEvents: true\n  }); // Prepare result of the method execution.\n\n  let result = 0;\n  docs.forEach(doc => {\n    // Update a document.\n    result += documentSoftRestore({\n      doc,\n      simulation,\n      trusted\n    });\n  });\n  return result;\n};\n\nmodule.exportDefault(classRestore);\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"documentSoftRemove.js\":function(require,exports,module){\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                              //\n// packages/jagi_astronomy-softremove-behavior/lib/utils/documentSoftRemove.js                                  //\n//                                                                                                              //\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                //\nlet _defaults;\n\nmodule.watch(require(\"lodash/defaults\"), {\n  default(v) {\n    _defaults = v;\n  }\n\n}, 0);\nlet triggerBeforeSoftRemove;\nmodule.watch(require(\"./triggerBeforeSoftRemove\"), {\n  default(v) {\n    triggerBeforeSoftRemove = v;\n  }\n\n}, 1);\nlet triggerAfterSoftRemove;\nmodule.watch(require(\"./triggerAfterSoftRemove\"), {\n  default(v) {\n    triggerAfterSoftRemove = v;\n  }\n\n}, 2);\nlet Module;\nmodule.watch(require(\"meteor/jagi:astronomy\"), {\n  Module(v) {\n    Module = v;\n  }\n\n}, 3);\nconst getModifier = Module.modules.storage.utils.getModifier;\n\nconst documentSoftRemove = function (args = {}) {\n  const {\n    doc,\n    simulation = true,\n    trusted = false\n  } = args; // Stop execution, if we are not on the server, when the \"simulation\" flag is\n  // not set.\n\n  if (!simulation && !Meteor.isServer) {\n    return;\n  }\n\n  const Class = doc.constructor;\n  const Collection = Class.getCollection(); // Remove only when document has the \"_id\" field (it's persisted).\n\n  if (Class.isNew(doc) || !doc._id) {\n    return 0;\n  } // Check if a class is secured.\n\n\n  if (Class.isSecured(\"softRemove\") && Meteor.isServer && !trusted) {\n    throw new Meteor.Error(403, \"Soft removing from the client is not allowed\");\n  } // Trigger before events.\n\n\n  triggerBeforeSoftRemove(doc, trusted); // Prepare selector.\n\n  const selector = {\n    _id: doc._id\n  }; // Prepare modifier.\n\n  const modifier = _defaults(getModifier({\n    doc\n  }), {\n    $set: {}\n  });\n\n  const behavior = Class.getBehavior(\"softremove\")[0];\n  modifier.$set[behavior.options.removedFieldName] = true;\n\n  if (behavior.options.hasRemovedAtField) {\n    modifier.$set[behavior.options.removedAtFieldName] = new Date();\n  } // Remove a document.\n\n\n  const result = Collection._collection.update(selector, modifier); // Trigger after events.\n\n\n  triggerAfterSoftRemove(doc, trusted);\n  return result;\n};\n\nmodule.exportDefault(documentSoftRemove);\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"documentSoftRestore.js\":function(require,exports,module){\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                              //\n// packages/jagi_astronomy-softremove-behavior/lib/utils/documentSoftRestore.js                                 //\n//                                                                                                              //\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                //\nlet triggerBeforeSoftRestore;\nmodule.watch(require(\"./triggerBeforeSoftRestore\"), {\n  default(v) {\n    triggerBeforeSoftRestore = v;\n  }\n\n}, 0);\nlet triggerAfterSoftRestore;\nmodule.watch(require(\"./triggerAfterSoftRestore\"), {\n  default(v) {\n    triggerAfterSoftRestore = v;\n  }\n\n}, 1);\n\nconst documentSoftRestore = function (args = {}) {\n  const {\n    doc,\n    simulation = true,\n    trusted = false\n  } = args; // Stop execution, if we are not on the server, when the \"simulation\" flag is\n  // not set.\n\n  if (!simulation && !Meteor.isServer) {\n    return;\n  }\n\n  const Class = doc.constructor;\n  const Collection = Class.getCollection(); // Restore only when document has the \"_id\" field (it's persisted).\n\n  if (Class.isNew(doc) || !doc._id) {\n    return 0;\n  } // Check if a class is secured.\n\n\n  if (Class.isSecured(\"softRestore\") && Meteor.isServer && !trusted) {\n    throw new Meteor.Error(403, \"Soft restoring from the client is not allowed\");\n  } // Trigger before events.\n\n\n  triggerBeforeSoftRestore(doc, trusted); // Prepare selector.\n\n  const selector = {\n    _id: doc._id\n  }; // Prepare modifier.\n\n  const modifier = {\n    $set: {}\n  };\n  const behavior = Class.getBehavior(\"softremove\")[0];\n  modifier.$set[behavior.options.removedFieldName] = false;\n\n  if (behavior.options.hasRemovedAtField) {\n    modifier.$unset = {\n      [behavior.options.removedAtFieldName]: \"\"\n    };\n  } // Restore a document.\n\n\n  const result = Collection._collection.update(selector, modifier); // Trigger after events.\n\n\n  triggerAfterSoftRestore(doc, trusted);\n  return result;\n};\n\nmodule.exportDefault(documentSoftRestore);\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"triggerAfterSoftRemove.js\":function(require,exports,module){\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                              //\n// packages/jagi_astronomy-softremove-behavior/lib/utils/triggerAfterSoftRemove.js                              //\n//                                                                                                              //\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                //\nlet Event;\nmodule.watch(require(\"meteor/jagi:astronomy\"), {\n  Event(v) {\n    Event = v;\n  }\n\n}, 0);\n\nconst triggerAfterSoftRemove = function (doc, trusted) {\n  // Trigger the \"afterSoftRemove\" event handlers.\n  doc.dispatchEvent(new Event(\"afterSoftRemove\", {\n    propagates: true,\n    trusted: trusted\n  }));\n};\n\nmodule.exportDefault(triggerAfterSoftRemove);\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"triggerAfterSoftRestore.js\":function(require,exports,module){\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                              //\n// packages/jagi_astronomy-softremove-behavior/lib/utils/triggerAfterSoftRestore.js                             //\n//                                                                                                              //\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                //\nlet Event;\nmodule.watch(require(\"meteor/jagi:astronomy\"), {\n  Event(v) {\n    Event = v;\n  }\n\n}, 0);\n\nconst triggerAfterSoftRestore = function (doc, trusted) {\n  // Trigger the \"afterSoftRestore\" event handlers.\n  doc.dispatchEvent(new Event(\"afterSoftRestore\", {\n    propagates: true,\n    trusted: trusted\n  }));\n};\n\nmodule.exportDefault(triggerAfterSoftRestore);\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"triggerBeforeSoftRemove.js\":function(require,exports,module){\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                              //\n// packages/jagi_astronomy-softremove-behavior/lib/utils/triggerBeforeSoftRemove.js                             //\n//                                                                                                              //\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                //\nlet Event;\nmodule.watch(require(\"meteor/jagi:astronomy\"), {\n  Event(v) {\n    Event = v;\n  }\n\n}, 0);\n\nconst triggerBeforeSoftRemove = function (doc, trusted) {\n  // Trigger the \"beforeSoftRemove\" event handlers.\n  if (!doc.dispatchEvent(new Event(\"beforeSoftRemove\", {\n    cancelable: true,\n    propagates: true,\n    trusted: trusted\n  }))) {\n    // If an event was prevented, then we stop here.\n    throw new Meteor.Error(\"prevented\", \"Operation prevented\", {\n      eventName: \"beforeSoftRemove\"\n    });\n  }\n};\n\nmodule.exportDefault(triggerBeforeSoftRemove);\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"triggerBeforeSoftRestore.js\":function(require,exports,module){\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                              //\n// packages/jagi_astronomy-softremove-behavior/lib/utils/triggerBeforeSoftRestore.js                            //\n//                                                                                                              //\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                //\nlet Event;\nmodule.watch(require(\"meteor/jagi:astronomy\"), {\n  Event(v) {\n    Event = v;\n  }\n\n}, 0);\n\nconst triggerBeforeSoftRestore = function (doc, trusted) {\n  // Trigger the \"beforeSoftRestore\" event handlers.\n  if (!doc.dispatchEvent(new Event(\"beforeSoftRestore\", {\n    cancelable: true,\n    propagates: true,\n    trusted: trusted\n  }))) {\n    // If an event was prevented, then we stop here.\n    throw new Meteor.Error(\"prevented\", \"Operation prevented\", {\n      eventName: \"beforeSoftRestore\"\n    });\n  }\n};\n\nmodule.exportDefault(triggerBeforeSoftRestore);\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}}},\"node_modules\":{\"lodash\":{\"bind.js\":function(require,exports,module){\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                              //\n// node_modules/meteor/jagi_astronomy-softremove-behavior/node_modules/lodash/bind.js                           //\n//                                                                                                              //\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                //\nmodule.useNode();\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"forEach.js\":function(require,exports,module){\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                              //\n// node_modules/meteor/jagi_astronomy-softremove-behavior/node_modules/lodash/forEach.js                        //\n//                                                                                                              //\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                //\nmodule.useNode();\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"zipObject.js\":function(require,exports,module){\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                              //\n// node_modules/meteor/jagi_astronomy-softremove-behavior/node_modules/lodash/zipObject.js                      //\n//                                                                                                              //\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                //\nmodule.useNode();\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n},\"defaults.js\":function(require,exports,module){\n\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n//                                                                                                              //\n// node_modules/meteor/jagi_astronomy-softremove-behavior/node_modules/lodash/defaults.js                       //\n//                                                                                                              //\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n                                                                                                                //\nmodule.useNode();\n//////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\n}}}}}}},{\n  \"extensions\": [\n    \".js\",\n    \".json\"\n  ]\n});\n\nvar exports = require(\"/node_modules/meteor/jagi:astronomy-softremove-behavior/lib/main.js\");\n\n/* Exports */\nPackage._define(\"jagi:astronomy-softremove-behavior\", exports);\n\n})();\n","servePath":"/packages/jagi_astronomy-softremove-behavior.js","sourceMap":{"version":3,"sources":["packages/jagi:astronomy-softremove-behavior/lib/main.js","packages/jagi:astronomy-softremove-behavior/lib/behavior/behavior.js","packages/jagi:astronomy-softremove-behavior/lib/class_events/beforeFind.js","packages/jagi:astronomy-softremove-behavior/lib/class_prototype_methods/softRemove.js","packages/jagi:astronomy-softremove-behavior/lib/class_prototype_methods/softRestore.js","packages/jagi:astronomy-softremove-behavior/lib/meteor_methods/softRemove.js","packages/jagi:astronomy-softremove-behavior/lib/meteor_methods/softRestore.js","packages/jagi:astronomy-softremove-behavior/lib/utils/classSoftRemove.js","packages/jagi:astronomy-softremove-behavior/lib/utils/classSoftRestore.js","packages/jagi:astronomy-softremove-behavior/lib/utils/documentSoftRemove.js","packages/jagi:astronomy-softremove-behavior/lib/utils/documentSoftRestore.js","packages/jagi:astronomy-softremove-behavior/lib/utils/triggerAfterSoftRemove.js","packages/jagi:astronomy-softremove-behavior/lib/utils/triggerAfterSoftRestore.js","packages/jagi:astronomy-softremove-behavior/lib/utils/triggerBeforeSoftRemove.js","packages/jagi:astronomy-softremove-behavior/lib/utils/triggerBeforeSoftRestore.js"],"names":["module","watch","require","module1","_bind","default","v","_forEach","_zipObject","Module","Behavior","Event","beforeFind","softRemove","softRestore","meteorSoftRemove","meteorSoftRestore","hasMeteorMethod","modules","storage","utils","create","name","options","removedFieldName","hasRemovedAtField","removedAtFieldName","createClassDefinition","behavior","definition","fields","events","helpers","type","Boolean","Date","optional","apply","Class","Collection","getCollection","connection","_connection","meteorMethods","meteorMethod","methodName","methods","extend","e","doc","currentTarget","constructor","selector","$ne","exportDefault","Match","documentSoftRemove","isRemote","callMeteorMethod","args","callback","arguments","length","test","Function","simulation","methodArgs","className","getName","_id","result","err","trusted","undefined","documentSoftRestore","classSoftRemove","classSoftRestore","AstroClass","throwIfSelectorIsNotId","classRemove","Meteor","isServer","get","docs","find","forEach","classRestore","disableEvents","_defaults","triggerBeforeSoftRemove","triggerAfterSoftRemove","getModifier","isNew","isSecured","Error","modifier","$set","getBehavior","_collection","update","triggerBeforeSoftRestore","triggerAfterSoftRestore","$unset","dispatchEvent","propagates","cancelable","eventName"],"mappings":"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","file":"/packages/jagi_astronomy-softremove-behavior.js","sourcesContent":["import \"./behavior/behavior.js\";\n","import _bind from \"lodash/bind\";\nimport _forEach from \"lodash/forEach\";\nimport _zipObject from \"lodash/zipObject\";\nimport { Module, Behavior, Event } from \"meteor/jagi:astronomy\";\nimport beforeFind from \"../class_events/beforeFind\";\nimport softRemove from \"../class_prototype_methods/softRemove\";\nimport softRestore from \"../class_prototype_methods/softRestore\";\nimport meteorSoftRemove from \"../meteor_methods/softRemove\";\nimport meteorSoftRestore from \"../meteor_methods/softRestore\";\nconst hasMeteorMethod = Module.modules.storage.utils.hasMeteorMethod;\n\nBehavior.create({\n  name: \"softremove\",\n  options: {\n    removedFieldName: \"removed\",\n    hasRemovedAtField: true,\n    removedAtFieldName: \"removedAt\"\n  },\n  createClassDefinition() {\n    const behavior = this;\n\n    const definition = {\n      fields: {},\n      events: {\n        beforeFind: _bind(beforeFind, behavior)\n      },\n      // Fix for Astronomy 2.2.4 where I've changed name of the \"methods\" module\n      // to \"helpers\" module. I shouldn't do that even when changing property\n      // name in schema.\n      helpers: {\n        softRemove,\n        softRestore\n      }\n    };\n\n    // Add a field storing a removal flag.\n    definition.fields[behavior.options.removedFieldName] = {\n      type: Boolean,\n      default: false\n    };\n\n    if (behavior.options.hasRemovedAtField) {\n      // Add a field storing a removal date.\n      definition.fields[behavior.options.removedAtFieldName] = {\n        type: Date,\n        optional: true\n      };\n    }\n\n    return definition;\n  },\n  apply(Class) {\n    const Collection = Class.getCollection();\n\n    // If it's a remote collection then we register methods on the connection\n    // object of the collection.\n    let connection = Collection._connection;\n    if (connection) {\n      // Prepare meteor methods to be added.\n      let meteorMethods = {\n        \"/Astronomy/softRemove\": meteorSoftRemove,\n        \"/Astronomy/softRestore\": meteorSoftRestore\n      };\n      _forEach(meteorMethods, (meteorMethod, methodName) => {\n        if (!hasMeteorMethod(connection, methodName)) {\n          // Add meteor method.\n          connection.methods(_zipObject([methodName], [meteorMethod]));\n        }\n      });\n    }\n\n    Class.extend(this.createClassDefinition(), [\n      \"fields\",\n      \"events\",\n      \"helpers\",\n      \"methods\"\n    ]);\n  }\n});\n","const beforeFind = function(e) {\n  const doc = e.currentTarget;\n  const Class = doc.constructor;\n  const selector = e.selector;\n\n  selector[this.options.removedFieldName] = { $ne: true };\n};\n\nexport default beforeFind;\n","import { Match } from \"meteor/check\";\nimport { Module } from \"meteor/jagi:astronomy\";\nimport documentSoftRemove from \"../utils/documentSoftRemove\";\nconst isRemote = Module.modules.storage.utils.isRemote;\nconst callMeteorMethod = Module.modules.storage.utils.callMeteorMethod;\n\nconst softRemove = function(args = {}, callback) {\n  let doc = this;\n  let Class = doc.constructor;\n\n  // If the first argument is callback function then reassign values.\n  if (arguments.length === 1 && Match.test(args, Function)) {\n    callback = args;\n    args = {};\n  }\n  // Get variables from the first argument.\n  let { simulation = true } = args;\n\n  // If we are dealing with a remote collection and we are not on the server.\n  if (isRemote(Class)) {\n    // Prepare meteor method name to be called.\n    let methodName = \"/Astronomy/softRemove\";\n    // Prepare arguments for the meteor method.\n    let methodArgs = {\n      className: Class.getName(),\n      selector: {\n        _id: doc._id\n      },\n      simulation\n    };\n\n    try {\n      // Run meteor method.\n      let result = callMeteorMethod(Class, methodName, [methodArgs], callback);\n      // Return result of the meteor method call.\n      return result;\n    } catch (err) {\n      // Catch stub exceptions.\n      if (callback) {\n        callback(err);\n        return null;\n      }\n      throw err;\n    }\n  }\n\n  // If we can just remove a document without calling the meteor method. We may\n  // be on the server or the collection may be local.\n  try {\n    // Prepare arguments.\n    let methodArgs = {\n      doc,\n      simulation,\n      trusted: true\n    };\n    let result = documentSoftRemove(methodArgs);\n    if (callback) {\n      callback(undefined, result);\n    }\n    return result;\n  } catch (err) {\n    if (callback) {\n      callback(err);\n      return null;\n    }\n    throw err;\n  }\n};\n\nexport default softRemove;\n","import { Match } from \"meteor/check\";\nimport { Module } from \"meteor/jagi:astronomy\";\nimport documentSoftRestore from \"../utils/documentSoftRestore\";\nconst isRemote = Module.modules.storage.utils.isRemote;\nconst callMeteorMethod = Module.modules.storage.utils.callMeteorMethod;\n\nconst softRestore = function(args = {}, callback) {\n  let doc = this;\n  let Class = doc.constructor;\n\n  // If the first argument is callback function then reassign values.\n  if (arguments.length === 1 && Match.test(args, Function)) {\n    callback = args;\n    args = {};\n  }\n  // Get variables from the first argument.\n  let { simulation = true } = args;\n\n  // If we are dealing with a remote collection and we are not on the server.\n  if (isRemote(Class)) {\n    // Prepare meteor method name to be called.\n    let methodName = \"/Astronomy/softRestore\";\n    // Prepare arguments for the meteor method.\n    let methodArgs = {\n      className: Class.getName(),\n      selector: {\n        _id: doc._id\n      },\n      simulation\n    };\n\n    try {\n      // Run meteor method.\n      let result = callMeteorMethod(Class, methodName, [methodArgs], callback);\n      // Return result of the meteor method call.\n      return result;\n    } catch (err) {\n      // Catch stub exceptions.\n      if (callback) {\n        callback(err);\n        return null;\n      }\n      throw err;\n    }\n  }\n\n  // If we can just remove a document without calling the meteor method. We may\n  // be on the server or the collection may be local.\n  try {\n    // Prepare arguments.\n    let methodArgs = {\n      doc,\n      simulation,\n      trusted: true\n    };\n    let result = documentSoftRestore(methodArgs);\n    if (callback) {\n      callback(undefined, result);\n    }\n    return result;\n  } catch (err) {\n    if (callback) {\n      callback(err);\n      return null;\n    }\n    throw err;\n  }\n};\n\nexport default softRestore;\n","import classSoftRemove from \"../utils/classSoftRemove\";\n\nconst softRemove = function(args) {\n  return classSoftRemove(args);\n};\n\nexport default softRemove;\n","import classSoftRestore from \"../utils/classSoftRestore\";\n\nconst softRestore = function(args) {\n  return classSoftRestore(args);\n};\n\nexport default softRestore;\n","import { Class as AstroClass, Module } from \"meteor/jagi:astronomy\";\nimport documentSoftRemove from \"./documentSoftRemove\";\nconst throwIfSelectorIsNotId =\n  Module.modules.storage.utils.throwIfSelectorIsNotId;\n\nconst classRemove = function(args = {}) {\n  let { className, selector, simulation = true, trusted = false } = args;\n\n  // Stop execution, if we are not on the server, when the \"simulation\" flag is\n  // not set.\n  if (!simulation && !Meteor.isServer) {\n    return;\n  }\n\n  // Throw exception if we are trying to perform an operation on more than one\n  // document at once and it's not trusted call.\n  if (!trusted) {\n    throwIfSelectorIsNotId(selector, \"softRemove\");\n  }\n\n  let Class = AstroClass.get(className);\n  // Get all documents matching selector.\n  let docs = Class.find(selector);\n  // Prepare result of the method execution.\n  let result = 0;\n\n  docs.forEach(doc => {\n    // Update a document.\n    result += documentSoftRemove({\n      doc,\n      simulation,\n      trusted\n    });\n  });\n\n  return result;\n};\n\nexport default classRemove;\n","import { Class as AstroClass, Module } from \"meteor/jagi:astronomy\";\nimport documentSoftRestore from \"./documentSoftRestore\";\nconst throwIfSelectorIsNotId =\n  Module.modules.storage.utils.throwIfSelectorIsNotId;\n\nconst classRestore = function(args = {}) {\n  let { className, selector, simulation = true, trusted = false } = args;\n\n  // Stop execution, if we are not on the server, when the \"simulation\" flag is\n  // not set.\n  if (!simulation && !Meteor.isServer) {\n    return;\n  }\n\n  // Throw exception if we are trying to perform an operation on more than one\n  // document at once and it's not trusted call.\n  if (!trusted) {\n    throwIfSelectorIsNotId(selector, \"softRestore\");\n  }\n\n  let Class = AstroClass.get(className);\n  // Get all documents matching selector.\n  let docs = Class.find(selector, {\n    disableEvents: true\n  });\n  // Prepare result of the method execution.\n  let result = 0;\n\n  docs.forEach(doc => {\n    // Update a document.\n    result += documentSoftRestore({\n      doc,\n      simulation,\n      trusted\n    });\n  });\n\n  return result;\n};\n\nexport default classRestore;\n","import _defaults from \"lodash/defaults\";\nimport triggerBeforeSoftRemove from \"./triggerBeforeSoftRemove\";\nimport triggerAfterSoftRemove from \"./triggerAfterSoftRemove\";\nimport { Module } from \"meteor/jagi:astronomy\";\n\nconst getModifier = Module.modules.storage.utils.getModifier;\n\nconst documentSoftRemove = function(args = {}) {\n  const { doc, simulation = true, trusted = false } = args;\n\n  // Stop execution, if we are not on the server, when the \"simulation\" flag is\n  // not set.\n  if (!simulation && !Meteor.isServer) {\n    return;\n  }\n\n  const Class = doc.constructor;\n  const Collection = Class.getCollection();\n\n  // Remove only when document has the \"_id\" field (it's persisted).\n  if (Class.isNew(doc) || !doc._id) {\n    return 0;\n  }\n\n  // Check if a class is secured.\n  if (Class.isSecured(\"softRemove\") && Meteor.isServer && !trusted) {\n    throw new Meteor.Error(403, \"Soft removing from the client is not allowed\");\n  }\n\n  // Trigger before events.\n  triggerBeforeSoftRemove(doc, trusted);\n\n  // Prepare selector.\n  const selector = {\n    _id: doc._id\n  };\n  // Prepare modifier.\n  const modifier = _defaults(\n    getModifier({\n      doc\n    }),\n    {\n      $set: {}\n    }\n  );\n  const behavior = Class.getBehavior(\"softremove\")[0];\n  modifier.$set[behavior.options.removedFieldName] = true;\n  if (behavior.options.hasRemovedAtField) {\n    modifier.$set[behavior.options.removedAtFieldName] = new Date();\n  }\n  // Remove a document.\n  const result = Collection._collection.update(selector, modifier);\n\n  // Trigger after events.\n  triggerAfterSoftRemove(doc, trusted);\n\n  return result;\n};\n\nexport default documentSoftRemove;\n","import triggerBeforeSoftRestore from \"./triggerBeforeSoftRestore\";\nimport triggerAfterSoftRestore from \"./triggerAfterSoftRestore\";\n\nconst documentSoftRestore = function(args = {}) {\n  const { doc, simulation = true, trusted = false } = args;\n\n  // Stop execution, if we are not on the server, when the \"simulation\" flag is\n  // not set.\n  if (!simulation && !Meteor.isServer) {\n    return;\n  }\n\n  const Class = doc.constructor;\n  const Collection = Class.getCollection();\n\n  // Restore only when document has the \"_id\" field (it's persisted).\n  if (Class.isNew(doc) || !doc._id) {\n    return 0;\n  }\n\n  // Check if a class is secured.\n  if (Class.isSecured(\"softRestore\") && Meteor.isServer && !trusted) {\n    throw new Meteor.Error(\n      403,\n      \"Soft restoring from the client is not allowed\"\n    );\n  }\n\n  // Trigger before events.\n  triggerBeforeSoftRestore(doc, trusted);\n\n  // Prepare selector.\n  const selector = {\n    _id: doc._id\n  };\n  // Prepare modifier.\n  const modifier = {\n    $set: {}\n  };\n  const behavior = Class.getBehavior(\"softremove\")[0];\n  modifier.$set[behavior.options.removedFieldName] = false;\n  if (behavior.options.hasRemovedAtField) {\n    modifier.$unset = {\n      [behavior.options.removedAtFieldName]: \"\"\n    };\n  }\n  // Restore a document.\n  const result = Collection._collection.update(selector, modifier);\n\n  // Trigger after events.\n  triggerAfterSoftRestore(doc, trusted);\n\n  return result;\n};\n\nexport default documentSoftRestore;\n","import { Event } from \"meteor/jagi:astronomy\";\n\nconst triggerAfterSoftRemove = function(doc, trusted) {\n  // Trigger the \"afterSoftRemove\" event handlers.\n  doc.dispatchEvent(\n    new Event(\"afterSoftRemove\", {\n      propagates: true,\n      trusted: trusted\n    })\n  );\n};\n\nexport default triggerAfterSoftRemove;\n","import { Event } from \"meteor/jagi:astronomy\";\n\nconst triggerAfterSoftRestore = function(doc, trusted) {\n  // Trigger the \"afterSoftRestore\" event handlers.\n  doc.dispatchEvent(\n    new Event(\"afterSoftRestore\", {\n      propagates: true,\n      trusted: trusted\n    })\n  );\n};\n\nexport default triggerAfterSoftRestore;\n","import { Event } from \"meteor/jagi:astronomy\";\n\nconst triggerBeforeSoftRemove = function(doc, trusted) {\n  // Trigger the \"beforeSoftRemove\" event handlers.\n  if (\n    !doc.dispatchEvent(\n      new Event(\"beforeSoftRemove\", {\n        cancelable: true,\n        propagates: true,\n        trusted: trusted\n      })\n    )\n  ) {\n    // If an event was prevented, then we stop here.\n    throw new Meteor.Error(\"prevented\", \"Operation prevented\", {\n      eventName: \"beforeSoftRemove\"\n    });\n  }\n};\n\nexport default triggerBeforeSoftRemove;\n","import { Event } from \"meteor/jagi:astronomy\";\n\nconst triggerBeforeSoftRestore = function(doc, trusted) {\n  // Trigger the \"beforeSoftRestore\" event handlers.\n  if (\n    !doc.dispatchEvent(\n      new Event(\"beforeSoftRestore\", {\n        cancelable: true,\n        propagates: true,\n        trusted: trusted\n      })\n    )\n  ) {\n    // If an event was prevented, then we stop here.\n    throw new Meteor.Error(\"prevented\", \"Operation prevented\", {\n      eventName: \"beforeSoftRestore\"\n    });\n  }\n};\n\nexport default triggerBeforeSoftRestore;\n"]}}]