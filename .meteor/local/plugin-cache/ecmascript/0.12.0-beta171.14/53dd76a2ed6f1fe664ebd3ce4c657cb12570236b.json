{"metadata":{},"options":{"plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":false}},{"key":"base$0$3","visitor":{"_exploded":{},"_verified":{},"PrivateName":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$6","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$0$1$1","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$4","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$5","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$6","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$7","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$9","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$11","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$12","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$13","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$14","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$15","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$16","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$17","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$18","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$19","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$20","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$21","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$22","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$23","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{}}],"presets":[],"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\imports\\ui\\pages\\user_profile\\user_profile.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining","pipelineOperator","throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"sourceFileName":"imports/ui/pages/user_profile/user_profile.js","filename":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\imports\\ui\\pages\\user_profile\\user_profile.js","passPerPreset":false,"envName":"development","cwd":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan","root":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan","generatorOpts":{"filename":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\imports\\ui\\pages\\user_profile\\user_profile.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/ui/pages/user_profile/user_profile.js"}},"code":"var User;\nmodule.watch(require(\"/imports/api/users/users.js\"), {\n  User: function (v) {\n    User = v;\n  }\n}, 0);\nvar UserSegment;\nmodule.watch(require(\"/imports/api/user_segments/user_segments.js\"), {\n  UserSegment: function (v) {\n    UserSegment = v;\n  }\n}, 1);\nmodule.watch(require(\"./user_profile.html\"));\nTemplate.user_profile.onCreated(function () {\n  var _this = this;\n\n  if (this.data.userId) {\n    this.userId = this.data.userId;\n  } else if (FlowRouter.getParam('userId')) {\n    this.userId = FlowRouter.getParam('userId');\n  } else {\n    this.userId = Meteor.userId();\n  }\n\n  this.autorun(function () {\n    _this.subscription = _this.subscribe('userData', {\n      onStop: function () {\n        console.log(\"User profile subscription stopped! \", arguments, this);\n      },\n      onReady: function () {\n        console.log(\"User profile subscription ready! \", arguments, this);\n      }\n    });\n    _this.subscription2 = _this.subscribe('userList', _this.userId, {\n      onStop: function () {\n        console.log(\"User List subscription stopped! \", arguments, this);\n      },\n      onReady: function () {\n        console.log(\"User List subscription ready! \", arguments, this);\n      }\n    });\n    console.log(_this.subscription2);\n    _this.subscription3 = _this.subscribe('segmentList', _this.userId, {\n      onStop: function () {\n        console.log(\"Segment List subscription stopped! \", arguments, this);\n      },\n      onReady: function () {\n        console.log(\"Segment List subscription ready! \", arguments, this);\n      }\n    });\n    console.log(_this.subscription3);\n  });\n});\nTemplate.user_profile.onRendered(function () {\n  Meteor.setTimeout(function () {\n    $(\"#input-bdate\").datetimepicker({\n      useCurrent: false,\n      showClear: true,\n      showClose: true,\n      format: 'YYYY-MM-DD'\n    });\n  }, 1000);\n});\nTemplate.user_profile.helpers({\n  userId: function () {\n    return Template.instance().userId;\n  },\n  userSegmentList: function () {\n    var segList = [];\n    var s = UserSegment.find();\n    s.forEach(function (m) {\n      segList.push({\n        value: m._id,\n        text: m.name\n      });\n    });\n    return segList;\n  },\n  assignedUserSegments: function () {\n    var uid = Template.instance().userId;\n    var u = User.findOne({\n      _id: uid\n    });\n    var assigned = [];\n\n    if (u) {\n      var segs = u.MyProfile.segments;\n      console.log(segs, segs[0], UserSegment.findOne({\n        _id: segs[0]\n      }));\n\n      for (var i = 0; i < segs.length; i++) {\n        var segTxt = UserSegment.findOne({\n          _id: segs[i]\n        }).name;\n        assigned.push({\n          value: segs[i],\n          text: segTxt\n        });\n      }\n    }\n\n    console.log(\"assigned:\", assigned);\n    return assigned;\n  },\n  userField: function (fldName) {\n    var uid = Template.instance().userId;\n    var u = User.findOne({\n      _id: uid\n    });\n\n    if (u) {\n      switch (fldName) {\n        case 'firstName':\n          return u.MyProfile.firstName;\n          break;\n\n        case 'lastName':\n          return u.MyProfile.lastName;\n          break;\n\n        case 'fullName':\n          return u.MyProfile.fullName();\n          break;\n\n        case 'gender':\n          return u.MyProfile.gender ? 'female' : 'male';\n          break;\n\n        case 'birthDate':\n          var d = u.MyProfile.birthDate;\n          var dateText = new Date(d.getTime() - d.getTimezoneOffset() * 60000).toISOString().slice(0, -1);\n          return dateText;\n          break;\n\n        case 'dashboardPanes':\n          return u.MyProfile.dashboardPanes.length > 0 ? 'Custom' : 'Default';\n          break;\n      }\n\n      return u.MyProfile.fullName();\n    } else {\n      return \"\";\n    }\n  },\n  genderSelected: function (label) {\n    var uid = Template.instance().userId;\n    var u = User.findOne({\n      _id: uid\n    });\n    if (!u) return \"\";\n\n    if ((\"f\" === label.slice(0, 1) || \"F\" === label.slice(0, 1)) && u.MyProfile.gender === true) {\n      return \"selected\";\n    }\n\n    if ((\"m\" === label.slice(0, 1) || \"M\" === label.slice(0, 1)) && u.MyProfile.gender === false) {\n      return \"selected\";\n    }\n\n    return \"\";\n  },\n  userName: function () {\n    var uid = Template.instance().userId;\n    var u = User.findOne({\n      _id: uid\n    });\n\n    if (u) {\n      return u.MyProfile.fullName();\n    } else {\n      return \"\";\n    }\n  },\n  emailAddress: function () {\n    var uid = Template.instance().userId;\n    var u = User.findOne({\n      _id: uid\n    });\n\n    if (u) {\n      emailAddresses = [];\n\n      for (var i = 0; i < u.emails.length; i++) {\n        emailAddresses.push(u.emails[i].address);\n      }\n\n      return emailAddresses.join(',');\n    } else {\n      return \"\";\n    }\n  },\n  itemAddHandler: function () {\n    return function (value, $item) {\n      var participant = {\n        id: value,\n        name: $item.text().slice(0, -1)\n      };\n    };\n  },\n  itemRemoveHandler: function () {\n    return function (value, $item) {//\n    };\n  }\n});\nTemplate.user_profile.events({\n  'change input.flat,textarea.flat,select': function (event, instance) {\n    $(event.target).addClass('changed');\n    $(\"#btn-group\").fadeIn();\n  },\n  'dp.change': function (event, instance) {\n    $(event.target).addClass('changed');\n    $(\"#btn-group\").fadeIn();\n  },\n  'keyup input,textarea': function (event, instance) {\n    var $t = $(event.target);\n    $t.addClass('changed');\n    $(\"#btn-group\").fadeIn();\n  },\n  'click button.btn-save': function (event, instance) {\n    var $t = $(event.target);\n    $t.closest(\".container\").find(\".changed\").removeClass(\"changed\"); //todo: update database\n\n    var uprofile = {\n      firstName: $(\"#input-fname\").val(),\n      lastName: $(\"#input-lname\").val(),\n      gender: true == $(\"#input-gender\").val(),\n      birthDate: $(\"#input-bdate\").val(),\n      segments: $(\"#select-segments\").val()\n    };\n    var uid = Template.instance().userId;\n    var u = User.findOne({\n      _id: uid\n    });\n\n    if (u) {\n      u.profileUpdate(uprofile);\n    }\n  },\n  'click button.btn-cancel': function (event, instance) {\n    var $t = $(event.target);\n    $t.closest(\".container\").find(\".changed\").removeClass(\"changed\");\n    $(\"#frm-profile\")[0].reset();\n  }\n});","map":{"version":3,"sources":["imports/ui/pages/user_profile/user_profile.js"],"names":["User","module","watch","require","v","UserSegment","Template","user_profile","onCreated","data","userId","FlowRouter","getParam","Meteor","autorun","subscription","subscribe","onStop","console","log","arguments","onReady","subscription2","subscription3","onRendered","setTimeout","$","datetimepicker","useCurrent","showClear","showClose","format","helpers","instance","userSegmentList","segList","s","find","forEach","m","push","value","_id","text","name","assignedUserSegments","uid","u","findOne","assigned","segs","MyProfile","segments","i","length","segTxt","userField","fldName","firstName","lastName","fullName","gender","d","birthDate","dateText","Date","getTime","getTimezoneOffset","toISOString","slice","dashboardPanes","genderSelected","label","userName","emailAddress","emailAddresses","emails","address","join","itemAddHandler","$item","participant","id","itemRemoveHandler","events","event","target","addClass","fadeIn","$t","closest","removeClass","uprofile","val","profileUpdate","reset"],"mappings":"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","sourcesContent":["import { User } from '/imports/api/users/users.js';\nimport { UserSegment } from '/imports/api/user_segments/user_segments.js';\nimport './user_profile.html';\n\nTemplate.user_profile.onCreated(function () {\n    if (this.data.userId) {\n        this.userId = this.data.userId;\n    } else if (FlowRouter.getParam('userId')) {\n        this.userId = FlowRouter.getParam('userId');\n    } else {\n        this.userId = Meteor.userId();\n    }\n    this.autorun( () => {\n        this.subscription = this.subscribe('userData', {\n            onStop: function () {\n                console.log(\"User profile subscription stopped! \", arguments, this);\n            },\n            onReady: function () {\n                console.log(\"User profile subscription ready! \", arguments, this);\n            }\n        });\n        this.subscription2 = this.subscribe('userList', this.userId, {\n            onStop: function () {\n                console.log(\"User List subscription stopped! \", arguments, this);\n            },\n            onReady: function () {\n                console.log(\"User List subscription ready! \", arguments, this);\n            }\n        });\n        console.log(this.subscription2);\n        this.subscription3 = this.subscribe('segmentList', this.userId, {\n            onStop: function () {\n                console.log(\"Segment List subscription stopped! \", arguments, this);\n            },\n            onReady: function () {\n                console.log(\"Segment List subscription ready! \", arguments, this);\n            }\n        });\n        console.log(this.subscription3);\n    });\n});\nTemplate.user_profile.onRendered(function () {\n    Meteor.setTimeout(function() {\n        $(\"#input-bdate\").datetimepicker({\n            useCurrent:false,\n            showClear:true,\n            showClose:true,\n            format:'YYYY-MM-DD'\n        });\n    }, 1000);\n});\n\nTemplate.user_profile.helpers({\n    userId() {\n        return Template.instance().userId;\n    },\n    userSegmentList() {\n        let segList = [];\n        let s = UserSegment.find( );\n\n        s.forEach((m) => {\n            segList.push( {\n                value: m._id,\n                text: m.name\n            });\n        });\n        return segList;\n    },\n    assignedUserSegments() {\n        let uid = Template.instance().userId;\n        let u = User.findOne( {_id:uid} );\n\n        let assigned = [];\n\n        if (u) {\n            let segs = u.MyProfile.segments;\n            console.log(segs, segs[0], UserSegment.findOne( {_id:segs[0]} ));\n            for (let i = 0; i < segs.length; i++) {\n                let segTxt = UserSegment.findOne( {_id:segs[i]} ).name;\n                assigned.push( {\n                    value: segs[i],\n                    text: segTxt\n                });\n            }\n        }\n        console.log(\"assigned:\", assigned);\n        return assigned;\n    },\n    userField(fldName) {\n        let uid = Template.instance().userId;\n        let u = User.findOne( {_id:uid} );\n        if (u) {\n            switch (fldName) {\n            case 'firstName':\n                return u.MyProfile.firstName;\n                break;\n            case 'lastName':\n                return u.MyProfile.lastName;\n                break;\n            case 'fullName':\n                return u.MyProfile.fullName();\n                break;\n            case 'gender':\n                return (u.MyProfile.gender ? 'female' : 'male');\n                break;\n            case 'birthDate':\n                let d = u.MyProfile.birthDate;\n                let dateText = new Date(d.getTime() - d.getTimezoneOffset()*60000).toISOString().slice(0,-1);\n                return dateText;\n                break;\n            case 'dashboardPanes':\n                return (u.MyProfile.dashboardPanes.length > 0 ? 'Custom' : 'Default');\n                break;\n            }\n            return u.MyProfile.fullName();\n        } else {\n            return \"\";\n        }\n    },\n    genderSelected(label) {\n        let uid = Template.instance().userId;\n        let u = User.findOne( {_id:uid} );\n        if (!u) return \"\";\n        if (\n            (\"f\" === label.slice(0,1) || \"F\" === label.slice(0,1)) &&\n            u.MyProfile.gender === true\n        ) {\n            return \"selected\";\n        }\n        if (\n            (\"m\" === label.slice(0,1) || \"M\" === label.slice(0,1)) &&\n            u.MyProfile.gender === false\n        ) {\n            return \"selected\";\n        }\n        return \"\";\n    },\n    userName() {\n        let uid = Template.instance().userId;\n        let u = User.findOne( {_id:uid} );\n        if (u) {\n            return u.MyProfile.fullName();\n        } else {\n            return \"\";\n        }\n    },\n    emailAddress() {\n        let uid = Template.instance().userId;\n        let u = User.findOne( {_id:uid} );\n        if (u) {\n            emailAddresses = [];\n            for (let i = 0; i < u.emails.length; i++) {\n                emailAddresses.push(u.emails[i].address);\n            }\n            return emailAddresses.join(',');\n        } else {\n            return \"\";\n        }\n    },\n    itemAddHandler() {\n        return (value, $item) => {\n            let participant = {\n                id: value,\n                name: $item.text().slice(0,-1)\n            };\n        }\n    },\n    itemRemoveHandler() {\n        return (value, $item) => {\n            //\n        }\n    },\n});\n\nTemplate.user_profile.events({\n    'change input.flat,textarea.flat,select'(event, instance) {\n        $(event.target).addClass('changed');\n        $(\"#btn-group\").fadeIn();\n    },\n    'dp.change'(event, instance) {\n        $(event.target).addClass('changed');\n        $(\"#btn-group\").fadeIn();\n    },\n    'keyup input,textarea'(event, instance) {\n        let $t = $(event.target);\n        $t.addClass('changed');\n        $(\"#btn-group\").fadeIn( );\n    },\n    'click button.btn-save'(event, instance) {\n        let $t = $(event.target);\n        $t.closest(\".container\").find(\".changed\").removeClass(\"changed\");\n        //todo: update database\n        let uprofile = {\n            firstName: $(\"#input-fname\").val(),\n            lastName: $(\"#input-lname\").val(),\n            gender: (true == $(\"#input-gender\").val()),\n            birthDate: $(\"#input-bdate\").val(),\n            segments: $(\"#select-segments\").val()\n        };\n        let uid = Template.instance().userId;\n        let u = User.findOne( {_id:uid} );\n        if (u) {\n            u.profileUpdate(uprofile);\n        }\n    },\n    'click button.btn-cancel'(event, instance) {\n        let $t = $(event.target);\n        $t.closest(\".container\").find(\".changed\").removeClass(\"changed\");\n        $(\"#frm-profile\")[0].reset();\n    },\n});\n"]},"sourceType":"script","hash":"53dd76a2ed6f1fe664ebd3ce4c657cb12570236b"}
