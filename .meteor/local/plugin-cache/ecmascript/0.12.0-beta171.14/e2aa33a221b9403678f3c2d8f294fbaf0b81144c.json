{"metadata":{},"options":{"plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":true}},{"key":"base$0$3","visitor":{"_exploded":{},"_verified":{},"PrivateName":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$0$1$1","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$4","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$5","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$6","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$7","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$9","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}}],"presets":[],"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\imports\\api\\team_goals\\team_goals.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining","pipelineOperator","throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"sourceFileName":"imports/api/team_goals/team_goals.js","filename":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\imports\\api\\team_goals\\team_goals.js","passPerPreset":false,"envName":"development","cwd":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan","root":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan","generatorOpts":{"filename":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\imports\\api\\team_goals\\team_goals.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/api/team_goals/team_goals.js"}},"code":"module.export({\n  TeamGoal: () => TeamGoal,\n  GoalComment: () => GoalComment\n});\nlet Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet Mongo;\nmodule.watch(require(\"meteor/mongo\"), {\n  Mongo(v) {\n    Mongo = v;\n  }\n\n}, 1);\nlet User;\nmodule.watch(require(\"../users/users.js\"), {\n  User(v) {\n    User = v;\n  }\n\n}, 2);\nlet Class, Enum;\nmodule.watch(require(\"meteor/jagi:astronomy\"), {\n  Class(v) {\n    Class = v;\n  },\n\n  Enum(v) {\n    Enum = v;\n  }\n\n}, 3);\nlet UserNotify;\nmodule.watch(require(\"/imports/api/user_notify/user_notify.js\"), {\n  UserNotify(v) {\n    UserNotify = v;\n  }\n\n}, 4);\nconst GoalComment = Class.create({\n  name: 'GoalComment',\n  fields: {\n    userId: {\n      type: String,\n      default: function () {\n        return Meteor.userId();\n      }\n    },\n    date: {\n      type: Date,\n      default: function () {\n        return new Date();\n      }\n    },\n    text: {\n      type: String,\n      default: ''\n    }\n  }\n});\nconst TeamGoal = Class.create({\n  name: 'TeamGoal',\n  collection: new Mongo.Collection('team_goal'),\n  fields: {\n    teamName: {\n      type: String,\n      default: ''\n    },\n    title: {\n      type: String,\n      default: ''\n    },\n    description: {\n      type: String,\n      default: ''\n    },\n    parentId: {\n      type: String,\n      default: ''\n    },\n    assignedTo: {\n      type: [String],\n      default: []\n    },\n    mentors: {\n      type: [String],\n      default: []\n    },\n    assignedToStr: {\n      type: String,\n      transient: true\n    },\n    mentorsStr: {\n      type: String,\n      transient: true\n    },\n    adminsStr: {\n      type: String,\n      transient: true\n    },\n    admins: {\n      type: [String],\n      default: []\n    },\n    reachedDate: {\n      type: Date,\n      optional: true\n    },\n    startDate: {\n      type: Date,\n      optional: true\n    },\n    dueDate: {\n      type: Date,\n      optional: true\n    },\n    reviewDate: {\n      type: Date,\n      optional: true\n    },\n    reviewedOnDate: {\n      type: Date,\n      optional: true\n    },\n    goalComments: {\n      type: [GoalComment],\n      default: []\n    },\n    reviewComments: {\n      type: [GoalComment],\n      default: []\n    }\n  },\n  behaviors: {\n    timestamp: {}\n  },\n  helpers: {\n    getGoalRoleGroup() {\n      return this.teamName + '+' + this._id;\n    },\n\n    userIsAdmin() {\n      if (Roles.userIsInRole(Meteor.userId(), 'admin', this.teamName) || Roles.userIsInRole(Meteor.userId(), 'admin', this.getGoalRoleGroup())) {\n        //user is either a global admin, a team admin, or a goal admin\n        return true;\n      } else {\n        return false;\n      }\n    },\n\n    userIsMentor() {\n      if (Roles.userIsInRole(Meteor.userId(), 'mentor', this.getGoalRoleGroup())) {\n        //user is a mentor for this goal\n        return true;\n      } else {\n        return false;\n      }\n    },\n\n    userIsAssigned() {\n      if (Roles.userIsInRole(Meteor.userId(), 'assigned', this.getGoalRoleGroup())) {\n        //user is assigned to this goal\n        return true;\n      } else {\n        return false;\n      }\n    },\n\n    setDateField(fieldName, rdate) {\n      if (typeof rdate === \"undefined\") {\n        rdate = new Date();\n      } else if (!(rdate instanceof Date)) {\n        return false;\n      }\n\n      this[fieldName] = rdate;\n      return true;\n    },\n\n    getUserFullNameX(userId) {\n      let u = User.findOne({\n        _id: userId\n      });\n\n      if (!u) {\n        return \"Michael\";\n      }\n\n      let name = u.MyProfile.firstName + \" \" + u.MyProfile.lastName;\n      return name;\n    },\n\n    hasModifyPerm(fieldName) {\n      switch (fieldName) {\n        //admins-only fields\n        case 'dueDate':\n        case 'startDate':\n        case 'reachedDate':\n        case 'reviewDate':\n        case 'title':\n        case 'description':\n        case 'assignedTo':\n        case 'mentors':\n        case 'admins':\n        case 'subgoals':\n          return this.userIsAdmin();\n          break;\n        //admins and mentors\n\n        case 'reviewedOnDate':\n        case 'reviewComments':\n          return this.userIsAdmin() || this.userIsMentor();\n          break;\n        //anyone assigned to the goal\n\n        case 'goalComments':\n          return this.userIsAdmin() || this.userIsMentor() || this.userIsAssigned();\n          break;\n\n        default:\n          return false;\n          break;\n      }\n    },\n\n    notifyNew(oldList, newList) {\n      let diffList = _.difference(newList, oldList);\n\n      for (let i = 0; i < diffList.length; i++) {\n        UserNotify.add({\n          userId: diffList[i],\n          title: 'Team Goals',\n          body: 'You have been added to goal ' + this.title,\n          action: 'teamgoals:' + this.teamName\n        });\n      }\n    }\n\n  },\n  events: {\n    beforeSave(e) {\n      let egoal = e.currentTarget; //any user added to a goal is automatically added to the 'view-goals' role for the team\n      //if they are already in that role, this should just ignore the redundant addUser\n\n      let flds = [\"assignedTo\", \"mentors\", \"admins\"];\n\n      for (let i in flds) {\n        if (Array.isArray(egoal[flds[i]]) && egoal[flds[i]].length > 0) {\n          Roles.addUsersToRoles(egoal[flds[i]], 'view-goals', egoal.teamName);\n        }\n      }\n    }\n\n  },\n  meteorMethods: {\n    setDueDate(rdate) {\n      //admins only\n      if (!this.userIsAdmin()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      if (this.setDateField(\"dueDate\", rdate)) {\n        this.save();\n      } else {\n        throw new Meteor.Error(403, \"Invalid date\");\n      }\n    },\n\n    setGoalReached(rdate) {\n      //admins only\n      if (!this.userIsAdmin()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      if (this.setDateField(\"reachedDate\", rdate)) {\n        this.save();\n      } else {\n        throw new Meteor.Error(403, \"Invalid date\");\n      }\n    },\n\n    setReviewDate(rdate) {\n      //admins only\n      if (!this.userIsAdmin()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      if (this.setDateField(\"reviewDate\", rdate)) {\n        this.save();\n      } else {\n        throw new Meteor.Error(403, \"Invalid date\");\n      }\n    },\n\n    setGoalReviewedOn(rdate) {\n      //mentors and admins\n      if (!this.userIsAdmin() && !this.userIsMentor()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      if (this.setDateField(\"reviewedOnDate\", rdate)) {\n        this.save();\n      } else {\n        throw new Meteor.Error(403, \"Invalid date\");\n      }\n    },\n\n    addComment(commentTxt) {\n      //mentors, admins, and assignees\n      if (!this.userIsAdmin() && !this.userIsMentor() && !this.userIsAssigned()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      this.goalComments.push(new GoalComment({\n        userId: Meteor.userId(),\n        date: new Date(),\n        text: commentTxt\n      }));\n      this.save();\n    },\n\n    addReviewComment(commentTxt) {\n      //mentors and admins\n      if (!this.userIsAdmin() && !this.userIsMentor()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      this.reviewComments.push(new GoalComment({\n        userId: Meteor.userId(),\n        date: new Date(),\n        text: commentTxt\n      }));\n      this.save();\n    },\n\n    createNewGoal() {\n      //admins only\n      if (!this.userIsAdmin()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      } //\n\n    },\n\n    setTitle(title) {\n      //admins only\n      if (!this.userIsAdmin()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      this.title = title;\n      this.save();\n    },\n\n    setDescription(descr) {\n      //admins only\n      if (!this.userIsAdmin()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      this.description = descr;\n      this.save();\n    },\n\n    setAssignedTo(ulist) {\n      //admins only\n      if (!this.userIsAdmin()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      this.notifyNew(this.assignedTo, ulist);\n      this.assignedTo = ulist;\n      this.save();\n    },\n\n    setMentors(ulist) {\n      //admins only\n      if (!this.userIsAdmin()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      this.notifyNew(this.mentors, ulist);\n      this.mentors = ulist;\n      this.save();\n    },\n\n    setAdmins(ulist) {\n      //admins only\n      if (!this.userIsAdmin()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      this.notifyNew(this.admins, ulist);\n      this.admins = ulist;\n      this.save();\n    },\n\n    getUserFullName(userId) {\n      const invocation = DDP._CurrentInvocation.get();\n\n      if (invocation.isSimulation) {\n        return \"George\";\n      }\n\n      let u = User.findOne({\n        _id: userId\n      });\n\n      if (!u) {\n        return \"Michael\";\n      }\n\n      let name = u.MyProfile.firstName + \" \" + u.MyProfile.lastName;\n      return name;\n    },\n\n    updateFromObj(updObj) {\n      let permError = false;\n\n      for (let fld in updObj) {\n        if (this[fld] !== updObj[fld] || Array.isArray(updObj[fld]) && _.isEqual(this[fld], updObj[fld])) {\n          if (this.hasModifyPerm(fld)) {\n            if (fld === \"assignedTo\" || fld === \"mentors\" || fld === \"admins\") {\n              this.notifyNew(this[fld], updObj[fld]);\n            }\n\n            this[fld] = updObj[fld];\n          } else {\n            permError = true;\n          }\n        }\n      }\n\n      this.save();\n\n      if (permError) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n    }\n\n  }\n});","map":{"version":3,"sources":["imports/api/team_goals/team_goals.js"],"names":["module","export","TeamGoal","GoalComment","Meteor","watch","require","v","Mongo","User","Class","Enum","UserNotify","create","name","fields","userId","type","String","default","date","Date","text","collection","Collection","teamName","title","description","parentId","assignedTo","mentors","assignedToStr","transient","mentorsStr","adminsStr","admins","reachedDate","optional","startDate","dueDate","reviewDate","reviewedOnDate","goalComments","reviewComments","behaviors","timestamp","helpers","getGoalRoleGroup","_id","userIsAdmin","Roles","userIsInRole","userIsMentor","userIsAssigned","setDateField","fieldName","rdate","getUserFullNameX","u","findOne","MyProfile","firstName","lastName","hasModifyPerm","notifyNew","oldList","newList","diffList","_","difference","i","length","add","body","action","events","beforeSave","e","egoal","currentTarget","flds","Array","isArray","addUsersToRoles","meteorMethods","setDueDate","Error","save","setGoalReached","setReviewDate","setGoalReviewedOn","addComment","commentTxt","push","addReviewComment","createNewGoal","setTitle","setDescription","descr","setAssignedTo","ulist","setMentors","setAdmins","getUserFullName","invocation","DDP","_CurrentInvocation","get","isSimulation","updateFromObj","updObj","permError","fld","isEqual"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Mongo } from 'meteor/mongo';\nimport { User } from '../users/users.js';\nimport { Class, Enum } from 'meteor/jagi:astronomy';\nimport { UserNotify } from '/imports/api/user_notify/user_notify.js';\n\nconst GoalComment = Class.create({\n    name: 'GoalComment',\n    fields: {\n        userId: {\n            type: String,\n            default: function() { return Meteor.userId(); }\n        },\n        date: {\n            type: Date,\n            default: function() { return new Date(); }\n        },\n        text: {\n            type: String,\n            default: ''\n        }\n    }\n});\n\nconst TeamGoal = Class.create({\n    name: 'TeamGoal',\n    collection: new Mongo.Collection('team_goal'),\n    fields: {\n        teamName: {\n            type: String,\n            default: ''\n        },\n        title: {\n            type: String,\n            default: ''\n        },\n        description: {\n            type: String,\n            default: ''\n        },\n        parentId: {\n            type: String,\n            default: ''\n        },\n        assignedTo: {\n            type: [String],\n            default: []\n        },\n        mentors: {\n            type: [String],\n            default: []\n        },\n        assignedToStr: {\n            type: String,\n            transient: true\n        },\n        mentorsStr: {\n            type: String,\n            transient: true\n        },\n        adminsStr: {\n            type: String,\n            transient: true\n        },\n        admins: {\n            type: [String],\n            default: []\n        },\n        reachedDate: {\n            type: Date,\n            optional: true\n        },\n        startDate: {\n            type: Date,\n            optional: true\n        },\n        dueDate: {\n            type: Date,\n            optional: true\n        },\n        reviewDate: {\n            type: Date,\n            optional: true\n        },\n        reviewedOnDate: {\n            type: Date,\n            optional: true\n        },\n        goalComments: {\n            type: [GoalComment],\n            default: []\n        },\n        reviewComments: {\n            type: [GoalComment],\n            default: []\n        }\n    },\n    behaviors: {\n        timestamp: {}\n    },\n    helpers: {\n        getGoalRoleGroup() {\n            return this.teamName + '+' + this._id;\n        },\n        userIsAdmin() {\n            if (\n              Roles.userIsInRole(Meteor.userId(), 'admin', this.teamName)\n             ||\n              Roles.userIsInRole(Meteor.userId(), 'admin', this.getGoalRoleGroup())\n            ) {\n                //user is either a global admin, a team admin, or a goal admin\n                return true;\n            } else {\n                return false;\n            }\n        },\n        userIsMentor() {\n            if (\n                Roles.userIsInRole(Meteor.userId(), 'mentor', this.getGoalRoleGroup())\n            ) {\n                //user is a mentor for this goal\n                return true;\n            } else {\n                return false;\n            }\n        },\n        userIsAssigned() {\n            if (\n                Roles.userIsInRole(Meteor.userId(), 'assigned', this.getGoalRoleGroup())\n            ) {\n                //user is assigned to this goal\n                return true;\n            } else {\n                return false;\n            }\n        },\n        setDateField(fieldName, rdate) {\n            if ( typeof rdate === \"undefined\") {\n                rdate = new Date();\n            } else if ( !(rdate instanceof Date) ) {\n                return false;\n            }\n            this[fieldName] = rdate;\n            return true;\n        },\n        getUserFullNameX(userId) {\n            let u = User.findOne( {_id: userId} );\n            if (!u) {\n                return \"Michael\";\n            }\n            let name = u.MyProfile.firstName + \" \" + u.MyProfile.lastName;\n            return name;\n        },\n        hasModifyPerm(fieldName) {\n            switch (fieldName) {\n            //admins-only fields\n            case 'dueDate':\n            case 'startDate':\n            case 'reachedDate':\n            case 'reviewDate':\n            case 'title':\n            case 'description':\n            case 'assignedTo':\n            case 'mentors':\n            case 'admins':\n            case 'subgoals':\n                return this.userIsAdmin();\n                break;\n            //admins and mentors\n            case 'reviewedOnDate':\n            case 'reviewComments':\n                return this.userIsAdmin() || this.userIsMentor();\n                break;\n            //anyone assigned to the goal\n            case 'goalComments':\n                return this.userIsAdmin() || this.userIsMentor() || this.userIsAssigned();\n                break;\n            default:\n                return false;\n                break;\n            }\n        },\n        notifyNew(oldList,newList) {\n            let diffList = _.difference(newList,oldList);\n            for (let i = 0; i < diffList.length; i++) {\n                UserNotify.add({\n                    userId: diffList[i],\n                    title: 'Team Goals',\n                    body: 'You have been added to goal '+this.title,\n                    action: 'teamgoals:'+this.teamName\n                });\n            }\n        }\n    },\n    events: {\n        beforeSave(e) {\n            let egoal = e.currentTarget;\n\n            //any user added to a goal is automatically added to the 'view-goals' role for the team\n            //if they are already in that role, this should just ignore the redundant addUser\n            let flds = [\"assignedTo\",\"mentors\",\"admins\"];\n            for (let i in flds) {\n                if (Array.isArray(egoal[flds[i]]) && egoal[flds[i]].length > 0) {\n                    Roles.addUsersToRoles(egoal[flds[i]], 'view-goals', egoal.teamName);\n                }\n            }\n        },\n    },\n    meteorMethods: {\n        setDueDate(rdate) {\n            //admins only\n            if ( !this.userIsAdmin() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            if ( this.setDateField(\"dueDate\", rdate) ) {\n                this.save();\n            } else {\n                throw new Meteor.Error(403, \"Invalid date\");\n            }\n        },\n        setGoalReached(rdate) {\n            //admins only\n            if ( !this.userIsAdmin() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            if ( this.setDateField(\"reachedDate\", rdate) ) {\n                this.save();\n            } else {\n                throw new Meteor.Error(403, \"Invalid date\");\n            }\n        },\n        setReviewDate(rdate) {\n            //admins only\n            if ( !this.userIsAdmin() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            if ( this.setDateField(\"reviewDate\", rdate) ) {\n                this.save();\n            } else {\n                throw new Meteor.Error(403, \"Invalid date\");\n            }\n        },\n        setGoalReviewedOn(rdate) {\n            //mentors and admins\n            if ( !this.userIsAdmin() && !this.userIsMentor()) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            if ( this.setDateField(\"reviewedOnDate\", rdate) ) {\n                this.save();\n            } else {\n                throw new Meteor.Error(403, \"Invalid date\");\n            }\n        },\n        addComment(commentTxt) {\n            //mentors, admins, and assignees\n            if ( !this.userIsAdmin() && !this.userIsMentor() && !this.userIsAssigned() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            this.goalComments.push(\n                new GoalComment( {\n                    userId: Meteor.userId(),\n                    date: new Date(),\n                    text: commentTxt,\n                } )\n            );\n            this.save();\n        },\n        addReviewComment(commentTxt) {\n            //mentors and admins\n            if ( !this.userIsAdmin() && !this.userIsMentor() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            this.reviewComments.push(\n                new GoalComment( {\n                    userId: Meteor.userId(),\n                    date: new Date(),\n                    text: commentTxt,\n                } )\n            );\n            this.save();\n        },\n        createNewGoal() {\n            //admins only\n            if ( !this.userIsAdmin() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            //\n        },\n        setTitle(title) {\n            //admins only\n            if ( !this.userIsAdmin() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            this.title = title;\n            this.save();\n        },\n        setDescription(descr) {\n            //admins only\n            if ( !this.userIsAdmin() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            this.description = descr;\n            this.save();\n        },\n        setAssignedTo(ulist) {\n            //admins only\n            if ( !this.userIsAdmin() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            this.notifyNew(this.assignedTo,ulist);\n            this.assignedTo = ulist;\n            this.save();\n        },\n        setMentors(ulist) {\n            //admins only\n            if ( !this.userIsAdmin() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n            this.notifyNew(this.mentors,ulist);\n            this.mentors = ulist;\n            this.save();\n        },\n        setAdmins(ulist) {\n            //admins only\n            if ( !this.userIsAdmin() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            this.notifyNew(this.admins,ulist);\n            this.admins = ulist;\n            this.save();\n        },\n        getUserFullName(userId) {\n            const invocation = DDP._CurrentInvocation.get();\n            if (invocation.isSimulation) {\n                return \"George\";\n            }\n            let u = User.findOne( {_id: userId} );\n            if (!u) {\n                return \"Michael\";\n            }\n            let name = u.MyProfile.firstName + \" \" + u.MyProfile.lastName;\n            return name;\n        },\n        updateFromObj(updObj) {\n            let permError = false;\n\n            for (let fld in updObj) {\n                if (\n                  this[fld] !== updObj[fld] ||\n                  (Array.isArray(updObj[fld]) && _.isEqual(this[fld], updObj[fld]))\n                ) {\n                    if (this.hasModifyPerm(fld)) {\n                        if (fld === \"assignedTo\" || fld === \"mentors\" || fld === \"admins\") {\n                            this.notifyNew(this[fld],updObj[fld]);\n                        }\n                        this[fld] = updObj[fld];\n                    } else {\n                        permError = true;\n                    }\n                }\n            }\n            this.save();\n            if (permError) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n        }\n    }\n});\n\nexport { TeamGoal, GoalComment };\n"]},"sourceType":"script","hash":"e2aa33a221b9403678f3c2d8f294fbaf0b81144c"}
