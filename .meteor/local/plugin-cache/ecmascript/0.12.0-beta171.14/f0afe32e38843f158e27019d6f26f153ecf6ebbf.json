{"metadata":{},"options":{"plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":true}},{"key":"base$0$3","visitor":{"_exploded":{},"_verified":{},"PrivateName":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$0$1$1","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$4","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$5","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$6","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$7","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$9","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}}],"presets":[],"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\imports\\ui\\pages\\learn_share\\learn_share.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining","pipelineOperator","throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"sourceFileName":"imports/ui/pages/learn_share/learn_share.js","filename":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\imports\\ui\\pages\\learn_share\\learn_share.js","passPerPreset":false,"envName":"development","cwd":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan","root":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan","generatorOpts":{"filename":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\imports\\ui\\pages\\learn_share\\learn_share.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/ui/pages/learn_share/learn_share.js"}},"code":"let User;\nmodule.watch(require(\"/imports/api/users/users.js\"), {\n  User(v) {\n    User = v;\n  }\n\n}, 0);\nlet LearnShareSession;\nmodule.watch(require(\"/imports/api/learn_share/learn_share.js\"), {\n  LearnShareSession(v) {\n    LearnShareSession = v;\n  }\n\n}, 1);\nlet Team;\nmodule.watch(require(\"/imports/api/teams/teams.js\"), {\n  Team(v) {\n    Team = v;\n  }\n\n}, 2);\nmodule.watch(require(\"./learn_share.html\"));\nmodule.watch(require(\"/imports/ui/components/label_list/label_list.js\"));\n\nvar generateGuestId = () => {\n  var text = \"guest-\";\n  var idLength = 11;\n  var possible = \"acdeghijklmnopqrstuvwxyzACDEGHIJKLMNOPQRSTUVWXYZ0123456789\";\n\n  for (var i = 0; i < idLength; i++) {\n    text += possible.charAt(Math.floor(Math.random() * possible.length));\n  }\n\n  return text;\n};\n\nvar app;\nvar client_id = '8e7e8c57-117c-454a-bf71-7ec493ab82b1';\nvar meeting;\nvar version = \"appdeveloperlevel/0.59\";\n\nfunction initSkypeAPI() {\n  console.log(sessionStorage);\n  debugger;\n  var hasToken = /^#access_token=/.test(location.hash) || !!sessionStorage.apiAccessToken;\n  var hasError = /^#error=/.test(location.hash);\n\n  if (!hasToken && !hasError) {\n    let pathParts = location.pathname.split('/');\n    sessionStorage.lastLearnShareId = pathParts[pathParts.length - 1];\n    console.log(sessionStorage);\n    location.assign('https://login.microsoftonline.com/common/oauth2/authorize?response_type=token' + '&client_id=' + client_id + '&redirect_uri=' + location.origin + '/learnShare' + '&resource=https://webdir.online.lync.com');\n  } else {\n    if (!sessionStorage.apiAccessToken) {\n      var tokenresponse = parseHashParams(window.location.hash);\n      sessionStorage.apiAccessToken = tokenresponse.access_token;\n      window.location.hash = '#';\n    }\n\n    Skype.initialize({\n      apiKey: 'a42fcebd-5b43-4b89-a065-74450fb91255',\n      correlationIds: {\n        sessionId: 'mySession123' // Necessary for troubleshooting requests, should be unique per session\n\n      }\n    }, function (api) {\n      console.log(\"wwwwwwwwwwwwwwwwwwwwwww\");\n      app = new api.application();\n      console.log(app);\n      apiSignIn();\n    });\n  }\n}\n\nfunction parseHashParams(hash) {\n  var params = hash.slice(1).split('&');\n  var paramarray = {};\n  params.forEach(function (param) {\n    param = param.split('=');\n    paramarray[param[0]] = param[1];\n  });\n  return paramarray;\n}\n\nfunction apiSignIn() {\n  console.log(1234, app);\n  var application = app; // the SDK will get its own access token\n\n  app.signInManager.signIn({\n    client_id: client_id,\n    cors: true,\n    redirect_uri: '/learnShare',\n    origins: [\"https://webdir.online.lync.com/autodiscover/autodiscoverservice.svc/root\"],\n    version: version // Necessary for troubleshooting requests; identifies your application in our telemetry\n\n  }).then(function (a) {\n    console.log(\"signed in\", a);\n    createMeeting();\n  }, function (err) {\n    $(\"#span-create-skype\").html(\"(<a href='#' id='a-create-call'>Create skype meeting</a>)\");\n    console.log(\"sign in error\", err);\n  });\n}\n\nfunction createMeeting() {\n  meeting = app.conversationsManager.createMeeting();\n  meeting.subject('LearnShare Meeting');\n  meeting.accessLevel('Everyone');\n  console.log('0', meeting);\n  meeting.onlineMeetingUri.get().then(function (uri) {\n    console.log('1', uri); //var conversation = app.conversationsManager.getConversationByUri(uri);\n    //console.log(\"what?\",conversation);\n\n    let uriChunks = uri.split(':');\n    let skypeUser = uriChunks[1].split(';')[0];\n    let emlUser = skypeUser.split('@')[0];\n    let emlDomain = skypeUser.split('@')[1];\n    let mtgId = uriChunks[uriChunks.length - 1];\n    let url = 'https://meet.lync.com/' + emlDomain + '/' + emlUser + '/' + mtgId;\n    console.log(url);\n    $(\"#input-skype-url\").val(url);\n    $(\"#span-create-skype\").html(\"(<a href='#' id='a-create-call'>Create skype meeting</a>)\");\n    $(\"#input-skype-url\").trigger(\"change\");\n  }, function (err) {\n    $(\"#span-create-skype\").html(\"(<a href='#' id='a-create-call'>Create skype meeting</a>)\");\n    console.log(err);\n  });\n}\n\nTemplate.learn_share.onCreated(function () {\n  this.lssid = FlowRouter.getParam('lssid');\n\n  if (!Meteor.user()) {\n    //user not logged in, treat as guest\n    let gname = Session.get(\"guestName\");\n\n    if (\"undefined\" === typeof gname) {\n      let gid = generateGuestId(); //Session.setPersistent(\"guestName\", 'lurker'+gid.slice(5,10));\n      //Session.setPersistent(\"guestId\", gid);\n    }\n  }\n\n  this.autorun(() => {\n    console.log(\"autorunning learn_share...\");\n    this.subscription = this.subscribe('userList', Meteor.userId(), {\n      onStop: function () {\n        console.log(\"User List subscription stopped! \", arguments, this);\n      },\n      onReady: function () {\n        console.log(\"User List subscription ready! \", arguments, this);\n        let userList = [];\n        User.find().forEach(user => {\n          userList.push({\n            text: user.MyProfile.firstName + \" \" + user.MyProfile.lastName,\n            value: user._id\n          });\n        });\n      }\n    });\n    console.log(this.subscription);\n    this.subscription2 = this.subscribe('learnShareDetails', this.lssid, {\n      onStop: function () {\n        console.log(\"LearnShare List subscription stopped! \", arguments, this);\n      },\n      onReady: function () {\n        console.log(\"LearnShare List subscription ready! \", arguments, this);\n        let lssess = LearnShareSession.findOne({\n          _id: this.params[0]\n        });\n\n        if (\"locked\" !== lssess.state) {\n          if (Meteor.user()) {\n            lssess.addParticipantSelf();\n            lssess = LearnShareSession.findOne({\n              _id: this.params[0]\n            });\n            let selectControl = $(\"#select-participants\")[0].selectize;\n\n            for (let i = 0; i < lssess.participants.length; i++) {\n              selectControl.addItem(lssess.participants[i].id);\n            }\n\n            for (let i = 0; i < lssess.presenters.length; i++) {\n              $(\".item[data-value=\" + lssess.presenters[i].id + \"]\").addClass(\"picked\");\n            }\n\n            if ($(\".item[data-value]\").not(\".picked\").length === 0) {\n              $(\"#btn-pick-first\").prop(\"disabled\", true);\n            } else {\n              $(\"#btn-pick-first\").prop(\"disabled\", false);\n            }\n          } else {\n            lssess.saveGuest(Session.get(\"guestId\"), Session.get(\"guestName\"));\n          }\n        }\n      }\n    });\n    console.log(this.subscription2);\n    this.subscription3 = this.subscribe('teamsData', Meteor.userId(), {\n      onStop: function () {\n        console.log(\"teamsData subscription stopped! \", arguments, this);\n      },\n      onReady: function () {\n        console.log(\"teamsData subscription ready! \", arguments, this);\n      }\n    });\n    console.log(this.subscription3);\n  });\n});\nTemplate.learn_share.onRendered(() => {\n  Meteor.setTimeout(() => {\n    if (/^#access_token=/.test(location.hash)) {\n      console.log(\"hhhhhhhhhhhhhhhhhhhhhhhhhhhhhh\");\n      $(\"#a-skype-url-edit\").trigger(\"click\");\n      Meteor.setTimeout(() => {\n        $(\"#a-create-call\").trigger(\"click\");\n      }, 500);\n    }\n\n    $('#modal-edit-name').on('shown.bs.modal', function () {\n      $('#input-guest-name').focus();\n    });\n    $(document).on('click', '#selectize-outer-select-guests .selectize-input .item', function (event) {\n      let $target = $(event.target);\n      let participant = {\n        id: $target.data(\"value\"),\n        name: $target.text().slice(0, -1)\n      };\n      let lssid = $(\"#select-participants\").closest(\"[data-lssid]\").data(\"lssid\");\n      let ls = LearnShareSession.findOne({\n        _id: lssid\n      });\n\n      if (!ls) {\n        return;\n      }\n\n      ls.removeGuest(participant.id);\n      ls.addParticipant(participant);\n    });\n    $(document).on('click', '#selectize-outer-select-participants .selectize-input .item', function (event) {\n      let $target = $(event.target);\n      let participant = {\n        id: $target.data(\"value\"),\n        name: $target.text().slice(0, -1)\n      };\n      let lssid = $(\"#select-participants\").closest(\"[data-lssid]\").data(\"lssid\");\n      let ls = LearnShareSession.findOne({\n        _id: lssid\n      });\n\n      if (!ls) {\n        return;\n      }\n\n      ls.saveGuest(participant);\n      ls.removeParticipant(participant.id);\n    });\n  }, 500);\n});\nTemplate.learn_share.helpers({\n  userList() {\n    let u = User.find().fetch();\n    return u;\n  },\n\n  canEdit() {\n    let lssid = Template.instance().lssid;\n    let lssess = LearnShareSession.findOne({\n      _id: lssid\n    });\n\n    if (!lssess) {\n      return false;\n    }\n\n    if (lssess.state === \"locked\" || !Meteor.user()) {\n      return false;\n    }\n\n    return true;\n  },\n\n  canEditAdmin() {\n    let lssid = Template.instance().lssid;\n    let lssess = LearnShareSession.findOne({\n      _id: lssid\n    });\n\n    if (!lssess) {\n      return false;\n    }\n\n    if (lssess.state === \"locked\" || !Roles.userIsInRole(Meteor.userId(), ['admin', 'learn-share-host'], Roles.GLOBAL_GROUP)) {\n      return false;\n    }\n\n    return true;\n  },\n\n  sessionPresenters() {\n    let lssid = Template.instance().lssid;\n    let lssess = LearnShareSession.findOne({\n      _id: lssid\n    });\n\n    if (!lssess) {\n      return [];\n    } else {\n      return lssess.presenters;\n    }\n  },\n\n  sessionParticipants() {\n    let lssid = Template.instance().lssid;\n    let lssess = LearnShareSession.findOne({\n      _id: lssid\n    });\n\n    if (!lssess) {\n      return [];\n    } else {\n      return lssess.participants;\n    }\n  },\n\n  sessionParticipantItems() {\n    let lssid = Template.instance().lssid;\n    let lssess = LearnShareSession.findOne({\n      _id: lssid\n    });\n\n    if (!lssess) {\n      return [];\n    }\n\n    let participants = lssess.participants;\n    let participantIds = [];\n\n    for (let i = 0; i < participants.length; i++) {\n      participantIds.push({\n        value: participants[i].id,\n        text: participants[i].name\n      });\n    }\n\n    return participantIds;\n  },\n\n  sessionGuests() {\n    let lssid = Template.instance().lssid;\n    let lssess = LearnShareSession.findOne({\n      _id: lssid\n    });\n\n    if (!lssess) {\n      return [];\n    } else {\n      return lssess.guests;\n    }\n  },\n\n  sessionGuestItems() {\n    let lssid = Template.instance().lssid;\n    let lssess = LearnShareSession.findOne({\n      _id: lssid\n    });\n\n    if (!lssess) {\n      return [];\n    }\n\n    let guests = lssess.guests;\n    let guestIds = [];\n\n    for (let i = 0; i < guests.length; i++) {\n      guestIds.push({\n        value: guests[i].id,\n        text: guests[i].name\n      });\n    }\n\n    return guestIds;\n  },\n\n  roParticipantNames() {\n    let lssid = Template.instance().lssid;\n    let lssess = LearnShareSession.findOne({\n      _id: lssid\n    });\n\n    if (!lssess) {\n      return [];\n    }\n\n    let participants = lssess.participants;\n    let participantList = [];\n\n    for (let i = 0; i < participants.length; i++) {\n      participantList.push(participants[i].name);\n    }\n\n    return participantList;\n  },\n\n  userAddList(teamName) {\n    let u = User.find();\n    let addList = [];\n    u.forEach(m => {\n      addList.push({\n        value: m._id,\n        text: m.MyProfile.firstName + \" \" + m.MyProfile.lastName\n      });\n    });\n    return addList;\n  },\n\n  itemRemoveHandler() {\n    return (value, $item) => {\n      let numSelected = $(\"#select-participants\")[0].selectize.items.length;\n\n      if (numSelected === 0) {\n        $(\"#btn-pick-first\").attr(\"disabled\", true);\n      }\n\n      let lssid = $(\"#select-participants\").closest(\"[data-lssid]\").data(\"lssid\");\n      let ls = LearnShareSession.findOne({\n        _id: lssid\n      });\n\n      if (!ls) {\n        return;\n      }\n\n      ls.removeParticipant(value);\n    };\n  },\n\n  itemRemoveGuestHandler() {\n    return (value, $item) => {\n      let lssid = $(\"#select-guests\").closest(\"[data-lssid]\").data(\"lssid\");\n      let ls = LearnShareSession.findOne({\n        _id: lssid\n      });\n\n      if (!ls) {\n        return;\n      }\n\n      ls.removeGuest(value);\n    };\n  },\n\n  itemAddHandler() {\n    return (value, $item) => {\n      $(\"#btn-pick-first\").prop(\"disabled\", false);\n      let participant = {\n        id: value,\n        name: $item.text().slice(0, -1)\n      };\n      let id = $item.closest('[data-lssid]').data('lssid');\n      let ls = LearnShareSession.findOne({\n        _id: id\n      });\n\n      if (!ls) {\n        return;\n      }\n\n      if (typeof _.find(ls.presenters, function (o) {\n        return o.id === participant.id;\n      }) !== \"undefined\") {\n        //if added user is in the list of presenters, mark it\n        $item.addClass(\"picked\");\n      }\n\n      if (\"guest\" === participant.id.slice(0, 5)) {\n        $item.addClass(\"guest\");\n      }\n\n      ls.addParticipant(participant);\n    };\n  },\n\n  itemAddGuestHandler() {\n    return (value, $item) => {\n      $(\"#btn-pick-first\").prop(\"disabled\", false);\n      let participant = {\n        id: value,\n        name: $item.text().slice(0, -1)\n      };\n      let id = $item.closest('[data-lssid]').data('lssid');\n      let ls = LearnShareSession.findOne({\n        _id: id\n      });\n\n      if (!ls) {\n        return;\n      }\n\n      if (typeof _.find(ls.presenters, function (o) {\n        return o.id === participant.id;\n      }) !== \"undefined\") {\n        //if added user is in the list of presenters, mark it\n        $item.addClass(\"picked\");\n      }\n\n      if (\"guest\" === participant.id.slice(0, 5)) {\n        $item.addClass(\"guest\");\n      }\n\n      ls.saveGuest(participant);\n    };\n  },\n\n  order(idx) {\n    return idx + 1;\n  },\n\n  lssid() {\n    return Template.instance().lssid;\n  },\n\n  title() {\n    let lssid = Template.instance().lssid;\n    let lssess = LearnShareSession.findOne({\n      _id: lssid\n    });\n\n    if (lssess) {\n      return lssess.title;\n    }\n  },\n\n  teamId() {\n    let lssid = Template.instance().lssid;\n    let lssess = LearnShareSession.findOne({\n      _id: lssid\n    });\n\n    if (lssess) {\n      return lssess.teamId;\n    } else {\n      return \"\";\n    }\n  },\n\n  team() {\n    let lssid = Template.instance().lssid;\n    let lssess = LearnShareSession.findOne({\n      _id: lssid\n    });\n\n    if (lssess) {\n      return Team.findOne({\n        _id: lssess.teamId\n      });\n    } else {\n      return \"\";\n    }\n  },\n\n  teamName() {\n    let lssid = Template.instance().lssid;\n    let lssess = LearnShareSession.findOne({\n      _id: lssid\n    });\n\n    if (lssess) {\n      return Team.findOne({\n        _id: lssess.teamId\n      }).Name;\n    } else {\n      return \"\";\n    }\n  },\n\n  sessionActive() {\n    let lssid = Template.instance().lssid;\n    let lssess = LearnShareSession.findOne({\n      _id: lssid\n    });\n\n    if (lssess) {\n      if (lssess.state == \"locked\") {\n        return false;\n      } else {\n        return true;\n      }\n    }\n  },\n\n  notes() {\n    let lssid = Template.instance().lssid;\n    let lssess = LearnShareSession.findOne({\n      _id: lssid\n    });\n\n    if (lssess) {\n      return lssess.notes;\n    }\n  },\n\n  skypeUrl() {\n    let lssid = Template.instance().lssid;\n    let lssess = LearnShareSession.findOne({\n      _id: lssid\n    });\n\n    if (lssess) {\n      return lssess.skypeUrl;\n    }\n  },\n\n  guestName() {\n    return Session.get(\"guestName\").split('-')[1];\n  }\n\n});\n\nvar pickRandom = () => {\n  let selectControl = $(\"#select-participants\")[0].selectize;\n  let availableItems = [];\n\n  for (let i = 0; i < selectControl.items.length; i++) {\n    let $item = $(\".item[data-value=\" + selectControl.items[i] + \"]\");\n\n    if (!$item.hasClass(\"picked\") && !$item.hasClass(\"picking\")) {\n      availableItems.push($item);\n    }\n  }\n\n  if (availableItems.length === 0) {\n    //don't pick the same item twice in a row unless it's the last one\n    $item = $(\".item.picking[data-value]\");\n\n    if ($item.length && !$item.hasClass(\"picked\")) {\n      availableItems.push($(\".item.picking[data-value]\"));\n    }\n  }\n\n  if (availableItems.length <= 1) {\n    $(\"#btn-pick-first\").prop(\"disabled\", true);\n  }\n\n  if (availableItems.length === 0) {\n    //none left to pick\n    return '';\n  }\n\n  var $picking = availableItems[Math.floor(Math.random() * availableItems.length)];\n  $(\"#p-on-deck-info\").data(\"picking\", $picking.data(\"value\"));\n  $(\"#p-on-deck-info\").html($picking.text().slice(0, -1));\n  $picking.addClass(\"picking\");\n  return $picking.data(\"value\");\n};\n\nTemplate.learn_share.events({\n  'change .file-upload-input'(event, instance) {\n    var file = event.currentTarget.files[0];\n    var reader = new FileReader();\n\n    reader.onload = function (fileLoadEvent) {\n      let lssid = $(\".container[data-lssid]\").data(\"lssid\");\n      let lssess = LearnShareSession.findOne({\n        _id: lssid\n      });\n      lssess.uploadRecording(file, reader.result);\n    };\n\n    reader.readAsBinaryString(file);\n  },\n\n  'click button#btn-pick-first'(event, instance) {\n    var pickingId = pickRandom();\n\n    if (pickingId !== '') {\n      $(\"#p-on-deck\").show();\n      $(\"#p-pick-first\").hide();\n    }\n  },\n\n  'click button#btn-pick-again'(event, instance) {\n    let prevPickingId = $(\"#p-on-deck-info\").data(\"picking\");\n    var pickingId = pickRandom();\n\n    if (prevPickingId != pickingId) {\n      let $prevPicked = $(\".item[data-value=\" + prevPickingId + \"]\");\n      $prevPicked.removeClass(\"picking\");\n    }\n  },\n\n  'click button#btn-pick-accept'(event, instance) {\n    let pickedId = $(\"#p-on-deck-info\").data(\"picking\");\n    let picked = {};\n    let $pickedItem = $(\".item[data-value=\" + pickedId + \"]\");\n    picked.id = $pickedItem.data(\"value\");\n    picked.name = $pickedItem.text().slice(0, -1);\n    $pickedItem.removeClass(\"picking\").addClass(\"picked\");\n    $(\"#p-on-deck-info\").data(\"picking\", \"\");\n    $(\"#p-on-deck-info\").html(\"\");\n    $(\"#p-on-deck\").hide();\n    $(\"#p-pick-first\").show();\n\n    if ($(\".item[data-value]\").not(\".picked\").length === 0) {\n      $(\"#btn-pick-first\").attr(\"disabled\", true);\n    }\n\n    let lssid = Template.instance().lssid;\n    let lssess = LearnShareSession.findOne({\n      _id: lssid\n    });\n    lssess.addPresenter(picked);\n  },\n\n  'keypress #input-notes,#input-title'(event, instance) {\n    if (!Roles.userIsInRole(Meteor.userId(), ['admin', 'learn-share-host'], Roles.GLOBAL_GROUP)) {\n      event.preventDefault();\n    }\n  },\n\n  'keyup #input-notes,#input-title': _.debounce(function (event, instance) {\n    if (Roles.userIsInRole(Meteor.userId(), ['admin', 'learn-share-host'], Roles.GLOBAL_GROUP)) {\n      let lssid = $(\".container[data-lssid]\").data(\"lssid\");\n      let lssess = LearnShareSession.findOne({\n        _id: lssid\n      });\n      lssess.saveText($(\"#input-title\").val(), $(\"#input-notes\").val());\n    }\n  }, 2000),\n\n  'click button#modal-save-name'(event, instance) {\n    let lssid = $(\".container[data-lssid]\").data(\"lssid\");\n    let lssess = LearnShareSession.findOne({\n      _id: lssid\n    });\n    let guestName = \"guest-\" + $(\"#input-guest-name\").val(); //Session.setPersistent(\"guestName\",guestName);\n\n    lssess.saveGuest(Session.get(\"guestId\"), guestName);\n    $(\"#modal-edit-name\").modal(\"hide\");\n  },\n\n  'click a#lockSession'(event, instance) {\n    event.preventDefault();\n    let lssid = $(\".container[data-lssid]\").data(\"lssid\");\n    let lssess = LearnShareSession.findOne({\n      _id: lssid\n    });\n    lssess.saveText($(\"#input-title\").val(), $(\"#input-notes\").val());\n    lssess.lockSession();\n  },\n\n  'click a#unlockSession'(event, instance) {\n    event.preventDefault();\n\n    if (Roles.userIsInRole(Meteor.userId(), ['admin', 'learn-share-host'], Roles.GLOBAL_GROUP)) {\n      let lssid = $(\".container[data-lssid]\").data(\"lssid\");\n      let lssess = LearnShareSession.findOne({\n        _id: lssid\n      });\n      lssess.unlockSession();\n    }\n  },\n\n  'click a#a-skype-url-edit'(event, instance) {\n    event.preventDefault();\n\n    if (Roles.userIsInRole(Meteor.userId(), ['admin', 'learn-share-host'], Roles.GLOBAL_GROUP)) {\n      $(\"#a-skype-url\").hide();\n      $(\"#a-skype-url-edit\").hide();\n      $(\"#input-skype-url\").show();\n      $(\"#span-create-skype\").show();\n    }\n  },\n\n  'click a#a-create-call'(event, instance) {\n    event.preventDefault();\n    console.log(\"click create call\");\n    $(\"#span-create-skype\").html(\"<img src='/img/loading.gif' style='height:20px;width:20px;' /><span style='font-size:xx-small;'>contacting Skype</span>\");\n    initSkypeAPI();\n  },\n\n  'change input#input-skype-url'(event, instance) {\n    let lssid = $(\".container[data-lssid]\").data(\"lssid\");\n    let lssess = LearnShareSession.findOne({\n      _id: lssid\n    });\n    lssess.setSkypeUrl($(\"#input-skype-url\").val());\n    $(\"#a-skype-url\").show();\n    $(\"#a-skype-url-edit\").show();\n    $(\"#input-skype-url\").hide();\n    $(\"#span-create-skype\").hide();\n  }\n\n});","map":{"version":3,"sources":["imports/ui/pages/learn_share/learn_share.js"],"names":["User","module","watch","require","v","LearnShareSession","Team","generateGuestId","text","idLength","possible","i","charAt","Math","floor","random","length","app","client_id","meeting","version","initSkypeAPI","console","log","sessionStorage","hasToken","test","location","hash","apiAccessToken","hasError","pathParts","pathname","split","lastLearnShareId","assign","origin","tokenresponse","parseHashParams","window","access_token","Skype","initialize","apiKey","correlationIds","sessionId","api","application","apiSignIn","params","slice","paramarray","forEach","param","signInManager","signIn","cors","redirect_uri","origins","then","a","createMeeting","err","$","html","conversationsManager","subject","accessLevel","onlineMeetingUri","get","uri","uriChunks","skypeUser","emlUser","emlDomain","mtgId","url","val","trigger","Template","learn_share","onCreated","lssid","FlowRouter","getParam","Meteor","user","gname","Session","gid","autorun","subscription","subscribe","userId","onStop","arguments","onReady","userList","find","push","MyProfile","firstName","lastName","value","_id","subscription2","lssess","findOne","state","addParticipantSelf","selectControl","selectize","participants","addItem","id","presenters","addClass","not","prop","saveGuest","subscription3","onRendered","setTimeout","on","focus","document","event","$target","target","participant","data","name","closest","ls","removeGuest","addParticipant","removeParticipant","helpers","u","fetch","canEdit","instance","canEditAdmin","Roles","userIsInRole","GLOBAL_GROUP","sessionPresenters","sessionParticipants","sessionParticipantItems","participantIds","sessionGuests","guests","sessionGuestItems","guestIds","roParticipantNames","participantList","userAddList","teamName","addList","m","itemRemoveHandler","$item","numSelected","items","attr","itemRemoveGuestHandler","itemAddHandler","_","o","itemAddGuestHandler","order","idx","title","teamId","team","Name","sessionActive","notes","skypeUrl","guestName","pickRandom","availableItems","hasClass","$picking","events","file","currentTarget","files","reader","FileReader","onload","fileLoadEvent","uploadRecording","result","readAsBinaryString","pickingId","show","hide","prevPickingId","$prevPicked","removeClass","pickedId","picked","$pickedItem","addPresenter","preventDefault","debounce","saveText","modal","lockSession","unlockSession","setSkypeUrl"],"mappings":"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","sourcesContent":["import { User } from '/imports/api/users/users.js';\nimport { LearnShareSession } from '/imports/api/learn_share/learn_share.js';\nimport { Team } from '/imports/api/teams/teams.js';\nimport './learn_share.html';\nimport '/imports/ui/components/label_list/label_list.js';\n\nvar generateGuestId = () => {\n    var text = \"guest-\";\n    var idLength = 11;\n    var possible = \"acdeghijklmnopqrstuvwxyzACDEGHIJKLMNOPQRSTUVWXYZ0123456789\";\n\n    for (var i = 0; i < idLength; i++) {\n        text += possible.charAt(Math.floor(Math.random() * possible.length));\n    }\n\n    return text;\n}\n\nvar app;\nvar client_id = '8e7e8c57-117c-454a-bf71-7ec493ab82b1';\nvar meeting;\nvar version = \"appdeveloperlevel/0.59\";\n\nfunction initSkypeAPI() {\n    console.log(sessionStorage);\n    debugger;\n    var hasToken = /^#access_token=/.test(location.hash) || !!sessionStorage.apiAccessToken;\n    var hasError = /^#error=/.test(location.hash);\n    if (!hasToken && !hasError) {\n        let pathParts = location.pathname.split('/');\n        sessionStorage.lastLearnShareId = pathParts[pathParts.length-1];\n        console.log(sessionStorage);\n        location.assign('https://login.microsoftonline.com/common/oauth2/authorize?response_type=token' +\n            '&client_id=' + client_id +\n            '&redirect_uri=' + location.origin + '/learnShare' +\n            '&resource=https://webdir.online.lync.com');\n    } else {\n        if (!sessionStorage.apiAccessToken) {\n            var tokenresponse = parseHashParams(window.location.hash);\n            sessionStorage.apiAccessToken = tokenresponse.access_token;\n            window.location.hash = '#';\n        }\n        Skype.initialize(\n            {\n                apiKey: 'a42fcebd-5b43-4b89-a065-74450fb91255',\n                correlationIds: {\n                    sessionId: 'mySession123', // Necessary for troubleshooting requests, should be unique per session\n                }\n            },\n            function (api) {\n                console.log(\"wwwwwwwwwwwwwwwwwwwwwww\");\n                app = new api.application();\n                console.log(app);\n                apiSignIn();\n            }\n        );\n    }\n}\nfunction parseHashParams(hash) {\n    var params = hash.slice(1).split('&');\n\n    var paramarray = {};\n    params.forEach(function(param) {\n        param = param.split('=');\n        paramarray[param[0]] = param[1];\n    });\n\n    return paramarray;\n}\nfunction apiSignIn() {\n    console.log(1234,app);\n    var application = app;\n    // the SDK will get its own access token\n    app.signInManager.signIn({\n        client_id: client_id,\n        cors: true,\n        redirect_uri: '/learnShare',\n        origins: [ \"https://webdir.online.lync.com/autodiscover/autodiscoverservice.svc/root\" ],\n        version: version // Necessary for troubleshooting requests; identifies your application in our telemetry\n    }).then(\n        function(a) {\n            console.log(\"signed in\", a);\n            createMeeting();\n        },\n        function(err) {\n            $(\"#span-create-skype\").html(\"(<a href='#' id='a-create-call'>Create skype meeting</a>)\");\n            console.log(\"sign in error\", err);\n        }\n    )\n}\nfunction createMeeting() {\n    meeting = app.conversationsManager.createMeeting();\n    meeting.subject('LearnShare Meeting');\n    meeting.accessLevel('Everyone');\n    console.log('0',meeting);\n    meeting.onlineMeetingUri.get().then(\n        function(uri) {\n            console.log('1',uri);\n            //var conversation = app.conversationsManager.getConversationByUri(uri);\n            //console.log(\"what?\",conversation);\n            let uriChunks = uri.split(':');\n            let skypeUser = uriChunks[1].split(';')[0];\n            let emlUser = skypeUser.split('@')[0];\n            let emlDomain = skypeUser.split('@')[1];\n            let mtgId = uriChunks[uriChunks.length-1];\n            let url = 'https://meet.lync.com/'+emlDomain+'/'+emlUser+'/'+mtgId;\n            console.log(url);\n            $(\"#input-skype-url\").val(url);\n            $(\"#span-create-skype\").html(\"(<a href='#' id='a-create-call'>Create skype meeting</a>)\");\n            $(\"#input-skype-url\").trigger(\"change\");\n        },\n        function(err) {\n            $(\"#span-create-skype\").html(\"(<a href='#' id='a-create-call'>Create skype meeting</a>)\");\n            console.log(err);\n        }\n    );\n}\n\nTemplate.learn_share.onCreated(function () {\n    this.lssid = FlowRouter.getParam('lssid');\n    if (!Meteor.user()) {\n        //user not logged in, treat as guest\n        let gname = Session.get(\"guestName\");\n        if (\"undefined\" === typeof gname) {\n            let gid = generateGuestId();\n            //Session.setPersistent(\"guestName\", 'lurker'+gid.slice(5,10));\n            //Session.setPersistent(\"guestId\", gid);\n        }\n    }\n\n    this.autorun( () => {\n        console.log(\"autorunning learn_share...\");\n\n        this.subscription = this.subscribe('userList', Meteor.userId(), {\n            onStop: function () {\n                console.log(\"User List subscription stopped! \", arguments, this);\n            },\n            onReady: function () {\n                console.log(\"User List subscription ready! \", arguments, this);\n\n                let userList = [];\n\n                User.find().forEach( (user) => {\n                    userList.push({\n                        text: user.MyProfile.firstName + \" \" + user.MyProfile.lastName,\n                        value: user._id\n                    });\n                });\n            }\n        });\n        console.log(this.subscription);\n\n        this.subscription2 = this.subscribe('learnShareDetails', this.lssid, {\n            onStop: function () {\n                console.log(\"LearnShare List subscription stopped! \", arguments, this);\n            },\n            onReady: function () {\n                console.log(\"LearnShare List subscription ready! \", arguments, this);\n                let lssess = LearnShareSession.findOne( {_id: this.params[0]} );\n                if (\"locked\" !== lssess.state) {\n                    if (Meteor.user()) {\n                        lssess.addParticipantSelf();\n                        lssess = LearnShareSession.findOne( {_id: this.params[0]} );\n                        let selectControl = $(\"#select-participants\")[0].selectize;\n                        for (let i = 0; i < lssess.participants.length; i++) {\n                            selectControl.addItem(lssess.participants[i].id);\n                        }\n                        for (let i = 0; i < lssess.presenters.length; i++) {\n                            $(\".item[data-value=\"+lssess.presenters[i].id+\"]\").addClass(\"picked\");\n                        }\n                        if ($(\".item[data-value]\").not(\".picked\").length === 0) {\n                            $(\"#btn-pick-first\").prop(\"disabled\", true);\n                        } else {\n                            $(\"#btn-pick-first\").prop(\"disabled\", false);\n                        }\n                    } else {\n                        lssess.saveGuest(Session.get(\"guestId\"),Session.get(\"guestName\"));\n                    }\n                }\n            }\n        });\n        console.log(this.subscription2);\n\n        this.subscription3 = this.subscribe('teamsData', Meteor.userId(), {\n            onStop: function () {\n                console.log(\"teamsData subscription stopped! \", arguments, this);\n            },\n            onReady: function () {\n                console.log(\"teamsData subscription ready! \", arguments, this);\n            }\n        });\n        console.log(this.subscription3);\n    });\n\n});\n\nTemplate.learn_share.onRendered( () => {\n    Meteor.setTimeout(() => {\n        if (/^#access_token=/.test(location.hash)) {\n            console.log(\"hhhhhhhhhhhhhhhhhhhhhhhhhhhhhh\");\n            $(\"#a-skype-url-edit\").trigger(\"click\");\n            Meteor.setTimeout(() => {\n                $(\"#a-create-call\").trigger(\"click\");\n            }, 500);\n        }\n        $('#modal-edit-name').on('shown.bs.modal', function () {\n            $('#input-guest-name').focus();\n        });\n        $(document).on('click','#selectize-outer-select-guests .selectize-input .item', function (event) {\n            let $target = $(event.target);\n            let participant = {\n                id: $target.data(\"value\"),\n                name: $target.text().slice(0,-1)\n            };\n            let lssid = $(\"#select-participants\").closest(\"[data-lssid]\").data(\"lssid\");\n            let ls = LearnShareSession.findOne( {_id: lssid} );\n            if (!ls) {\n                return;\n            }\n            ls.removeGuest(participant.id);\n            ls.addParticipant(participant);\n        });\n        $(document).on('click','#selectize-outer-select-participants .selectize-input .item', function (event) {\n            let $target = $(event.target);\n            let participant = {\n                id: $target.data(\"value\"),\n                name: $target.text().slice(0,-1)\n            };\n            let lssid = $(\"#select-participants\").closest(\"[data-lssid]\").data(\"lssid\");\n            let ls = LearnShareSession.findOne( {_id: lssid} );\n            if (!ls) {\n                return;\n            }\n            ls.saveGuest(participant);\n            ls.removeParticipant(participant.id);\n        });\n    }, 500);\n});\n\nTemplate.learn_share.helpers({\n    userList() {\n        let u = User.find().fetch();\n        return u;\n    },\n    canEdit() {\n        let lssid = Template.instance().lssid;\n        let lssess = LearnShareSession.findOne( {_id:lssid} );\n        if (!lssess) {\n            return false;\n        }\n        if (lssess.state === \"locked\" || !Meteor.user()) {\n            return false;\n        }\n        return true;\n    },\n    canEditAdmin() {\n        let lssid = Template.instance().lssid;\n        let lssess = LearnShareSession.findOne( {_id:lssid} );\n        if (!lssess) {\n            return false;\n        }\n        if (lssess.state === \"locked\" || !Roles.userIsInRole(Meteor.userId(), ['admin','learn-share-host'], Roles.GLOBAL_GROUP)) {\n            return false;\n        }\n        return true;\n    },\n    sessionPresenters() {\n        let lssid = Template.instance().lssid;\n        let lssess = LearnShareSession.findOne( {_id:lssid} );\n        if (!lssess) {\n            return [];\n        } else {\n            return lssess.presenters;\n        }\n    },\n    sessionParticipants() {\n        let lssid = Template.instance().lssid;\n        let lssess = LearnShareSession.findOne( {_id:lssid} );\n        if (!lssess) {\n            return [];\n        } else {\n            return lssess.participants;\n        }\n    },\n    sessionParticipantItems() {\n        let lssid = Template.instance().lssid;\n        let lssess = LearnShareSession.findOne( {_id:lssid} );\n\n        if (!lssess) {\n            return [];\n        }\n\n        let participants = lssess.participants;\n        let participantIds = [];\n        for (let i = 0; i < participants.length; i++) {\n            participantIds.push({value: participants[i].id, text: participants[i].name});\n        }\n        return participantIds;\n    },\n    sessionGuests() {\n        let lssid = Template.instance().lssid;\n        let lssess = LearnShareSession.findOne( {_id:lssid} );\n        if (!lssess) {\n            return [];\n        } else {\n            return lssess.guests;\n        }\n    },\n    sessionGuestItems() {\n        let lssid = Template.instance().lssid;\n        let lssess = LearnShareSession.findOne( {_id:lssid} );\n\n        if (!lssess) {\n            return [];\n        }\n\n        let guests = lssess.guests;\n        let guestIds = [];\n        for (let i = 0; i < guests.length; i++) {\n            guestIds.push({value: guests[i].id, text: guests[i].name});\n        }\n        return guestIds;\n    },\n    roParticipantNames() {\n        let lssid = Template.instance().lssid;\n        let lssess = LearnShareSession.findOne( {_id:lssid} );\n\n        if (!lssess) {\n            return [];\n        }\n\n        let participants = lssess.participants;\n        let participantList = [];\n        for (let i = 0; i < participants.length; i++) {\n            participantList.push(participants[i].name);\n        }\n        return participantList;\n    },\n    userAddList(teamName) {\n        let u = User.find( );\n        let addList = [];\n        u.forEach((m) => {\n            addList.push( {\n                value: m._id,\n                text: m.MyProfile.firstName + \" \" + m.MyProfile.lastName\n            });\n        });\n        return addList;\n    },\n    itemRemoveHandler() {\n        return (value, $item) => {\n            let numSelected = $(\"#select-participants\")[0].selectize.items.length;\n            if (numSelected === 0) {\n                $(\"#btn-pick-first\").attr(\"disabled\", true);\n            }\n            let lssid = $(\"#select-participants\").closest(\"[data-lssid]\").data(\"lssid\");\n            let ls = LearnShareSession.findOne( {_id: lssid} );\n            if (!ls) {\n                return;\n            }\n            ls.removeParticipant(value);\n        }\n    },\n    itemRemoveGuestHandler() {\n        return (value, $item) => {\n            let lssid = $(\"#select-guests\").closest(\"[data-lssid]\").data(\"lssid\");\n            let ls = LearnShareSession.findOne( {_id: lssid} );\n            if (!ls) {\n                return;\n            }\n            ls.removeGuest(value);\n        }\n    },\n    itemAddHandler() {\n        return (value, $item) => {\n            $(\"#btn-pick-first\").prop(\"disabled\",false);\n            let participant = {\n                id: value,\n                name: $item.text().slice(0,-1)\n            };\n            let id = $item.closest('[data-lssid]').data('lssid');\n            let ls = LearnShareSession.findOne( {_id: id} );\n            if (!ls) {\n                return;\n            }\n            if (typeof _.find(ls.presenters, function(o) {return o.id===participant.id}) !== \"undefined\") {\n                //if added user is in the list of presenters, mark it\n                $item.addClass(\"picked\");\n            }\n            if (\"guest\" === participant.id.slice(0,5)) {\n                $item.addClass(\"guest\");\n            }\n            ls.addParticipant(participant);\n        }\n    },\n    itemAddGuestHandler() {\n        return (value, $item) => {\n            $(\"#btn-pick-first\").prop(\"disabled\",false);\n            let participant = {\n                id: value,\n                name: $item.text().slice(0,-1)\n            };\n            let id = $item.closest('[data-lssid]').data('lssid');\n            let ls = LearnShareSession.findOne( {_id: id} );\n            if (!ls) {\n                return;\n            }\n            if (typeof _.find(ls.presenters, function(o) {return o.id===participant.id}) !== \"undefined\") {\n                //if added user is in the list of presenters, mark it\n                $item.addClass(\"picked\");\n            }\n            if (\"guest\" === participant.id.slice(0,5)) {\n                $item.addClass(\"guest\");\n            }\n            ls.saveGuest(participant);\n        }\n    },\n    order(idx) {\n        return idx + 1;\n    },\n    lssid() {\n        return Template.instance().lssid;\n    },\n    title() {\n        let lssid = Template.instance().lssid;\n        let lssess = LearnShareSession.findOne( {_id:lssid} );\n        if (lssess) {\n            return lssess.title;\n        }\n    },\n    teamId() {\n        let lssid = Template.instance().lssid;\n        let lssess = LearnShareSession.findOne( {_id:lssid} );\n        if (lssess) {\n            return lssess.teamId;\n        } else {\n            return \"\";\n        }\n    },\n    team() {\n        let lssid = Template.instance().lssid;\n        let lssess = LearnShareSession.findOne( {_id:lssid} );\n        if (lssess) {\n            return Team.findOne( {_id:lssess.teamId} );\n        } else {\n            return \"\";\n        }\n    },\n    teamName() {\n        let lssid = Template.instance().lssid;\n        let lssess = LearnShareSession.findOne( {_id:lssid} );\n        if (lssess) {\n            return Team.findOne( {_id:lssess.teamId} ).Name;\n        } else {\n            return \"\";\n        }\n    },\n    sessionActive() {\n        let lssid = Template.instance().lssid;\n        let lssess = LearnShareSession.findOne( {_id:lssid} );\n        if (lssess) {\n            if (lssess.state == \"locked\") {\n                return false;\n            } else {\n                return true;\n            }\n        }\n    },\n    notes() {\n        let lssid = Template.instance().lssid;\n        let lssess = LearnShareSession.findOne( {_id:lssid} );\n        if (lssess) {\n            return lssess.notes;\n        }\n    },\n    skypeUrl() {\n        let lssid = Template.instance().lssid;\n        let lssess = LearnShareSession.findOne( {_id:lssid} );\n        if (lssess) {\n            return lssess.skypeUrl;\n        }\n    },\n    guestName() {\n        return Session.get(\"guestName\").split('-')[1];\n    }\n});\n\nvar pickRandom = () => {\n    let selectControl = $(\"#select-participants\")[0].selectize;\n\n    let availableItems = [];\n    for (let i = 0; i < selectControl.items.length; i++) {\n        let $item = $(\".item[data-value=\"+selectControl.items[i]+\"]\");\n        if (!$item.hasClass(\"picked\") && !$item.hasClass(\"picking\")) {\n            availableItems.push($item);\n        }\n    }\n    if (availableItems.length === 0) {\n        //don't pick the same item twice in a row unless it's the last one\n        $item = $(\".item.picking[data-value]\");\n        if ($item.length && !$item.hasClass(\"picked\")) {\n            availableItems.push($(\".item.picking[data-value]\"));\n        }\n    }\n\n    if (availableItems.length <= 1) {\n        $(\"#btn-pick-first\").prop(\"disabled\", true);\n    }\n\n    if (availableItems.length === 0) {\n        //none left to pick\n        return '';\n    }\n    var $picking = availableItems[Math.floor(Math.random()*availableItems.length)];\n    $(\"#p-on-deck-info\").data(\"picking\", $picking.data(\"value\"));\n    $(\"#p-on-deck-info\").html($picking.text().slice(0,-1));\n    $picking.addClass(\"picking\");\n    return $picking.data(\"value\");\n}\nTemplate.learn_share.events({\n    'change .file-upload-input'(event, instance) {\n        var file = event.currentTarget.files[0];\n        var reader = new FileReader();\n        reader.onload = function(fileLoadEvent) {\n            let lssid = $(\".container[data-lssid]\").data(\"lssid\");\n            let lssess = LearnShareSession.findOne( {_id:lssid} );\n            lssess.uploadRecording(file, reader.result);\n        };\n        reader.readAsBinaryString(file);\n    },\n    'click button#btn-pick-first'(event, instance) {\n        var pickingId = pickRandom();\n        if (pickingId !== '') {\n            $(\"#p-on-deck\").show();\n            $(\"#p-pick-first\").hide();\n        }\n    },\n    'click button#btn-pick-again'(event, instance) {\n        let prevPickingId = $(\"#p-on-deck-info\").data(\"picking\");\n        var pickingId = pickRandom();\n\n        if (prevPickingId != pickingId) {\n            let $prevPicked = $(\".item[data-value=\"+prevPickingId+\"]\");\n            $prevPicked.removeClass(\"picking\");\n        }\n    },\n    'click button#btn-pick-accept'(event, instance) {\n        let pickedId = $(\"#p-on-deck-info\").data(\"picking\");\n        let picked = {};\n        let $pickedItem = $(\".item[data-value=\"+pickedId+\"]\");\n        picked.id = $pickedItem.data(\"value\");\n        picked.name = $pickedItem.text().slice(0,-1);\n        $pickedItem.removeClass(\"picking\").addClass(\"picked\");\n        $(\"#p-on-deck-info\").data(\"picking\",\"\");\n        $(\"#p-on-deck-info\").html(\"\");\n        $(\"#p-on-deck\").hide();\n        $(\"#p-pick-first\").show();\n        if ($(\".item[data-value]\").not(\".picked\").length === 0) {\n            $(\"#btn-pick-first\").attr(\"disabled\", true);\n        }\n\n        let lssid = Template.instance().lssid;\n        let lssess = LearnShareSession.findOne( {_id:lssid} );\n        lssess.addPresenter(picked);\n    },\n    'keypress #input-notes,#input-title'(event, instance) {\n        if (!Roles.userIsInRole(Meteor.userId(), ['admin','learn-share-host'], Roles.GLOBAL_GROUP)) {\n            event.preventDefault();\n        }\n    },\n    'keyup #input-notes,#input-title':_.debounce(function (event, instance) {\n        if (Roles.userIsInRole(Meteor.userId(), ['admin','learn-share-host'], Roles.GLOBAL_GROUP)) {\n            let lssid = $(\".container[data-lssid]\").data(\"lssid\");\n            let lssess = LearnShareSession.findOne( {_id:lssid} );\n            lssess.saveText($(\"#input-title\").val(), $(\"#input-notes\").val());\n        }\n    }, 2000),\n    'click button#modal-save-name'(event, instance) {\n        let lssid = $(\".container[data-lssid]\").data(\"lssid\");\n        let lssess = LearnShareSession.findOne( {_id:lssid} );\n        let guestName = \"guest-\"+$(\"#input-guest-name\").val();\n        //Session.setPersistent(\"guestName\",guestName);\n        lssess.saveGuest(Session.get(\"guestId\"), guestName);\n        $(\"#modal-edit-name\").modal(\"hide\");\n    },\n    'click a#lockSession'(event,instance) {\n        event.preventDefault();\n        let lssid = $(\".container[data-lssid]\").data(\"lssid\");\n        let lssess = LearnShareSession.findOne( {_id:lssid} );\n        lssess.saveText($(\"#input-title\").val(), $(\"#input-notes\").val());\n        lssess.lockSession();\n    },\n    'click a#unlockSession'(event,instance) {\n        event.preventDefault();\n        if (Roles.userIsInRole(Meteor.userId(), ['admin','learn-share-host'], Roles.GLOBAL_GROUP)) {\n            let lssid = $(\".container[data-lssid]\").data(\"lssid\");\n            let lssess = LearnShareSession.findOne( {_id:lssid} );\n            lssess.unlockSession();\n        }\n    },\n    'click a#a-skype-url-edit'(event,instance) {\n        event.preventDefault();\n        if (Roles.userIsInRole(Meteor.userId(), ['admin','learn-share-host'], Roles.GLOBAL_GROUP)) {\n            $(\"#a-skype-url\").hide();\n            $(\"#a-skype-url-edit\").hide();\n            $(\"#input-skype-url\").show();\n            $(\"#span-create-skype\").show();\n        }\n    },\n    'click a#a-create-call'(event,instance) {\n        event.preventDefault();\n        console.log(\"click create call\");\n        $(\"#span-create-skype\").html(\"<img src='/img/loading.gif' style='height:20px;width:20px;' /><span style='font-size:xx-small;'>contacting Skype</span>\")\n        initSkypeAPI();\n    },\n    'change input#input-skype-url'(event,instance) {\n        let lssid = $(\".container[data-lssid]\").data(\"lssid\");\n        let lssess = LearnShareSession.findOne( {_id:lssid} );\n        lssess.setSkypeUrl($(\"#input-skype-url\").val());\n        $(\"#a-skype-url\").show();\n        $(\"#a-skype-url-edit\").show();\n        $(\"#input-skype-url\").hide();\n        $(\"#span-create-skype\").hide();\n    }\n});\n"]},"sourceType":"script","hash":"f0afe32e38843f158e27019d6f26f153ecf6ebbf"}
