{"metadata":{},"options":{"plugins":[{"key":"base$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$1$1","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"base$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$2","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$3","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":true}},{"key":"base$0$4","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$8","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"base$0$9","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$10","visitor":{"_exploded":{},"_verified":{},"PrivateName":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}}],"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\packages\\jagi:astronomy\\lib\\modules\\storage\\hooks\\apply_definition.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining","pipelineOperator","throwExpressions","jsx",["flow",{}],["flow",{}],"objectRestSpread","objectRestSpread","dynamicImport","asyncGenerators","classProperties","classPrivateProperties"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"sourceFileName":"packages/jagi:astronomy/lib/modules/storage/hooks/apply_definition.js","filename":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\packages\\jagi:astronomy\\lib\\modules\\storage\\hooks\\apply_definition.js","passPerPreset":false,"envName":"development","cwd":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan","root":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan","presets":[],"generatorOpts":{"filename":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\packages\\jagi:astronomy\\lib\\modules\\storage\\hooks\\apply_definition.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/jagi:astronomy/lib/modules/storage/hooks/apply_definition.js"}},"code":"let _each;\n\nmodule.watch(require(\"lodash/each\"), {\n  default(v) {\n    _each = v;\n  }\n\n}, 0);\n\nlet _extend;\n\nmodule.watch(require(\"lodash/extend\"), {\n  default(v) {\n    _extend = v;\n  }\n\n}, 1);\n\nlet _zipObject;\n\nmodule.watch(require(\"lodash/zipObject\"), {\n  default(v) {\n    _zipObject = v;\n  }\n\n}, 2);\nlet resolveValues;\nmodule.watch(require(\"../../fields/utils/resolveValues\"), {\n  default(v) {\n    resolveValues = v;\n  }\n\n}, 3);\nlet hasMeteorMethod;\nmodule.watch(require(\"../utils/has_meteor_method\"), {\n  default(v) {\n    hasMeteorMethod = v;\n  }\n\n}, 4);\nlet find, findOne;\nmodule.watch(require(\"../class_static_methods/find\"), {\n  find(v) {\n    find = v;\n  },\n\n  findOne(v) {\n    findOne = v;\n  }\n\n}, 5);\nlet insert;\nmodule.watch(require(\"../class_static_methods/insert\"), {\n  default(v) {\n    insert = v;\n  }\n\n}, 6);\nlet update;\nmodule.watch(require(\"../class_static_methods/update\"), {\n  default(v) {\n    update = v;\n  }\n\n}, 7);\nlet upsert;\nmodule.watch(require(\"../class_static_methods/upsert\"), {\n  default(v) {\n    upsert = v;\n  }\n\n}, 8);\nlet remove;\nmodule.watch(require(\"../class_static_methods/remove\"), {\n  default(v) {\n    remove = v;\n  }\n\n}, 9);\nlet protoSave;\nmodule.watch(require(\"../class_prototype_methods/save\"), {\n  default(v) {\n    protoSave = v;\n  }\n\n}, 10);\nlet protoRemove;\nmodule.watch(require(\"../class_prototype_methods/remove\"), {\n  default(v) {\n    protoRemove = v;\n  }\n\n}, 11);\nlet protoReload;\nmodule.watch(require(\"../class_prototype_methods/reload\"), {\n  default(v) {\n    protoReload = v;\n  }\n\n}, 12);\nlet protoCopy;\nmodule.watch(require(\"../class_prototype_methods/copy\"), {\n  default(v) {\n    protoCopy = v;\n  }\n\n}, 13);\nlet protoGetModifier;\nmodule.watch(require(\"../class_prototype_methods/getModifier\"), {\n  default(v) {\n    protoGetModifier = v;\n  }\n\n}, 14);\nlet protoGetModified;\nmodule.watch(require(\"../class_prototype_methods/getModified\"), {\n  default(v) {\n    protoGetModified = v;\n  }\n\n}, 15);\nlet protoGetModifiedValues;\nmodule.watch(require(\"../class_prototype_methods/getModifiedValues\"), {\n  default(v) {\n    protoGetModifiedValues = v;\n  }\n\n}, 16);\nlet protoIsModified;\nmodule.watch(require(\"../class_prototype_methods/isModified\"), {\n  default(v) {\n    protoIsModified = v;\n  }\n\n}, 17);\nlet meteorInsert;\nmodule.watch(require(\"../meteor_methods/insert\"), {\n  default(v) {\n    meteorInsert = v;\n  }\n\n}, 18);\nlet meteorUpdate;\nmodule.watch(require(\"../meteor_methods/update\"), {\n  default(v) {\n    meteorUpdate = v;\n  }\n\n}, 19);\nlet meteorUpsert;\nmodule.watch(require(\"../meteor_methods/upsert\"), {\n  default(v) {\n    meteorUpsert = v;\n  }\n\n}, 20);\nlet meteorRemove;\nmodule.watch(require(\"../meteor_methods/remove\"), {\n  default(v) {\n    meteorRemove = v;\n  }\n\n}, 21);\nlet fromJSONValue;\nmodule.watch(require(\"../class_events/fromJSONValue\"), {\n  default(v) {\n    fromJSONValue = v;\n  }\n\n}, 22);\nlet toJSONValue;\nmodule.watch(require(\"../class_events/toJSONValue\"), {\n  default(v) {\n    toJSONValue = v;\n  }\n\n}, 23);\n\nfunction onApplyDefinition(Class, parsedDefinition, className) {\n  const schema = Class.schema;\n\n  if (parsedDefinition.collection) {\n    const Collection = schema.collection = parsedDefinition.collection; // Get type of the \"_id\" field.\n\n    const id = Collection._makeNewID();\n\n    const IdType = id.constructor;\n    Class.extend({\n      // Add the \"_id\" field if not already added.\n      fields: {\n        _id: {\n          name: '_id',\n          type: IdType,\n          optional: true\n        }\n      },\n      // Add storage events.\n      events: {\n        toJSONValue: [toJSONValue],\n        fromJSONValue: [fromJSONValue]\n      }\n    }, ['fields', 'events']); // If it's a remote collection then we register methods on the connection\n    // object of the collection.\n\n    const connection = Collection._connection;\n\n    if (connection) {\n      // Prepare meteor methods to be added.\n      const meteorMethods = {\n        '/Astronomy/insert': meteorInsert,\n        '/Astronomy/update': meteorUpdate,\n        '/Astronomy/upsert': meteorUpsert,\n        '/Astronomy/remove': meteorRemove\n      };\n\n      _each(meteorMethods, (meteorMethod, methodName) => {\n        if (!hasMeteorMethod(connection, methodName)) {\n          // Add meteor method.\n          connection.methods(_zipObject([methodName], [meteorMethod]));\n        }\n      });\n    } // Class static methods.\n\n\n    Class.find = find;\n    Class.findOne = findOne;\n    Class.insert = insert;\n    Class.update = update;\n    Class.upsert = upsert;\n    Class.remove = remove; // Class prototype methods.\n\n    Class.prototype.save = protoSave;\n    Class.prototype.remove = protoRemove;\n    Class.prototype.reload = protoReload;\n    Class.prototype.copy = protoCopy;\n    Class.prototype.getModifier = protoGetModifier;\n    Class.prototype.getModified = protoGetModified;\n    Class.prototype.getModifiedValues = protoGetModifiedValues;\n    Class.prototype.isModified = protoIsModified;\n  } // Apply type field.\n\n\n  if (parsedDefinition.typeField) {\n    const typeField = schema.typeField = parsedDefinition.typeField; // Add the type field if not already added.\n\n    if (!Class.hasField(typeField)) {\n      Class.extend({\n        fields: {\n          [typeField]: {\n            type: String,\n            index: 1\n          }\n        },\n        events: {\n          afterInit(e) {\n            const doc = e.currentTarget;\n            const Class = doc.constructor;\n            doc[typeField] = Class.getName();\n          }\n\n        }\n      }, ['fields', 'events']);\n    }\n\n    if (parsedDefinition.typeField) {\n      schema.typeField = parsedDefinition.typeField;\n    }\n  } // If class has already assigned collection.\n\n\n  const Collection = Class.getCollection();\n\n  if (Collection) {\n    // Apply the \"transform\" property only if it's a function or equal null.\n    if (typeof parsedDefinition.transform === 'function' || parsedDefinition.transform === null) {\n      schema.transform = parsedDefinition.transform;\n    }\n\n    if (parsedDefinition.secured !== undefined) {\n      _extend(schema.secured, parsedDefinition.secured);\n    }\n  }\n}\n\n;\nmodule.exportDefault(onApplyDefinition);","map":{"version":3,"sources":["packages/jagi:astronomy/lib/modules/storage/hooks/apply_definition.js"],"names":["_each","module","watch","require","default","v","_extend","_zipObject","resolveValues","hasMeteorMethod","find","findOne","insert","update","upsert","remove","protoSave","protoRemove","protoReload","protoCopy","protoGetModifier","protoGetModified","protoGetModifiedValues","protoIsModified","meteorInsert","meteorUpdate","meteorUpsert","meteorRemove","fromJSONValue","toJSONValue","onApplyDefinition","Class","parsedDefinition","className","schema","collection","Collection","id","_makeNewID","IdType","constructor","extend","fields","_id","name","type","optional","events","connection","_connection","meteorMethods","meteorMethod","methodName","methods","prototype","save","reload","copy","getModifier","getModified","getModifiedValues","isModified","typeField","hasField","String","index","afterInit","e","doc","currentTarget","getName","getCollection","transform","secured","undefined","exportDefault"],"mappings":"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","sourcesContent":["import _each from 'lodash/each';\nimport _extend from 'lodash/extend';\nimport _zipObject from 'lodash/zipObject';\n// Utils.\nimport resolveValues from '../../fields/utils/resolveValues';\nimport hasMeteorMethod from '../utils/has_meteor_method';\n// Class static methods.\nimport { find, findOne } from '../class_static_methods/find';\nimport insert from '../class_static_methods/insert';\nimport update from '../class_static_methods/update';\nimport upsert from '../class_static_methods/upsert';\nimport remove from '../class_static_methods/remove';\n// Class prototype methods.\nimport protoSave from '../class_prototype_methods/save';\nimport protoRemove from '../class_prototype_methods/remove';\nimport protoReload from '../class_prototype_methods/reload';\nimport protoCopy from '../class_prototype_methods/copy';\nimport protoGetModifier from '../class_prototype_methods/getModifier';\nimport protoGetModified from '../class_prototype_methods/getModified';\nimport protoGetModifiedValues from '../class_prototype_methods/getModifiedValues';\nimport protoIsModified from '../class_prototype_methods/isModified';\n// Meteor methods.\nimport meteorInsert from '../meteor_methods/insert';\nimport meteorUpdate from '../meteor_methods/update';\nimport meteorUpsert from '../meteor_methods/upsert';\nimport meteorRemove from '../meteor_methods/remove';\n// Class events.\nimport fromJSONValue from '../class_events/fromJSONValue';\nimport toJSONValue from '../class_events/toJSONValue';\n\nfunction onApplyDefinition(Class, parsedDefinition, className) {\n  const schema = Class.schema;\n\n  if (parsedDefinition.collection) {\n    const Collection = schema.collection = parsedDefinition.collection;\n    // Get type of the \"_id\" field.\n    const id = Collection._makeNewID();\n    const IdType = id.constructor;\n\n    Class.extend({\n      // Add the \"_id\" field if not already added.\n      fields: {\n        _id: {\n          name: '_id',\n          type: IdType,\n          optional: true\n        }\n      },\n      // Add storage events.\n      events: {\n        toJSONValue: [toJSONValue],\n        fromJSONValue: [fromJSONValue]\n      }\n    }, ['fields', 'events']);\n\n    // If it's a remote collection then we register methods on the connection\n    // object of the collection.\n    const connection = Collection._connection;\n    if (connection) {\n      // Prepare meteor methods to be added.\n      const meteorMethods = {\n        '/Astronomy/insert': meteorInsert,\n        '/Astronomy/update': meteorUpdate,\n        '/Astronomy/upsert': meteorUpsert,\n        '/Astronomy/remove': meteorRemove,\n      };\n      _each(meteorMethods, (meteorMethod, methodName) => {\n        if (!hasMeteorMethod(connection, methodName)) {\n          // Add meteor method.\n          connection.methods(_zipObject([methodName], [meteorMethod]));\n        }\n      });\n    }\n\n    // Class static methods.\n    Class.find = find;\n    Class.findOne = findOne;\n    Class.insert = insert;\n    Class.update = update;\n    Class.upsert = upsert;\n    Class.remove = remove;\n    // Class prototype methods.\n    Class.prototype.save = protoSave;\n    Class.prototype.remove = protoRemove;\n    Class.prototype.reload = protoReload;\n    Class.prototype.copy = protoCopy;\n    Class.prototype.getModifier = protoGetModifier;\n    Class.prototype.getModified = protoGetModified;\n    Class.prototype.getModifiedValues = protoGetModifiedValues;\n    Class.prototype.isModified = protoIsModified;\n  }\n\n  // Apply type field.\n  if (parsedDefinition.typeField) {\n    const typeField = schema.typeField = parsedDefinition.typeField;\n    // Add the type field if not already added.\n    if (!Class.hasField(typeField)) {\n      Class.extend({\n        fields: {\n          [typeField]: {\n            type: String,\n            index: 1\n          }\n        },\n        events: {\n          afterInit(e) {\n            const doc = e.currentTarget;\n            const Class = doc.constructor;\n            doc[typeField] = Class.getName();\n          }\n        }\n      }, ['fields', 'events']);\n    }\n\n    if (parsedDefinition.typeField) {\n      schema.typeField = parsedDefinition.typeField;\n    }\n  }\n\n  // If class has already assigned collection.\n  const Collection = Class.getCollection();\n  if (Collection) {\n    // Apply the \"transform\" property only if it's a function or equal null.\n    if (\n      typeof parsedDefinition.transform === 'function' ||\n      parsedDefinition.transform === null\n    ) {\n      schema.transform = parsedDefinition.transform;\n    }\n\n    if (parsedDefinition.secured !== undefined) {\n      _extend(schema.secured, parsedDefinition.secured);\n    }\n  }\n};\n\nexport default onApplyDefinition;"]},"sourceType":"script","hash":"0f5f34418941e042f1b6edfd7628df42c48e4066"}
