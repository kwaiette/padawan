{"metadata":{},"options":{"plugins":[{"key":"base$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$1$1","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"base$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$2","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$3","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":true}},{"key":"base$0$4","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$8","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"base$0$9","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$10","visitor":{"_exploded":{},"_verified":{},"PrivateName":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}}],"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\imports\\api\\questions\\server\\publications.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining","pipelineOperator","throwExpressions","jsx",["flow",{}],["flow",{}],"objectRestSpread","objectRestSpread","dynamicImport","asyncGenerators","classProperties","classPrivateProperties"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"sourceFileName":"imports/api/questions/server/publications.js","filename":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\imports\\api\\questions\\server\\publications.js","passPerPreset":false,"envName":"development","cwd":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan","root":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan","presets":[],"generatorOpts":{"filename":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\imports\\api\\questions\\server\\publications.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/api/questions/server/publications.js"}},"code":"let Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet Question, Reading, MyersBriggsCategory;\nmodule.watch(require(\"../questions.js\"), {\n  Question(v) {\n    Question = v;\n  },\n\n  Reading(v) {\n    Reading = v;\n  },\n\n  MyersBriggsCategory(v) {\n    MyersBriggsCategory = v;\n  }\n\n}, 1);\nlet User, MyersBriggs, Answer, UserType, Profile;\nmodule.watch(require(\"../../users/users.js\"), {\n  User(v) {\n    User = v;\n  },\n\n  MyersBriggs(v) {\n    MyersBriggs = v;\n  },\n\n  Answer(v) {\n    Answer = v;\n  },\n\n  UserType(v) {\n    UserType = v;\n  },\n\n  Profile(v) {\n    Profile = v;\n  }\n\n}, 2);\nMeteor.publishComposite('questions.bycategory', function (category) {\n  if (!Roles.userIsInRole(this.userId, ['admin'], Roles.GLOBAL_GROUP)) {\n    return this.ready();\n  }\n\n  console.log(\"Publication 'questions.bycategory': \", category, this.userId);\n  return {\n    find() {\n      return Question.find({\n        Categories: category\n      }, {\n        defaults: true,\n        sort: {\n          createdAt: -1\n        }\n      });\n    },\n\n    children: [{\n      find(question) {\n        return User.find({\n          _id: question.CreatedBy\n        }, {\n          limit: 1\n        });\n      }\n\n    }]\n  };\n});\nMeteor.publish('questions.toanswer', function (userId, refresh) {\n  //console.log(userId, this.userId);\n  //if(this.userId !== userId && !Roles.userIsInRole(this.userId, ['admin'], Roles.GLOBAL_GROUP)) { return this.ready(); }\n  console.log(\"Publication 'questions.toanswer': \", this.userId, userId);\n  let self = this;\n  let user = User.findOne({\n    _id: userId\n  });\n  let qids = user.MyProfile.UserType.getAnsweredQuestionsIDs(); //console.log(self, user, qids);\n\n  let observe = {\n    added: function (id, fields) {\n      self.added('questions', id, fields);\n    },\n    changed: function (id, fields) {\n      self.removed(\"questions\", id);\n    },\n    removed: function (id) {\n      self.removed('questions', id);\n    }\n  };\n  let ids = [0, 1, 2, 3];\n  ids.sort(function (a, b) {\n    let ar = Math.random();\n    let br = Math.random();\n\n    if (ar === br) {\n      return 0;\n    }\n\n    return ar > br ? -1 : 1;\n  });\n  handles = [null, null, null, null];\n\n  for (let i = 0; i < ids.length; i++) {\n    handles[ids[i]] = Question.find({\n      Categories: ids[i],\n      _id: {\n        $nin: qids\n      },\n      Active: true\n    }, {\n      limit: 1\n    }).observeChanges(observe);\n  }\n\n  self.ready();\n  self.onStop(function () {\n    for (let i = 0; i < ids.length; i++) {\n      handles[i].stop();\n    }\n  });\n});","map":{"version":3,"sources":["imports/api/questions/server/publications.js"],"names":["Meteor","module","watch","require","v","Question","Reading","MyersBriggsCategory","User","MyersBriggs","Answer","UserType","Profile","publishComposite","category","Roles","userIsInRole","userId","GLOBAL_GROUP","ready","console","log","find","Categories","defaults","sort","createdAt","children","question","_id","CreatedBy","limit","publish","refresh","self","user","findOne","qids","MyProfile","getAnsweredQuestionsIDs","observe","added","id","fields","changed","removed","ids","a","b","ar","Math","random","br","handles","i","length","$nin","Active","observeChanges","onStop","stop"],"mappings":"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","sourcesContent":["// All questions-related publications\n\nimport { Meteor } from 'meteor/meteor';\nimport { Question, Reading, MyersBriggsCategory } from '../questions.js';\nimport { User, MyersBriggs, Answer, UserType, Profile } from '../../users/users.js';\n\nMeteor.publishComposite('questions.bycategory', function (category) {\n    if(!Roles.userIsInRole(this.userId, ['admin'], Roles.GLOBAL_GROUP)) { return this.ready(); }\n    console.log(\"Publication 'questions.bycategory': \", category, this.userId);\n    return {\n        find() {\n            return Question.find({\n                Categories:category\n            }, {\n                defaults: true,\n                sort: {createdAt: -1}\n            });\n        },\n        children: [{\n            find(question) {\n                return User.find({ _id: question.CreatedBy }, { limit: 1 });\n            }\n        }]\n    };\n});\n\nMeteor.publish('questions.toanswer', function (userId, refresh) {\n    //console.log(userId, this.userId);\n    //if(this.userId !== userId && !Roles.userIsInRole(this.userId, ['admin'], Roles.GLOBAL_GROUP)) { return this.ready(); }\n    console.log(\"Publication 'questions.toanswer': \", this.userId, userId);\n    let self = this;\n    let user = User.findOne({_id:userId});\n    let qids = user.MyProfile.UserType.getAnsweredQuestionsIDs();\n    //console.log(self, user, qids);\n    let observe = {\n        added: function(id, fields) {\n            self.added('questions', id, fields);\n        },\n        changed: function(id, fields) {\n            self.removed(\"questions\", id);\n        },\n        removed: function(id) {\n            self.removed('questions', id);\n        }\n    };\n    let ids = [0,1,2,3];\n    ids.sort(function (a, b) {\n        let ar = Math.random();\n        let br = Math.random();\n        if(ar === br) { return 0; }\n        return ar > br ? -1 : 1;\n    });\n    handles = [null, null, null, null];\n    for(let i = 0; i < ids.length; i++) {\n        handles[ids[i]] = Question.find({Categories:ids[i], _id: { $nin: qids }, Active: true},{ limit: 1}).observeChanges(observe);\n    }\n\n    self.ready();\n    self.onStop(function() {\n        for(let i = 0; i < ids.length; i++) {\n            handles[i].stop();\n        }\n    });\n});\n"]},"sourceType":"script","hash":"78e0d1359e88e26787bd814b4b223ebfbbe42f07"}
