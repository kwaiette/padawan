{"metadata":{},"options":{"plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":false}},{"key":"base$0$3","visitor":{"_exploded":{},"_verified":{},"PrivateName":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$6","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$0$1$1","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$4","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$5","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$6","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$7","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$9","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$11","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$12","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$13","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$14","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$15","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$16","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$17","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$18","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$19","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$20","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$21","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$22","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$23","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{}}],"presets":[],"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\packages\\jagi:astronomy\\lib\\modules\\storage\\class_prototype_methods\\save.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining","pipelineOperator","throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"sourceFileName":"packages/jagi:astronomy/lib/modules/storage/class_prototype_methods/save.js","filename":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\packages\\jagi:astronomy\\lib\\modules\\storage\\class_prototype_methods\\save.js","passPerPreset":false,"envName":"development","cwd":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan","root":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan","generatorOpts":{"filename":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\packages\\jagi:astronomy\\lib\\modules\\storage\\class_prototype_methods\\save.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"packages/jagi:astronomy/lib/modules/storage/class_prototype_methods/save.js"}},"code":"var _defaults;\n\nmodule.watch(require(\"lodash/defaults\"), {\n  \"default\": function (v) {\n    _defaults = v;\n  }\n}, 0);\n\nvar _each;\n\nmodule.watch(require(\"lodash/each\"), {\n  \"default\": function (v) {\n    _each = v;\n  }\n}, 1);\n\nvar _extend;\n\nmodule.watch(require(\"lodash/extend\"), {\n  \"default\": function (v) {\n    _extend = v;\n  }\n}, 2);\n\nvar _omit;\n\nmodule.watch(require(\"lodash/omit\"), {\n  \"default\": function (v) {\n    _omit = v;\n  }\n}, 3);\nvar DDP;\nmodule.watch(require(\"meteor/ddp\"), {\n  DDP: function (v) {\n    DDP = v;\n  }\n}, 4);\nvar documentInsert;\nmodule.watch(require(\"../utils/document_insert\"), {\n  \"default\": function (v) {\n    documentInsert = v;\n  }\n}, 5);\nvar documentUpdate;\nmodule.watch(require(\"../utils/document_update\"), {\n  \"default\": function (v) {\n    documentUpdate = v;\n  }\n}, 6);\nvar isRemote;\nmodule.watch(require(\"../utils/is_remote\"), {\n  \"default\": function (v) {\n    isRemote = v;\n  }\n}, 7);\nvar callMeteorMethod;\nmodule.watch(require(\"../utils/call_meteor_method\"), {\n  \"default\": function (v) {\n    callMeteorMethod = v;\n  }\n}, 8);\nvar rawAll;\nmodule.watch(require(\"../../fields/utils/rawAll\"), {\n  \"default\": function (v) {\n    rawAll = v;\n  }\n}, 9);\nvar castNested;\nmodule.watch(require(\"../../fields/utils/castNested\"), {\n  \"default\": function (v) {\n    castNested = v;\n  }\n}, 10);\nvar getModifier;\nmodule.watch(require(\"../../storage/utils/getModifier\"), {\n  \"default\": function (v) {\n    getModifier = v;\n  }\n}, 11);\n\nfunction save() {\n  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var callback = arguments.length > 1 ? arguments[1] : undefined;\n  var doc = this;\n  var Class = doc.constructor;\n  var Collection = Class.getCollection(); // If the first argument is callback function then reassign values.\n\n  if (arguments.length === 1 && Match.test(options, Function)) {\n    callback = options;\n    options = {};\n  } // Set default options.\n\n\n  _defaults(options, {\n    stopOnFirstError: true,\n    simulation: true,\n    forceUpdate: false\n  }); // Cast all fields.\n\n\n  if (options.cast) {\n    _each(Class.getFields(), function (field) {\n      doc[field.name] = field.castValue(doc[field.name], {\n        clone: false,\n        cast: true\n      });\n    });\n  } // Cast only nested fields.\n  else {\n      castNested({\n        doc: doc,\n        options: {\n          clone: false\n        }\n      });\n    } // Detect which operation we are executing.\n\n\n  var inserting = doc._isNew; // Generate ID if not provided.\n\n  if (inserting && !doc._id) {\n    var generateId = true; // Don't generate the id if we're the client and the 'outermost' call.\n    // This optimization saves us passing both the randomSeed and the id.\n    // Passing both is redundant.\n\n    if (Collection._isRemoteCollection()) {\n      var enclosing = DDP._CurrentInvocation.get();\n\n      if (!enclosing) {\n        generateId = false;\n      }\n    }\n\n    if (generateId) {\n      doc._id = Collection._makeNewID();\n    }\n  } // If we are dealing with a remote collection and we are not on the server.\n\n\n  if (isRemote(Class)) {\n    // Prepare meteor method name to be called.\n    var methodName = '/Astronomy/' + (inserting ? 'insert' : 'update'); // Prepare arguments for meteor method.\n\n    var methodArgs = {\n      className: Class.getName(),\n      stopOnFirstError: options.stopOnFirstError,\n      simulation: options.simulation\n    }; // Inserting.\n\n    if (inserting) {\n      _extend(methodArgs, {\n        rawDoc: rawAll(doc, {\n          \"transient\": false\n        })\n      });\n    } // Updating.\n    else {\n        // If the \"forceUpdate\" option was set then we don't run the \"getModifier\"\n        // function to get modifier and instead we just take entire raw object and\n        // remove the \"_id\" field as we can't update it.\n        var modifier = options.forceUpdate ? _omit(doc.raw(), ['_id']) : getModifier({\n          doc: doc\n        });\n\n        _extend(methodArgs, {\n          selector: {\n            _id: doc._id\n          },\n          modifier: modifier,\n          options: {},\n          fields: options.fields\n        });\n      }\n\n    try {\n      // Run Meteor method.\n      var result = callMeteorMethod(Class, methodName, [methodArgs], callback);\n\n      if (result && inserting) {\n        // In the insert operation the value return from the meteor method is\n        // a document ID.\n        doc._id = result;\n      } // Document is not new anymore.\n\n\n      doc._isNew = false;\n      return result;\n    } // Catch stub exceptions.\n    catch (err) {\n      if (callback) {\n        callback(err);\n        return null;\n      }\n\n      throw err;\n    }\n  } // If we can just insert a document without calling the meteor method. We may\n  // be on the server or the collection may be local.\n\n\n  try {\n    // Prepare arguments.\n    var _methodArgs = {\n      doc: doc,\n      stopOnFirstError: options.stopOnFirstError,\n      simulation: options.simulation,\n      trusted: true\n    };\n\n    if (inserting) {\n      var _result = documentInsert(_methodArgs);\n\n      if (callback) {\n        callback(undefined, _result);\n      }\n\n      return _result;\n    } else {\n      _methodArgs.fields = options.fields;\n\n      var _result2 = documentUpdate(_methodArgs);\n\n      if (callback) {\n        callback(undefined, _result2);\n      }\n\n      return _result2;\n    }\n  } catch (err) {\n    if (callback) {\n      callback(err);\n      return null;\n    }\n\n    throw err;\n  }\n}\n\nmodule.exportDefault(save);","map":{"version":3,"sources":["packages/jagi:astronomy/lib/modules/storage/class_prototype_methods/save.js"],"names":["_defaults","module","watch","require","v","_each","_extend","_omit","DDP","documentInsert","documentUpdate","isRemote","callMeteorMethod","rawAll","castNested","getModifier","save","options","callback","doc","Class","constructor","Collection","getCollection","arguments","length","Match","test","Function","stopOnFirstError","simulation","forceUpdate","cast","getFields","field","name","castValue","clone","inserting","_isNew","_id","generateId","_isRemoteCollection","enclosing","_CurrentInvocation","get","_makeNewID","methodName","methodArgs","className","getName","rawDoc","modifier","raw","selector","fields","result","err","trusted","undefined","exportDefault"],"mappings":"AAAA,IAAIA,SAAJ;;AAAcC,OAAOC,KAAP,CAAaC,QAAQ,iBAAR,CAAb,EAAwC;AAAA,uBAASC,CAAT,EAAW;AAACJ,gBAAUI,CAAV;AAAY;AAAxB,CAAxC,EAAkE,CAAlE;;AAAqE,IAAIC,KAAJ;;AAAUJ,OAAOC,KAAP,CAAaC,QAAQ,aAAR,CAAb,EAAoC;AAAA,uBAASC,CAAT,EAAW;AAACC,YAAMD,CAAN;AAAQ;AAApB,CAApC,EAA0D,CAA1D;;AAA6D,IAAIE,OAAJ;;AAAYL,OAAOC,KAAP,CAAaC,QAAQ,eAAR,CAAb,EAAsC;AAAA,uBAASC,CAAT,EAAW;AAACE,cAAQF,CAAR;AAAU;AAAtB,CAAtC,EAA8D,CAA9D;;AAAiE,IAAIG,KAAJ;;AAAUN,OAAOC,KAAP,CAAaC,QAAQ,aAAR,CAAb,EAAoC;AAAA,uBAASC,CAAT,EAAW;AAACG,YAAMH,CAAN;AAAQ;AAApB,CAApC,EAA0D,CAA1D;AAA6D,IAAII,GAAJ;AAAQP,OAAOC,KAAP,CAAaC,QAAQ,YAAR,CAAb,EAAmC;AAACK,KAAD,YAAKJ,CAAL,EAAO;AAACI,UAAIJ,CAAJ;AAAM;AAAd,CAAnC,EAAmD,CAAnD;AAAsD,IAAIK,cAAJ;AAAmBR,OAAOC,KAAP,CAAaC,QAAQ,0BAAR,CAAb,EAAiD;AAAA,uBAASC,CAAT,EAAW;AAACK,qBAAeL,CAAf;AAAiB;AAA7B,CAAjD,EAAgF,CAAhF;AAAmF,IAAIM,cAAJ;AAAmBT,OAAOC,KAAP,CAAaC,QAAQ,0BAAR,CAAb,EAAiD;AAAA,uBAASC,CAAT,EAAW;AAACM,qBAAeN,CAAf;AAAiB;AAA7B,CAAjD,EAAgF,CAAhF;AAAmF,IAAIO,QAAJ;AAAaV,OAAOC,KAAP,CAAaC,QAAQ,oBAAR,CAAb,EAA2C;AAAA,uBAASC,CAAT,EAAW;AAACO,eAASP,CAAT;AAAW;AAAvB,CAA3C,EAAoE,CAApE;AAAuE,IAAIQ,gBAAJ;AAAqBX,OAAOC,KAAP,CAAaC,QAAQ,6BAAR,CAAb,EAAoD;AAAA,uBAASC,CAAT,EAAW;AAACQ,uBAAiBR,CAAjB;AAAmB;AAA/B,CAApD,EAAqF,CAArF;AAAwF,IAAIS,MAAJ;AAAWZ,OAAOC,KAAP,CAAaC,QAAQ,2BAAR,CAAb,EAAkD;AAAA,uBAASC,CAAT,EAAW;AAACS,aAAOT,CAAP;AAAS;AAArB,CAAlD,EAAyE,CAAzE;AAA4E,IAAIU,UAAJ;AAAeb,OAAOC,KAAP,CAAaC,QAAQ,+BAAR,CAAb,EAAsD;AAAA,uBAASC,CAAT,EAAW;AAACU,iBAAWV,CAAX;AAAa;AAAzB,CAAtD,EAAiF,EAAjF;AAAqF,IAAIW,WAAJ;AAAgBd,OAAOC,KAAP,CAAaC,QAAQ,iCAAR,CAAb,EAAwD;AAAA,uBAASC,CAAT,EAAW;AAACW,kBAAYX,CAAZ;AAAc;AAA1B,CAAxD,EAAoF,EAApF;;AAap8B,SAASY,IAAT,GAAsC;AAAA,MAAxBC,OAAwB,uEAAd,EAAc;AAAA,MAAVC,QAAU;AACpC,MAAMC,MAAM,IAAZ;AACA,MAAMC,QAAQD,IAAIE,WAAlB;AACA,MAAMC,aAAaF,MAAMG,aAAN,EAAnB,CAHoC,CAKpC;;AACA,MAAIC,UAAUC,MAAV,KAAqB,CAArB,IAA0BC,MAAMC,IAAN,CAAWV,OAAX,EAAoBW,QAApB,CAA9B,EAA6D;AAC3DV,eAAWD,OAAX;AACAA,cAAU,EAAV;AACD,GATmC,CAWpC;;;AACAjB,YAAUiB,OAAV,EAAmB;AACjBY,sBAAkB,IADD;AAEjBC,gBAAY,IAFK;AAGjBC,iBAAa;AAHI,GAAnB,EAZoC,CAkBpC;;;AACA,MAAId,QAAQe,IAAZ,EAAkB;AAChB3B,UAAMe,MAAMa,SAAN,EAAN,EAAyB,UAACC,KAAD,EAAW;AAClCf,UAAIe,MAAMC,IAAV,IAAkBD,MAAME,SAAN,CAAgBjB,IAAIe,MAAMC,IAAV,CAAhB,EAAiC;AACjDE,eAAO,KAD0C;AAEjDL,cAAM;AAF2C,OAAjC,CAAlB;AAID,KALD;AAMD,GAPD,CAQA;AARA,OASK;AACHlB,iBAAW;AACTK,gBADS;AAETF,iBAAS;AACPoB,iBAAO;AADA;AAFA,OAAX;AAMD,KAnCmC,CAqCpC;;;AACA,MAAMC,YAAYnB,IAAIoB,MAAtB,CAtCoC,CAwCpC;;AACA,MAAID,aAAa,CAACnB,IAAIqB,GAAtB,EAA2B;AACzB,QAAIC,aAAa,IAAjB,CADyB,CAEzB;AACA;AACA;;AACA,QAAInB,WAAWoB,mBAAX,EAAJ,EAAsC;AACpC,UAAMC,YAAYnC,IAAIoC,kBAAJ,CAAuBC,GAAvB,EAAlB;;AACA,UAAI,CAACF,SAAL,EAAgB;AACdF,qBAAa,KAAb;AACD;AACF;;AACD,QAAIA,UAAJ,EAAgB;AACdtB,UAAIqB,GAAJ,GAAUlB,WAAWwB,UAAX,EAAV;AACD;AACF,GAvDmC,CAyDpC;;;AACA,MAAInC,SAASS,KAAT,CAAJ,EAAqB;AACnB;AACA,QAAM2B,aAAa,iBAAiBT,YAAY,QAAZ,GAAuB,QAAxC,CAAnB,CAFmB,CAGnB;;AACA,QAAMU,aAAa;AACjBC,iBAAW7B,MAAM8B,OAAN,EADM;AAEjBrB,wBAAkBZ,QAAQY,gBAFT;AAGjBC,kBAAYb,QAAQa;AAHH,KAAnB,CAJmB,CASnB;;AACA,QAAIQ,SAAJ,EAAe;AACbhC,cAAQ0C,UAAR,EAAoB;AAClBG,gBAAQtC,OAAOM,GAAP,EAAY;AAClB,uBAAW;AADO,SAAZ;AADU,OAApB;AAKD,KAND,CAOA;AAPA,SAQK;AACH;AACA;AACA;AACA,YAAMiC,WAAWnC,QAAQc,WAAR,GAAsBxB,MAAMY,IAAIkC,GAAJ,EAAN,EAAiB,CAAC,KAAD,CAAjB,CAAtB,GAAkDtC,YAAY;AAACI;AAAD,SAAZ,CAAnE;;AACAb,gBAAQ0C,UAAR,EAAoB;AAClBM,oBAAU;AACRd,iBAAKrB,IAAIqB;AADD,WADQ;AAIlBY,4BAJkB;AAKlBnC,mBAAS,EALS;AAMlBsC,kBAAQtC,QAAQsC;AANE,SAApB;AAQD;;AAED,QAAI;AACF;AACA,UAAMC,SAAS5C,iBACbQ,KADa,EACN2B,UADM,EACM,CAACC,UAAD,CADN,EACoB9B,QADpB,CAAf;;AAGA,UAAIsC,UAAUlB,SAAd,EAAyB;AACvB;AACA;AACAnB,YAAIqB,GAAJ,GAAUgB,MAAV;AACD,OATC,CAUF;;;AACArC,UAAIoB,MAAJ,GAAa,KAAb;AACA,aAAOiB,MAAP;AACD,KAbD,CAcA;AACA,WAAOC,GAAP,EAAY;AACV,UAAIvC,QAAJ,EAAc;AACZA,iBAASuC,GAAT;AACA,eAAO,IAAP;AACD;;AACD,YAAMA,GAAN;AACD;AACF,GAjHmC,CAmHpC;AACA;;;AACA,MAAI;AACF;AACA,QAAIT,cAAa;AACf7B,cADe;AAEfU,wBAAkBZ,QAAQY,gBAFX;AAGfC,kBAAYb,QAAQa,UAHL;AAIf4B,eAAS;AAJM,KAAjB;;AAMA,QAAIpB,SAAJ,EAAe;AACb,UAAIkB,UAAS/C,eAAeuC,WAAf,CAAb;;AACA,UAAI9B,QAAJ,EAAc;AACZA,iBAASyC,SAAT,EAAoBH,OAApB;AACD;;AACD,aAAOA,OAAP;AACD,KAND,MAOK;AACHR,kBAAWO,MAAX,GAAoBtC,QAAQsC,MAA5B;;AACA,UAAIC,WAAS9C,eAAesC,WAAf,CAAb;;AACA,UAAI9B,QAAJ,EAAc;AACZA,iBAASyC,SAAT,EAAoBH,QAApB;AACD;;AACD,aAAOA,QAAP;AACD;AACF,GAvBD,CAwBA,OAAOC,GAAP,EAAY;AACV,QAAIvC,QAAJ,EAAc;AACZA,eAASuC,GAAT;AACA,aAAO,IAAP;AACD;;AACD,UAAMA,GAAN;AACD;AACF;;AAjKDxD,OAAO2D,aAAP,CAmKe5C,IAnKf","sourcesContent":["import _defaults from 'lodash/defaults';\nimport _each from 'lodash/each';\nimport _extend from 'lodash/extend';\nimport _omit from 'lodash/omit';\nimport { DDP } from 'meteor/ddp';\nimport documentInsert from '../utils/document_insert';\nimport documentUpdate from '../utils/document_update';\nimport isRemote from '../utils/is_remote';\nimport callMeteorMethod from '../utils/call_meteor_method';\nimport rawAll from '../../fields/utils/rawAll';\nimport castNested from '../../fields/utils/castNested';\nimport getModifier from '../../storage/utils/getModifier';\n\nfunction save(options = {}, callback) {\n  const doc = this;\n  const Class = doc.constructor;\n  const Collection = Class.getCollection();\n\n  // If the first argument is callback function then reassign values.\n  if (arguments.length === 1 && Match.test(options, Function)) {\n    callback = options;\n    options = {};\n  }\n\n  // Set default options.\n  _defaults(options, {\n    stopOnFirstError: true,\n    simulation: true,\n    forceUpdate: false\n  });\n\n  // Cast all fields.\n  if (options.cast) {\n    _each(Class.getFields(), (field) => {\n      doc[field.name] = field.castValue(doc[field.name], {\n        clone: false,\n        cast: true\n      });\n    });\n  }\n  // Cast only nested fields.\n  else {\n    castNested({\n      doc,\n      options: {\n        clone: false\n      }\n    });\n  }\n\n  // Detect which operation we are executing.\n  const inserting = doc._isNew;\n\n  // Generate ID if not provided.\n  if (inserting && !doc._id) {\n    let generateId = true;\n    // Don't generate the id if we're the client and the 'outermost' call.\n    // This optimization saves us passing both the randomSeed and the id.\n    // Passing both is redundant.\n    if (Collection._isRemoteCollection()) {\n      const enclosing = DDP._CurrentInvocation.get();\n      if (!enclosing) {\n        generateId = false;\n      }\n    }\n    if (generateId) {\n      doc._id = Collection._makeNewID();\n    }\n  }\n\n  // If we are dealing with a remote collection and we are not on the server.\n  if (isRemote(Class)) {\n    // Prepare meteor method name to be called.\n    const methodName = '/Astronomy/' + (inserting ? 'insert' : 'update');\n    // Prepare arguments for meteor method.\n    const methodArgs = {\n      className: Class.getName(),\n      stopOnFirstError: options.stopOnFirstError,\n      simulation: options.simulation,\n    };\n    // Inserting.\n    if (inserting) {\n      _extend(methodArgs, {\n        rawDoc: rawAll(doc, {\n          transient: false\n        })\n      });\n    }\n    // Updating.\n    else {\n      // If the \"forceUpdate\" option was set then we don't run the \"getModifier\"\n      // function to get modifier and instead we just take entire raw object and\n      // remove the \"_id\" field as we can't update it.\n      const modifier = options.forceUpdate ? _omit(doc.raw(), ['_id']) : getModifier({doc});\n      _extend(methodArgs, {\n        selector: {\n          _id: doc._id\n        },\n        modifier,\n        options: {},\n        fields: options.fields\n      });\n    }\n\n    try {\n      // Run Meteor method.\n      const result = callMeteorMethod(\n        Class, methodName, [methodArgs], callback\n      );\n      if (result && inserting) {\n        // In the insert operation the value return from the meteor method is\n        // a document ID.\n        doc._id = result;\n      }\n      // Document is not new anymore.\n      doc._isNew = false;\n      return result;\n    }\n    // Catch stub exceptions.\n    catch (err) {\n      if (callback) {\n        callback(err);\n        return null;\n      }\n      throw err;\n    }\n  }\n\n  // If we can just insert a document without calling the meteor method. We may\n  // be on the server or the collection may be local.\n  try {\n    // Prepare arguments.\n    let methodArgs = {\n      doc,\n      stopOnFirstError: options.stopOnFirstError,\n      simulation: options.simulation,\n      trusted: true\n    };\n    if (inserting) {\n      let result = documentInsert(methodArgs);\n      if (callback) {\n        callback(undefined, result);\n      }\n      return result;\n    }\n    else {\n      methodArgs.fields = options.fields;\n      let result = documentUpdate(methodArgs);\n      if (callback) {\n        callback(undefined, result);\n      }\n      return result;\n    }\n  }\n  catch (err) {\n    if (callback) {\n      callback(err);\n      return null;\n    }\n    throw err;\n  }\n}\n\nexport default save;"]},"sourceType":"script","hash":"6315a5eb356ebd868ddf536c36f039aa3e0e27cf"}
