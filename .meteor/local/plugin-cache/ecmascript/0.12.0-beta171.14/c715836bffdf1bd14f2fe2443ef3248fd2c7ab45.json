{"metadata":{},"options":{"plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":true}},{"key":"base$0$3","visitor":{"_exploded":{},"_verified":{},"PrivateName":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$0$1$1","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$4","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$5","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$6","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$7","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$9","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}}],"presets":[],"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\imports\\ui\\pages\\admin_teams\\admin_teams.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining","pipelineOperator","throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"sourceFileName":"imports/ui/pages/admin_teams/admin_teams.js","filename":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\imports\\ui\\pages\\admin_teams\\admin_teams.js","passPerPreset":false,"envName":"development","cwd":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan","root":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan","generatorOpts":{"filename":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\imports\\ui\\pages\\admin_teams\\admin_teams.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/ui/pages/admin_teams/admin_teams.js"}},"code":"let Team, TeamIcon;\nmodule.watch(require(\"/imports/api/teams/teams.js\"), {\n  Team(v) {\n    Team = v;\n  },\n\n  TeamIcon(v) {\n    TeamIcon = v;\n  }\n\n}, 0);\nlet TeamGoal;\nmodule.watch(require(\"/imports/api/team_goals/team_goals.js\"), {\n  TeamGoal(v) {\n    TeamGoal = v;\n  }\n\n}, 1);\nlet User;\nmodule.watch(require(\"/imports/api/users/users.js\"), {\n  User(v) {\n    User = v;\n  }\n\n}, 2);\nlet FlowRouter;\nmodule.watch(require(\"meteor/kadira:flow-router\"), {\n  FlowRouter(v) {\n    FlowRouter = v;\n  }\n\n}, 3);\nlet Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 4);\nmodule.watch(require(\"./admin_teams.html\"));\nmodule.watch(require(\"../team_goals/team_goals.js\"));\nmodule.watch(require(\"/imports/ui/components/select_autocomplete/select_autocomplete.js\"));\nTemplate.admin_teams.onCreated(function () {\n  if (this.data.teamName) {\n    this.teamName = this.data.teamName;\n  } else if (FlowRouter.getParam('teamName')) {\n    this.teamName = FlowRouter.getParam('teamName').split('-').join(' ');\n  } else {\n    this.teamName = '';\n  }\n\n  console.log(this.teamName, FlowRouter.getParam('teamName'), \"bbbbbbbbbbbbbb\");\n  this.autorun(() => {\n    console.log(\"autorunning admin_teams...\");\n    this.subscription = this.subscribe('userList', Meteor.userId(), {\n      onStop: function () {\n        console.log(\"User List subscription stopped! \", arguments, this);\n      },\n      onReady: function () {\n        console.log(\"User List subscription ready! \", arguments, this);\n      }\n    });\n    console.log(this.subscription);\n    this.subscription2 = this.subscribe('teamMemberList', Meteor.userId(), {\n      onStop: function () {\n        console.log(\"Team Member subscription stopped! \", arguments, this);\n      },\n      onReady: function () {\n        console.log(\"Team Member subscription ready! \", arguments, this);\n      }\n    });\n    console.log(this.subscription2);\n    this.subscription3 = this.subscribe('teamsData', Meteor.userId(), {\n      onStop: function () {\n        console.log(\"teamsData subscription stopped! \", arguments, this);\n      },\n      onReady: function () {\n        console.log(\"teamsData subscription ready! \", arguments, this);\n        console.log(Team.find().fetch());\n      }\n    });\n    console.log(this.subscription3);\n  });\n});\nTemplate.admin_teams.onRendered(function () {\n  Meteor.setTimeout(function () {\n    $(\"table.table select.selectized\").each(function (s) {\n      this.selectize.on('item_add', function (val, $item) {\n        let userId = $item.closest(\"[data-user-id]\").data(\"user-id\");\n        let teamName = $item.closest(\"[data-team-name]\").data(\"team-name\");\n        let t = Team.findOne({\n          Name: teamName\n        });\n        t.addRole(userId, val);\n      });\n      this.selectize.on('item_remove', function (val, $item) {\n        let userId = this.$control.closest(\"[data-user-id]\").data(\"user-id\");\n        let teamName = this.$control.closest(\"[data-team-name]\").data(\"team-name\");\n        let t = Team.findOne({\n          Name: teamName\n        });\n        t.removeRole(userId, val);\n      });\n    });\n  }, 1000);\n});\nTemplate.admin_teams.helpers({\n  specificTeam() {\n    if (typeof Template.instance().teamName === 'undefined' || Template.instance().teamName === '') {\n      return false;\n    } else {\n      return true;\n    }\n  },\n\n  teams() {\n    if (typeof Team === 'undefined') {\n      return false;\n    }\n\n    let t;\n\n    if (typeof Template.instance().teamName === 'undefined' || Template.instance().teamName === '') {\n      t = Team.find(); //.fetch();\n    } else {\n      t = Team.find({\n        Name: Template.instance().teamName\n      }); //.fetch();\n    }\n\n    console.log(Template.instance().teamName, t, \"rrrrrrrrrrrr\");\n    let t_invited = [],\n        t_member = [],\n        t_else = [];\n    t.forEach(team => {\n      if (Roles.userIsInRole(Meteor.userId(), 'admin-join-request', team.Name)) {\n        t_invited.push(team);\n      } else if (team.Members.includes(Meteor.userId())) {\n        t_member.push(team);\n      } else {\n        t_else.push(team);\n      }\n    });\n    return t_invited.concat(t_member, t_else);\n  },\n\n  teamsMemberOf() {\n    if (typeof Team === 'undefined') {\n      return false;\n    }\n\n    let t = Team.find(); //.fetch();\n\n    let t_invited = [],\n        t_member = [],\n        t_else = [];\n    t.forEach(team => {\n      if (Roles.userIsInRole(Meteor.userId(), 'admin-join-request', team.Name)) {\n        t_invited.push(team);\n      } else if (team.Members.includes(Meteor.userId())) {\n        t_member.push(team);\n      } else {//t_else.push(team);\n      }\n    });\n\n    if (t_member.length > 1 && !Roles.userIsInRole(Meteor.userId(), 'admin', Roles.GLOBAL_GROUP)) {\n      //if regular user is a member of a team other than \"No Team\", hide \"No Team\" from this view\n      t_member = t_member.filter(tm => {\n        return tm.Name !== Team.Default.Name;\n      });\n    } else {//\n    }\n\n    return t_invited.concat(t_member, t_else);\n  },\n\n  teamsOther() {\n    if (typeof Team === 'undefined') {\n      return false;\n    }\n\n    let t = Team.find(); //.fetch();\n\n    let t_invited = [],\n        t_member = [],\n        t_else = [];\n    t.forEach(team => {\n      if (Roles.userIsInRole(Meteor.userId(), 'admin-join-request', team.Name)) {//t_invited.push(team);\n      } else if (team.Members.includes(Meteor.userId())) {//t_member.push(team);\n      } else {\n        t_else.push(team);\n      }\n    });\n    return t_invited.concat(t_member, t_else);\n  },\n\n  teamMembers(teamName) {\n    let teamRole = {};\n    teamRole[\"roles.\" + teamName] = \"member\";\n    let u = User.find(teamRole);\n\n    if (typeof u === \"undefined\") {\n      return false;\n    }\n\n    let memberList = [];\n    u.forEach(m => {\n      memberList.push({\n        _id: m._id,\n        firstName: m.MyProfile.firstName,\n        lastName: m.MyProfile.lastName,\n        roles: m.roles[teamName]\n      });\n    });\n    return memberList;\n  },\n\n  uniqueId() {\n    var text = \"\";\n    var idLength = 10;\n    var possible = \"acdeghijklmnopqrstuvwxyzACDEGHIJKLMNOPQRSTUVWXYZ0123456789\";\n\n    for (var i = 0; i < idLength; i++) {\n      text += possible.charAt(Math.floor(Math.random() * possible.length));\n    }\n\n    return text;\n  },\n\n  teamRequests(teamName) {\n    let teamRole = {};\n    teamRole[\"roles.\" + teamName] = \"user-join-request\";\n    let u = User.find(teamRole);\n\n    if (!u) {\n      return [];\n    }\n\n    let requestList = [];\n    u.forEach(m => {\n      requestList.push({\n        _id: m._id,\n        firstName: m.MyProfile.firstName,\n        lastName: m.MyProfile.lastName,\n        roles: \"user-join-request\"\n      });\n    });\n    return requestList;\n  },\n\n  rolesList() {\n    let roles = [];\n    Roles.getAllRoles().forEach(function (r) {\n      roles.push({\n        text: r.name,\n        value: r.name\n      });\n    });\n    return roles;\n  },\n\n  users() {\n    return User.find().fetch();\n  },\n\n  userAddList(teamName) {\n    let t = Team.findOne({\n      Name: teamName\n    });\n    let memberList = [];\n\n    if (t) {\n      memberList = t.Members;\n    }\n\n    let u = User.find({\n      _id: {\n        '$nin': memberList\n      }\n    });\n    let addList = [];\n    u.forEach(m => {\n      addList.push({\n        value: m._id,\n        text: m.MyProfile.firstName + \" \" + m.MyProfile.lastName\n      });\n    });\n    return addList;\n  }\n\n});\n\nfunction teamChanged($g) {\n  $g.find(\".btn-save\").prop(\"disabled\", false);\n  $g.find(\".btn-cancel\").prop(\"disabled\", false);\n}\n\nfunction teamUnchanged($g) {\n  $g.find(\".btn-save\").prop(\"disabled\", true);\n  $g.find(\".btn-cancel\").prop(\"disabled\", true);\n  $g.find(\".changed\").removeClass(\"changed\");\n}\n\nfunction saveTeam(teamId) {\n  let saveObj = {\n    Name: $(\"#team-title-\" + teamId).val(),\n    Description: $(\"#team-description-\" + teamId).val()\n  };\n  let t = Team.findOne({\n    _id: teamId\n  });\n\n  if (t) {\n    t.updateFromObj(saveObj);\n  }\n}\n\nTemplate.admin_teams.events({\n  'change .file-upload-input'(event, instance) {\n    var file = event.currentTarget.files[0];\n    var reader = new FileReader();\n\n    reader.onload = function (fileLoadEvent) {\n      let teamId = $(event.target).closest(\"[data-team-id]\").data(\"team-id\");\n      let t = Team.findOne({\n        _id: teamId\n      });\n      t.uploadIcon(file, reader.result);\n    };\n\n    reader.readAsBinaryString(file);\n  },\n\n  'change input.flat,textarea.flat'(event, instance) {\n    $(event.target).addClass('changed');\n    let $team = $(event.target).closest(\"[data-team-id]\");\n  },\n\n  'change input,textarea,select'(event, instance) {\n    let $t = $(event.target);\n    let $team = $(event.target).closest(\"[data-team-id]\");\n    teamChanged($team);\n  },\n\n  'keyup input,textarea'(event, instance) {\n    let $t = $(event.target);\n    let $team = $(event.target).closest(\"[data-team-id]\");\n    teamChanged($team);\n  },\n\n  'click button.btn-save'(event, instance) {\n    let $t = $(event.target);\n    let teamId = $t.closest(\"[data-team-id]\").data(\"team-id\");\n    saveTeam(teamId);\n    teamUnchanged($(\"#div-team-\" + teamId));\n  },\n\n  'click button#btn-create-team'(event, instance) {\n    let newTeamName = $(\"#input-new-team-name\").val();\n\n    if (\"\" === newTeamName) {\n      $(\"#msg-create\").removeClass(\"alert-success\").addClass(\"alert-danger\").html(\"Team name required\").css(\"display\", \"inline-block\");\n      return;\n    }\n\n    let newTeamDescription = $(\"#input-new-team-description\").val();\n    let newTeam = {\n      Name: newTeamName,\n      Description: newTeamDescription\n    };\n    Meteor.call('team.createNewTeam', newTeam, function (err, rslt) {\n      if (!err) {\n        $(\"#div-new-team-details\").slideUp();\n        $(\"#input-new-team-name\").val(\"\");\n        $(\"#msg-create\").removeClass(\"alert-danger\").addClass(\"alert-success\").html(\"Team created!\").css(\"display\", \"inline-block\");\n        $(\"#input-new-team-name\").closest(\".input-group\").removeClass(\"has-error\").removeClass(\"has-feedback\");\n      } else {\n        console.log(err);\n        $(\"#input-new-team-name\").closest(\".input-group\").addClass(\"has-error\").addClass(\"has-feedback\");\n        $(\"#msg-create\").removeClass(\"alert-success\").addClass(\"alert-danger\").html(\"Duplicate team name\").css(\"display\", \"inline-block\");\n\n        if (err.error === 409) {\n          console.log(\"duplicate\");\n        }\n      }\n\n      Meteor.setTimeout(function () {\n        $(\"#msg-create\").fadeOut();\n      }, 5000);\n    });\n  },\n\n  'focus #form-new-team'(event, instance) {\n    $(\"#div-new-team-details\").slideDown();\n  },\n\n  'blur #form-new-team'(event, instance) {\n    console.log(\"triggered div blur\");\n  },\n\n  'click .dropdown-menu.add-users'(event, instance) {\n    event.stopPropagation();\n  },\n\n  'click button.btn-add-users-save'(event, instance) {\n    let $select = $(event.target).closest(\".dropdown-menu\").find(\".selectized\");\n    let teamId = $(event.target).closest(\"[data-team-id]\").data(\"team-id\");\n    let t = Team.findOne({\n      _id: teamId\n    });\n    let userList = $select[0].selectize.items;\n    t.adminRequestUserJoin(userList);\n    $select[0].selectize.clear(true);\n    $(event.target).closest(\".dropdown\").toggleClass('open');\n  },\n\n  'click button.btn-add-users-cancel'(event, instance) {\n    let $select = $(event.target).closest(\".dropdown-menu\").find(\".selectized\");\n    $select[0].selectize.clear(true);\n    $(event.target).closest(\".dropdown\").toggleClass('open');\n  },\n\n  'click button.btn-add-users'(event, instance) {//show add-user widget\n  },\n\n  'click button.btn-accept-join'(event, instance) {\n    let teamId = $(event.target).data(\"team-id\");\n    let t = Team.findOne({\n      _id: teamId\n    });\n    t.userAcceptJoin();\n  },\n\n  'click button.btn-decline-join'(event, instance) {\n    let teamId = $(event.target).data(\"team-id\");\n    let t = Team.findOne({\n      _id: teamId\n    });\n    t.userDeclineJoin();\n  },\n\n  'click a.btn-admin-request-join'(event, instance) {\n    event.preventDefault();\n    let userId = $(event.target).closest(\"[data-user-id]\").data(\"user-id\");\n    let teamId = $(event.target).closest(\"[data-team-id]\").data(\"team-id\");\n    let t = Team.findOne({\n      _id: teamId\n    });\n    t.adminRequestUserJoin(userId);\n  },\n\n  'click button.btn-user-request-join'(event, instance) {\n    event.preventDefault();\n    let teamId = $(event.target).data(\"team-id\");\n    let t = Team.findOne({\n      _id: teamId\n    });\n    t.userRequestJoin();\n  },\n\n  'click a.btn-approve-join'(event, instance) {\n    event.preventDefault();\n    let userId = $(event.target).data(\"user-id\");\n    let teamId = $(event.target).closest(\"[data-team-id]\").data(\"team-id\");\n    let t = Team.findOne({\n      _id: teamId\n    });\n    t.adminAcceptJoin(userId);\n  },\n\n  'click a.btn-decline-join'(event, instance) {\n    event.preventDefault();\n    let userId = $(event.target).data(\"user-id\");\n    let teamId = $(event.target).closest(\"[data-team-id]\").data(\"team-id\");\n    let t = Team.findOne({\n      _id: teamId\n    });\n    t.adminRejectJoin(userId);\n  },\n\n  'click button.btn-remove-user-role'(event, instance) {\n    event.preventDefault();\n    let userId = $(event.target).closest(\"[data-user-id]\").data(\"user-id\");\n    let teamId = $(event.target).closest(\"[data-team-id]\").data(\"team-id\");\n    let role = $(event.target).closest(\"[data-role]\").data(\"role\");\n  },\n\n  'click div.team-goal-quick-list'(event, instance) {\n    let teamName = $(event.target).closest(\"[data-team-name]\").data(\"team-name\");\n\n    if (teamName) {\n      FlowRouter.go(\"/teamGoals/\" + teamName.split(\" \").join(\"-\"));\n    }\n  },\n\n  'click button.btn-expand,div.collapsed-summary'(event, instance) {\n    let $target = $(event.target);\n    let $teamContainer = $target.closest(\"[data-team-id]\");\n    let $targetExpandBtn = $teamContainer.find(\".btn-expand.glyphicon\");\n    $targetExpandBtn.removeClass(\"glyphicon-chevron-up\").addClass(\"glyphicon-chevron-down\");\n\n    if ($teamContainer.hasClass(\"collapsed\")) {\n      $(\".team-view[data-team-id]:not(.collapsed)\").slideUp(function () {\n        $(this).addClass(\"collapsed\").css(\"display\", \"block\");\n      });\n      $teamContainer.css(\"display\", \"none\").removeClass(\"collapsed\").slideDown(function () {\n        $('html, body').animate({\n          scrollTop: $teamContainer.offset().top\n        }, 500);\n      });\n      $targetExpandBtn.removeClass(\"glyphicon-chevron-down\");\n      $targetExpandBtn.addClass(\"glyphicon-chevron-up\");\n    } else {\n      $teamContainer.slideUp(function () {\n        $teamContainer.addClass(\"collapsed\").css(\"display\", \"block\");\n      });\n      $targetExpandBtn.removeClass(\"glyphicon-chevron-up\");\n      $targetExpandBtn.addClass(\"glyphicon-chevron-down\");\n    }\n  },\n\n  'click tr[data-user-id]'(event, instance) {\n    if (!$(event.target).closest(\".selectize-control\").length) {\n      let $target = $(event.target).closest(\"[data-user-id]\");\n      let uid = $target.data(\"user-id\");\n      FlowRouter.go(\"/profile/\" + uid);\n    }\n  }\n\n});\nTemplate.team_view.helpers({\n  fldEnabled(fld) {\n    let team = Template.instance().data.team; //let t = TeamGoal.findOne( {_id: team._id} );\n    //if (!t) {\n\n    if (Roles.userIsInRole(Meteor.userId(), 'admin', team.Name)) {\n      return \"\";\n    } else {\n      return \"disabled\";\n    } //}\n\n\n    if (g.hasModifyPerm(fld)) {\n      return \"\";\n    } else {\n      return \"disabled\";\n    }\n  },\n\n  iconData64() {\n    let team = Template.instance().data.team;\n    let t = Team.findOne({\n      _id: team._id\n    });\n    return team.Icon64;\n  },\n\n  teamMembers(teamName) {\n    let teamRole = {};\n    teamRole[\"roles.\" + teamName] = \"member\";\n    let u = User.find(teamRole);\n\n    if (typeof u === \"undefined\") {\n      return false;\n    }\n\n    let memberList = [];\n    u.forEach(m => {\n      memberList.push({\n        _id: m._id,\n        firstName: m.MyProfile.firstName,\n        lastName: m.MyProfile.lastName,\n        roles: m.roles[teamName]\n      });\n    });\n    return memberList;\n  },\n\n  hasTeamRequests(teamName) {\n    let teamRole = {};\n    teamRole[\"roles.\" + teamName] = \"user-join-request\";\n    let u = User.find(teamRole);\n\n    if (!u || u.count() == 0) {\n      return false;\n    } else {\n      return true;\n    }\n  },\n\n  teamRequests(teamName) {\n    let teamRole = {};\n    teamRole[\"roles.\" + teamName] = \"user-join-request\";\n    let u = User.find(teamRole);\n\n    if (!u) {\n      return [];\n    }\n\n    let requestList = [];\n    u.forEach(m => {\n      requestList.push({\n        _id: m._id,\n        firstName: m.MyProfile.firstName,\n        lastName: m.MyProfile.lastName,\n        roles: \"user-join-request\"\n      });\n    });\n    return requestList;\n  },\n\n  hasTeamInvites(teamName) {\n    let teamRole = {};\n    teamRole[\"roles.\" + teamName] = \"admin-join-request\";\n    let u = User.find(teamRole);\n\n    if (!u || u.count() == 0) {\n      return false;\n    } else {\n      return true;\n    }\n  },\n\n  teamInvites(teamName) {\n    let teamRole = {};\n    teamRole[\"roles.\" + teamName] = \"admin-join-request\";\n    let u = User.find(teamRole);\n\n    if (!u) {\n      return [];\n    }\n\n    let inviteList = [];\n    u.forEach(m => {\n      inviteList.push({\n        _id: m._id,\n        firstName: m.MyProfile.firstName,\n        lastName: m.MyProfile.lastName,\n        roles: \"admin-join-request\"\n      });\n    });\n    return inviteList;\n  },\n\n  rolesList() {\n    let roles = [];\n    Roles.getAllRoles().forEach(function (r) {\n      roles.push({\n        text: r.name,\n        value: r.name\n      });\n    });\n    return roles;\n  },\n\n  uniqueId() {\n    var text = \"\";\n    var idLength = 10;\n    var possible = \"acdeghijklmnopqrstuvwxyzACDEGHIJKLMNOPQRSTUVWXYZ0123456789\";\n\n    for (var i = 0; i < idLength; i++) {\n      text += possible.charAt(Math.floor(Math.random() * possible.length));\n    }\n\n    return text;\n  },\n\n  userAddList(teamName) {\n    let t = Team.findOne({\n      Name: teamName\n    });\n    let memberList = [];\n\n    if (t) {\n      memberList = t.Members;\n    }\n\n    let u = User.find({\n      _id: {\n        '$nin': memberList\n      }\n    });\n    let addList = [];\n    u.forEach(m => {\n      addList.push({\n        value: m._id,\n        text: m.MyProfile.firstName + \" \" + m.MyProfile.lastName\n      });\n    });\n    return addList;\n  }\n\n});","map":{"version":3,"sources":["imports/ui/pages/admin_teams/admin_teams.js"],"names":["Team","TeamIcon","module","watch","require","v","TeamGoal","User","FlowRouter","Meteor","Template","admin_teams","onCreated","data","teamName","getParam","split","join","console","log","autorun","subscription","subscribe","userId","onStop","arguments","onReady","subscription2","subscription3","find","fetch","onRendered","setTimeout","$","each","s","selectize","on","val","$item","closest","t","findOne","Name","addRole","$control","removeRole","helpers","specificTeam","instance","teams","t_invited","t_member","t_else","forEach","team","Roles","userIsInRole","push","Members","includes","concat","teamsMemberOf","length","GLOBAL_GROUP","filter","tm","Default","teamsOther","teamMembers","teamRole","u","memberList","m","_id","firstName","MyProfile","lastName","roles","uniqueId","text","idLength","possible","i","charAt","Math","floor","random","teamRequests","requestList","rolesList","getAllRoles","r","name","value","users","userAddList","addList","teamChanged","$g","prop","teamUnchanged","removeClass","saveTeam","teamId","saveObj","Description","updateFromObj","events","event","file","currentTarget","files","reader","FileReader","onload","fileLoadEvent","target","uploadIcon","result","readAsBinaryString","addClass","$team","$t","newTeamName","html","css","newTeamDescription","newTeam","call","err","rslt","slideUp","error","fadeOut","slideDown","stopPropagation","$select","userList","items","adminRequestUserJoin","clear","toggleClass","userAcceptJoin","userDeclineJoin","preventDefault","userRequestJoin","adminAcceptJoin","adminRejectJoin","role","go","$target","$teamContainer","$targetExpandBtn","hasClass","animate","scrollTop","offset","top","uid","team_view","fldEnabled","fld","g","hasModifyPerm","iconData64","Icon64","hasTeamRequests","count","hasTeamInvites","teamInvites","inviteList"],"mappings":"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","sourcesContent":["import { Team,TeamIcon } from '/imports/api/teams/teams.js';\nimport { TeamGoal } from '/imports/api/team_goals/team_goals.js';\nimport { User } from '/imports/api/users/users.js';\nimport { FlowRouter } from 'meteor/kadira:flow-router';\nimport { Meteor } from 'meteor/meteor';\nimport './admin_teams.html';\nimport '../team_goals/team_goals.js';\nimport '/imports/ui/components/select_autocomplete/select_autocomplete.js';\n\nTemplate.admin_teams.onCreated(function () {\n    if (this.data.teamName) {\n        this.teamName = this.data.teamName;\n    } else if (FlowRouter.getParam('teamName')){\n        this.teamName = FlowRouter.getParam('teamName').split('-').join(' ');\n    } else {\n        this.teamName = '';\n    }\n    console.log(this.teamName,FlowRouter.getParam('teamName'),\"bbbbbbbbbbbbbb\");\n\n    this.autorun( () => {\n        console.log(\"autorunning admin_teams...\");\n        this.subscription = this.subscribe('userList', Meteor.userId(), {\n            onStop: function () {\n                console.log(\"User List subscription stopped! \", arguments, this);\n            },\n            onReady: function () {\n                console.log(\"User List subscription ready! \", arguments, this);\n            }\n        });\n        console.log(this.subscription);\n        this.subscription2 = this.subscribe('teamMemberList', Meteor.userId(), {\n            onStop: function () {\n                console.log(\"Team Member subscription stopped! \", arguments, this);\n            },\n            onReady: function () {\n                console.log(\"Team Member subscription ready! \", arguments, this);\n            }\n        });\n        console.log(this.subscription2);\n        this.subscription3 = this.subscribe('teamsData', Meteor.userId(), {\n            onStop: function () {\n                console.log(\"teamsData subscription stopped! \", arguments, this);\n            },\n            onReady: function () {\n                console.log(\"teamsData subscription ready! \", arguments, this);\n                console.log(Team.find().fetch());\n            }\n        });\n        console.log(this.subscription3);\n    });\n});\n\nTemplate.admin_teams.onRendered(function () {\n    Meteor.setTimeout( function () {\n        $(\"table.table select.selectized\").each(function (s) {\n            this.selectize.on('item_add', function(val, $item) {\n                let userId = $item.closest(\"[data-user-id]\").data(\"user-id\");\n                let teamName = $item.closest(\"[data-team-name]\").data(\"team-name\");\n\n                let t = Team.findOne( {Name: teamName} );\n                t.addRole(userId, val);\n            });\n            this.selectize.on('item_remove', function(val, $item) {\n                let userId = this.$control.closest(\"[data-user-id]\").data(\"user-id\");\n                let teamName = this.$control.closest(\"[data-team-name]\").data(\"team-name\");\n\n                let t = Team.findOne( {Name: teamName} );\n                t.removeRole(userId, val);\n            });\n        });\n    }, 1000);\n});\n\nTemplate.admin_teams.helpers({\n    specificTeam() {\n        if (typeof Template.instance().teamName === 'undefined' || Template.instance().teamName === '') {\n            return false;\n        } else {\n            return true;\n        }\n    },\n    teams() {\n        if (typeof Team === 'undefined') {\n            return false;\n        }\n        let t;\n        if (typeof Template.instance().teamName === 'undefined' || Template.instance().teamName === '') {\n            t = Team.find(  );//.fetch();\n        } else {\n            t = Team.find( {Name:Template.instance().teamName} );//.fetch();\n        }\n        console.log(Template.instance().teamName, t, \"rrrrrrrrrrrr\");\n        let t_invited = [], t_member = [], t_else = [];\n        t.forEach( (team)=> {\n            if (Roles.userIsInRole(Meteor.userId(), 'admin-join-request', team.Name)) {\n                t_invited.push(team);\n            } else if (team.Members.includes(Meteor.userId()) ) {\n                t_member.push(team);\n            } else {\n                t_else.push(team);\n            }\n        });\n        return t_invited.concat(t_member, t_else);\n    },\n    teamsMemberOf() {\n        if (typeof Team === 'undefined') {\n            return false;\n        }\n        let t = Team.find(  );//.fetch();\n        let t_invited = [], t_member = [], t_else = [];\n        t.forEach( (team)=> {\n            if (Roles.userIsInRole(Meteor.userId(), 'admin-join-request', team.Name)) {\n                t_invited.push(team);\n            } else if (team.Members.includes(Meteor.userId()) ) {\n                t_member.push(team);\n            } else {\n                //t_else.push(team);\n            }\n        });\n        if (t_member.length > 1 && !Roles.userIsInRole(Meteor.userId(), 'admin', Roles.GLOBAL_GROUP)) {\n            //if regular user is a member of a team other than \"No Team\", hide \"No Team\" from this view\n            t_member = t_member.filter( (tm) => {\n                return tm.Name !== Team.Default.Name;\n            } );\n        } else {\n            //\n        }\n        return t_invited.concat(t_member, t_else);\n    },\n    teamsOther() {\n        if (typeof Team === 'undefined') {\n            return false;\n        }\n        let t = Team.find(  );//.fetch();\n        let t_invited = [], t_member = [], t_else = [];\n        t.forEach( (team)=> {\n            if (Roles.userIsInRole(Meteor.userId(), 'admin-join-request', team.Name)) {\n                //t_invited.push(team);\n            } else if (team.Members.includes(Meteor.userId()) ) {\n                //t_member.push(team);\n            } else {\n                t_else.push(team);\n            }\n        });\n        return t_invited.concat(t_member, t_else);\n    },\n    teamMembers(teamName) {\n        let teamRole = {};\n        teamRole[\"roles.\"+teamName] = \"member\";\n        let u = User.find( teamRole );\n        if (typeof u === \"undefined\") {\n            return false;\n        }\n        let memberList = [];\n        u.forEach((m) => {\n            memberList.push( {\n                _id: m._id,\n                firstName: m.MyProfile.firstName,\n                lastName: m.MyProfile.lastName,\n                roles: m.roles[teamName]\n            });\n        });\n        return memberList;\n    },\n    uniqueId() {\n        var text = \"\";\n        var idLength = 10;\n        var possible = \"acdeghijklmnopqrstuvwxyzACDEGHIJKLMNOPQRSTUVWXYZ0123456789\";\n\n        for (var i = 0; i < idLength; i++) {\n            text += possible.charAt(Math.floor(Math.random() * possible.length));\n        }\n\n        return text;\n    },\n    teamRequests(teamName) {\n        let teamRole = {};\n        teamRole[\"roles.\"+teamName] = \"user-join-request\";\n        let u = User.find( teamRole );\n\n        if (!u) {\n            return [];\n        }\n\n        let requestList = [];\n        u.forEach((m) => {\n            requestList.push( {\n                _id: m._id,\n                firstName: m.MyProfile.firstName,\n                lastName: m.MyProfile.lastName,\n                roles: \"user-join-request\"\n            })\n        });\n        return requestList;\n    },\n    rolesList() {\n        let roles = [];\n        Roles.getAllRoles().forEach(function (r) {\n            roles.push( {\n                text: r.name,\n                value: r.name\n            } );\n        });\n        return roles;\n    },\n    users() {\n        return User.find().fetch();\n    },\n    userAddList(teamName) {\n        let t = Team.findOne( {Name: teamName} );\n        let memberList = [];\n        if (t) {\n            memberList = t.Members;\n        }\n        let u = User.find({_id: {'$nin': memberList}});\n        let addList = [];\n        u.forEach((m) => {\n            addList.push( {\n                value: m._id,\n                text: m.MyProfile.firstName + \" \" + m.MyProfile.lastName\n            });\n        });\n        return addList;\n    },\n});\n\nfunction teamChanged($g) {\n    $g.find(\".btn-save\").prop(\"disabled\",false);\n    $g.find(\".btn-cancel\").prop(\"disabled\",false);\n}\nfunction teamUnchanged($g) {\n    $g.find(\".btn-save\").prop(\"disabled\",true);\n    $g.find(\".btn-cancel\").prop(\"disabled\",true);\n    $g.find(\".changed\").removeClass(\"changed\");\n}\nfunction saveTeam(teamId) {\n    let saveObj = {\n        Name: $(\"#team-title-\"+teamId).val(),\n        Description: $(\"#team-description-\"+teamId).val()\n    };\n    let t = Team.findOne( {_id:teamId} );\n    if (t) {\n        t.updateFromObj(saveObj);\n    }\n}\n\nTemplate.admin_teams.events({\n    'change .file-upload-input'(event, instance) {\n        var file = event.currentTarget.files[0];\n        var reader = new FileReader();\n        reader.onload = function(fileLoadEvent) {\n            let teamId = $(event.target).closest(\"[data-team-id]\").data(\"team-id\");\n            let t = Team.findOne({_id: teamId});\n            t.uploadIcon(file, reader.result);\n        };\n        reader.readAsBinaryString(file);\n    },\n    'change input.flat,textarea.flat'(event, instance) {\n        $(event.target).addClass('changed');\n        let $team = $(event.target).closest(\"[data-team-id]\");\n    },\n    'change input,textarea,select'(event, instance) {\n        let $t = $(event.target);\n        let $team = $(event.target).closest(\"[data-team-id]\");\n        teamChanged($team);\n    },\n    'keyup input,textarea'(event, instance) {\n        let $t = $(event.target);\n        let $team = $(event.target).closest(\"[data-team-id]\");\n        teamChanged($team);\n    },\n    'click button.btn-save'(event, instance) {\n        let $t = $(event.target);\n        let teamId = $t.closest(\"[data-team-id]\").data(\"team-id\");\n        saveTeam(teamId);\n        teamUnchanged($(\"#div-team-\"+teamId));\n    },\n    'click button#btn-create-team'(event, instance) {\n        let newTeamName = $(\"#input-new-team-name\").val();\n        if (\"\" === newTeamName) {\n            $(\"#msg-create\").removeClass(\"alert-success\").addClass(\"alert-danger\").html(\"Team name required\").css(\"display\",\"inline-block\");\n            return;\n        }\n        let newTeamDescription = $(\"#input-new-team-description\").val();\n        let newTeam = { Name: newTeamName, Description: newTeamDescription };\n        Meteor.call('team.createNewTeam', newTeam, function (err, rslt) {\n            if (!err) {\n                $(\"#div-new-team-details\").slideUp();\n                $(\"#input-new-team-name\").val(\"\");\n                $(\"#msg-create\").removeClass(\"alert-danger\").addClass(\"alert-success\").html(\"Team created!\").css(\"display\",\"inline-block\");\n                $(\"#input-new-team-name\").closest(\".input-group\").removeClass(\"has-error\").removeClass(\"has-feedback\");\n            } else {\n                console.log(err);\n                $(\"#input-new-team-name\").closest(\".input-group\").addClass(\"has-error\").addClass(\"has-feedback\");\n                $(\"#msg-create\").removeClass(\"alert-success\").addClass(\"alert-danger\").html(\"Duplicate team name\").css(\"display\",\"inline-block\");\n                if (err.error === 409) {\n                    console.log(\"duplicate\");\n                }\n            }\n            Meteor.setTimeout(function () {\n                $(\"#msg-create\").fadeOut();\n            }, 5000);\n        });\n    },\n    'focus #form-new-team'(event, instance) {\n        $(\"#div-new-team-details\").slideDown();\n    },\n    'blur #form-new-team'(event, instance) {\n        console.log(\"triggered div blur\");\n    },\n    'click .dropdown-menu.add-users'(event, instance) {\n        event.stopPropagation();\n    },\n    'click button.btn-add-users-save'(event, instance) {\n        let $select = $(event.target).closest(\".dropdown-menu\").find(\".selectized\");\n        let teamId = $(event.target).closest(\"[data-team-id]\").data(\"team-id\");\n        let t = Team.findOne({_id: teamId});\n        let userList = $select[0].selectize.items;\n\n        t.adminRequestUserJoin(userList);\n\n        $select[0].selectize.clear(true);\n        $(event.target).closest(\".dropdown\").toggleClass('open');\n    },\n    'click button.btn-add-users-cancel'(event, instance) {\n        let $select = $(event.target).closest(\".dropdown-menu\").find(\".selectized\");\n        $select[0].selectize.clear(true);\n        $(event.target).closest(\".dropdown\").toggleClass('open');\n    },\n    'click button.btn-add-users'(event, instance) {\n        //show add-user widget\n    },\n    'click button.btn-accept-join'(event, instance) {\n        let teamId = $(event.target).data(\"team-id\");\n        let t = Team.findOne({_id: teamId});\n        t.userAcceptJoin();\n    },\n    'click button.btn-decline-join'(event, instance) {\n        let teamId = $(event.target).data(\"team-id\");\n        let t = Team.findOne({_id: teamId});\n        t.userDeclineJoin();\n    },\n    'click a.btn-admin-request-join'(event, instance) {\n        event.preventDefault();\n        let userId = $(event.target).closest(\"[data-user-id]\").data(\"user-id\");\n        let teamId = $(event.target).closest(\"[data-team-id]\").data(\"team-id\");\n        let t = Team.findOne({_id: teamId});\n        t.adminRequestUserJoin(userId);\n    },\n    'click button.btn-user-request-join'(event, instance) {\n        event.preventDefault();\n        let teamId = $(event.target).data(\"team-id\");\n        let t = Team.findOne({_id: teamId});\n        t.userRequestJoin();\n    },\n    'click a.btn-approve-join'(event, instance) {\n        event.preventDefault();\n        let userId = $(event.target).data(\"user-id\");\n        let teamId = $(event.target).closest(\"[data-team-id]\").data(\"team-id\");\n        let t = Team.findOne( {_id: teamId} );\n        t.adminAcceptJoin(userId);\n    },\n    'click a.btn-decline-join'(event, instance) {\n        event.preventDefault();\n        let userId = $(event.target).data(\"user-id\");\n        let teamId = $(event.target).closest(\"[data-team-id]\").data(\"team-id\");\n        let t = Team.findOne( {_id: teamId} );\n        t.adminRejectJoin(userId);\n    },\n    'click button.btn-remove-user-role'(event, instance) {\n        event.preventDefault();\n        let userId = $(event.target).closest(\"[data-user-id]\").data(\"user-id\");\n        let teamId = $(event.target).closest(\"[data-team-id]\").data(\"team-id\");\n        let role = $(event.target).closest(\"[data-role]\").data(\"role\");\n    },\n    'click div.team-goal-quick-list'(event, instance) {\n        let teamName = $(event.target).closest(\"[data-team-name]\").data(\"team-name\");\n        if (teamName) {\n            FlowRouter.go(\"/teamGoals/\"+teamName.split(\" \").join(\"-\"));\n        }\n    },\n    'click button.btn-expand,div.collapsed-summary'(event, instance) {\n        let $target = $(event.target);\n        let $teamContainer = $target.closest(\"[data-team-id]\");\n        let $targetExpandBtn = $teamContainer.find(\".btn-expand.glyphicon\");\n\n        $targetExpandBtn.removeClass(\"glyphicon-chevron-up\")\n            .addClass(\"glyphicon-chevron-down\");\n\n        if ($teamContainer.hasClass(\"collapsed\")) {\n            $(\".team-view[data-team-id]:not(.collapsed)\").slideUp(function() {\n                $(this).addClass(\"collapsed\").css(\"display\",\"block\");\n            });\n            $teamContainer.css(\"display\",\"none\").removeClass(\"collapsed\").slideDown(function () {\n                $('html, body').animate({\n                    scrollTop: ($teamContainer.offset().top)\n                },500);\n            });\n            $targetExpandBtn.removeClass(\"glyphicon-chevron-down\");\n            $targetExpandBtn.addClass(\"glyphicon-chevron-up\");\n        } else {\n            $teamContainer.slideUp(function() {\n                $teamContainer.addClass(\"collapsed\").css(\"display\",\"block\");\n            });\n            $targetExpandBtn.removeClass(\"glyphicon-chevron-up\");\n            $targetExpandBtn.addClass(\"glyphicon-chevron-down\");\n        }\n    },\n    'click tr[data-user-id]'(event, instance) {\n        if (!$(event.target).closest(\".selectize-control\").length) {\n            let $target = $(event.target).closest(\"[data-user-id]\");\n            let uid = $target.data(\"user-id\");\n            FlowRouter.go(\"/profile/\"+uid);\n        }\n    }\n});\n\nTemplate.team_view.helpers ({\n    fldEnabled(fld) {\n        let team = Template.instance().data.team;\n        //let t = TeamGoal.findOne( {_id: team._id} );\n\n        //if (!t) {\n            if (Roles.userIsInRole(Meteor.userId(), 'admin', team.Name)) {\n                return \"\";\n            } else {\n                return \"disabled\";\n            }\n        //}\n\n        if (g.hasModifyPerm(fld)) {\n            return \"\";\n        } else {\n            return \"disabled\";\n        }\n    },\n    iconData64() {\n        let team = Template.instance().data.team;\n        let t = Team.findOne( {_id: team._id} );\n        return team.Icon64;\n    },\n    teamMembers(teamName) {\n        let teamRole = {};\n        teamRole[\"roles.\"+teamName] = \"member\";\n        let u = User.find( teamRole );\n        if (typeof u === \"undefined\") {\n            return false;\n        }\n        let memberList = [];\n        u.forEach((m) => {\n            memberList.push( {\n                _id: m._id,\n                firstName: m.MyProfile.firstName,\n                lastName: m.MyProfile.lastName,\n                roles: m.roles[teamName]\n            });\n        });\n        return memberList;\n    },\n    hasTeamRequests(teamName) {\n        let teamRole = {};\n        teamRole[\"roles.\"+teamName] = \"user-join-request\";\n        let u = User.find( teamRole );\n\n        if (!u || u.count() == 0) {\n            return false;\n        } else {\n            return true;\n        }\n    },\n    teamRequests(teamName) {\n        let teamRole = {};\n        teamRole[\"roles.\"+teamName] = \"user-join-request\";\n        let u = User.find( teamRole );\n\n        if (!u) {\n            return [];\n        }\n\n        let requestList = [];\n        u.forEach((m) => {\n            requestList.push( {\n                _id: m._id,\n                firstName: m.MyProfile.firstName,\n                lastName: m.MyProfile.lastName,\n                roles: \"user-join-request\"\n            })\n        });\n        return requestList;\n    },\n    hasTeamInvites(teamName) {\n        let teamRole = {};\n        teamRole[\"roles.\"+teamName] = \"admin-join-request\"\n        let u = User.find( teamRole );\n\n        if (!u || u.count() == 0) {\n            return false;\n        } else {\n            return true;\n        }\n    },\n    teamInvites(teamName) {\n        let teamRole = {};\n        teamRole[\"roles.\"+teamName] = \"admin-join-request\"\n        let u = User.find( teamRole );\n\n        if (!u) {\n            return [];\n        }\n\n        let inviteList = [];\n        u.forEach((m) => {\n            inviteList.push( {\n                _id: m._id,\n                firstName: m.MyProfile.firstName,\n                lastName: m.MyProfile.lastName,\n                roles: \"admin-join-request\"\n            })\n        });\n        return inviteList;\n    },\n    rolesList() {\n        let roles = [];\n        Roles.getAllRoles().forEach(function (r) {\n            roles.push( {\n                text: r.name,\n                value: r.name\n            } );\n        });\n        return roles;\n    },\n    uniqueId() {\n        var text = \"\";\n        var idLength = 10;\n        var possible = \"acdeghijklmnopqrstuvwxyzACDEGHIJKLMNOPQRSTUVWXYZ0123456789\";\n\n        for (var i = 0; i < idLength; i++) {\n            text += possible.charAt(Math.floor(Math.random() * possible.length));\n        }\n\n        return text;\n    },\n    userAddList(teamName) {\n        let t = Team.findOne( {Name: teamName} );\n        let memberList = [];\n        if (t) {\n            memberList = t.Members;\n        }\n        let u = User.find({_id: {'$nin': memberList}});\n        let addList = [];\n        u.forEach((m) => {\n            addList.push( {\n                value: m._id,\n                text: m.MyProfile.firstName + \" \" + m.MyProfile.lastName\n            });\n        });\n        return addList;\n    },\n\n});\n"]},"sourceType":"script","hash":"c715836bffdf1bd14f2fe2443ef3248fd2c7ab45"}
