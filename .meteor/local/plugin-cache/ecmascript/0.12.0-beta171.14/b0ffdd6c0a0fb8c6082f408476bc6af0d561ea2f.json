{"metadata":{},"options":{"plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":false}},{"key":"base$0$3","visitor":{"_exploded":{},"_verified":{},"PrivateName":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$6","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$0$1$1","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$4","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$5","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$6","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$7","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$9","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$11","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$12","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$13","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$14","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$15","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$16","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$17","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$18","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$19","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$20","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$21","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$22","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$23","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{}}],"presets":[],"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\imports\\api\\individual_goals\\individual_goals.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining","pipelineOperator","throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"sourceFileName":"imports/api/individual_goals/individual_goals.js","filename":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\imports\\api\\individual_goals\\individual_goals.js","passPerPreset":false,"envName":"development","cwd":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan","root":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan","generatorOpts":{"filename":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\imports\\api\\individual_goals\\individual_goals.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/api/individual_goals/individual_goals.js"}},"code":"module.export({\n  IndividualGoal: function () {\n    return IndividualGoal;\n  }\n});\nvar Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 0);\nvar Mongo;\nmodule.watch(require(\"meteor/mongo\"), {\n  Mongo: function (v) {\n    Mongo = v;\n  }\n}, 1);\nvar User;\nmodule.watch(require(\"../users/users.js\"), {\n  User: function (v) {\n    User = v;\n  }\n}, 2);\nvar Class, Enum;\nmodule.watch(require(\"meteor/jagi:astronomy\"), {\n  Class: function (v) {\n    Class = v;\n  },\n  Enum: function (v) {\n    Enum = v;\n  }\n}, 3);\nvar UserNotify;\nmodule.watch(require(\"/imports/api/user_notify/user_notify.js\"), {\n  UserNotify: function (v) {\n    UserNotify = v;\n  }\n}, 4);\nvar GoalComment;\nmodule.watch(require(\"/imports/api/team_goals/team_goals.js\"), {\n  GoalComment: function (v) {\n    GoalComment = v;\n  }\n}, 5);\nvar IndividualGoal = Class.create({\n  name: 'IndividualGoal',\n  collection: new Mongo.Collection('individual_goal'),\n  fields: {\n    userId: {\n      type: String,\n      \"default\": ''\n    },\n    title: {\n      type: String,\n      \"default\": ''\n    },\n    description: {\n      type: String,\n      \"default\": ''\n    },\n    parentId: {\n      type: String,\n      \"default\": ''\n    },\n    assignedToStr: {\n      type: String,\n      \"transient\": true\n    },\n    reachedDate: {\n      type: Date,\n      optional: true\n    },\n    startDate: {\n      type: Date,\n      optional: true\n    },\n    dueDate: {\n      type: Date,\n      optional: true\n    },\n    reviewDate: {\n      type: Date,\n      optional: true\n    },\n    reviewedOnDate: {\n      type: Date,\n      optional: true\n    },\n    goalComments: {\n      type: [GoalComment],\n      \"default\": []\n    },\n    reviewComments: {\n      type: [GoalComment],\n      \"default\": []\n    },\n    teamId: {\n      type: String,\n      \"default\": \"\"\n    },\n    privacy: {\n      type: String,\n      \"default\": 'private'\n    },\n    createdBy: {\n      type: String,\n      \"default\": ''\n    }\n  },\n  behaviors: {\n    timestamp: {}\n  },\n  helpers: {\n    getGoalRoleGroup: function () {\n      return this.teamName + '+' + this._id;\n    },\n    userIsAdmin: function () {\n      if (Roles.userIsInRole(Meteor.userId(), 'admin', this.teamName) || Roles.userIsInRole(Meteor.userId(), 'admin', this.getGoalRoleGroup())) {\n        //user is either a global admin, a team admin, or a goal admin\n        return true;\n      } else {\n        return false;\n      }\n    },\n    userIsMentor: function () {\n      if (Roles.userIsInRole(Meteor.userId(), 'mentor', this.getGoalRoleGroup())) {\n        //user is a mentor for this goal\n        return true;\n      } else {\n        return false;\n      }\n    },\n    userIsAssigned: function () {\n      if (Roles.userIsInRole(Meteor.userId(), 'assigned', this.getGoalRoleGroup())) {\n        //user is assigned to this goal\n        return true;\n      } else {\n        return false;\n      }\n    },\n    setDateField: function (fieldName, rdate) {\n      if (typeof rdate === \"undefined\") {\n        rdate = new Date();\n      } else if (!(rdate instanceof Date)) {\n        return false;\n      }\n\n      this[fieldName] = rdate;\n      return true;\n    },\n    getUserFullNameX: function (userId) {\n      var u = User.findOne({\n        _id: userId\n      });\n\n      if (!u) {\n        return \"Michael\";\n      }\n\n      var name = u.MyProfile.firstName + \" \" + u.MyProfile.lastName;\n      return name;\n    },\n    hasModifyPerm: function (fieldName) {\n      switch (fieldName) {\n        //admins-only fields\n        case 'dueDate':\n        case 'startDate':\n        case 'reachedDate':\n        case 'reviewDate':\n        case 'title':\n        case 'description':\n        case 'assignedTo':\n        case 'mentors':\n        case 'admins':\n        case 'subgoals':\n          return this.userIsAdmin();\n          break;\n        //admins and mentors\n\n        case 'reviewedOnDate':\n        case 'reviewComments':\n          return this.userIsAdmin() || this.userIsMentor();\n          break;\n        //anyone assigned to the goal\n\n        case 'goalComments':\n          return this.userIsAdmin() || this.userIsMentor() || this.userIsAssigned();\n          break;\n\n        case 'teamId':\n        case 'privacy':\n          return true;\n          break;\n\n        default:\n          return false;\n          break;\n      }\n    },\n    notifyNew: function (oldList, newList) {\n      var diffList = _.difference(newList, oldList);\n\n      for (var i = 0; i < diffList.length; i++) {\n        UserNotify.add({\n          userId: diffList[i],\n          title: 'Goals',\n          body: 'You have been added to goal ' + this.title,\n          action: 'teamgoals:' + this.teamName\n        });\n      }\n    }\n  },\n  events: {\n    beforeSave: function (e) {\n      /*\n      let egoal = e.currentTarget;\n       //any user added to a goal is automatically added to the 'view-goals' role for the team\n      //if they are already in that role, this should just ignore the redundant addUser\n      let flds = [\"assignedTo\",\"mentors\",\"admins\"];\n      for (let i in flds) {\n          if (Array.isArray(egoal[flds[i]]) && egoal[flds[i]].length > 0) {\n              Roles.addUsersToRoles(egoal[flds[i]], 'view-goals', egoal.teamName);\n          }\n      }\n      */\n    }\n  },\n  meteorMethods: {\n    setDueDate: function (rdate) {\n      //admins only\n      if (!this.userIsAdmin()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      if (this.setDateField(\"dueDate\", rdate)) {\n        this.save();\n      } else {\n        throw new Meteor.Error(403, \"Invalid date\");\n      }\n    },\n    setGoalReached: function (rdate) {\n      //admins only\n      if (!this.userIsAdmin()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      if (this.setDateField(\"reachedDate\", rdate)) {\n        this.save();\n      } else {\n        throw new Meteor.Error(403, \"Invalid date\");\n      }\n    },\n    setReviewDate: function (rdate) {\n      //admins only\n      if (!this.userIsAdmin()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      if (this.setDateField(\"reviewDate\", rdate)) {\n        this.save();\n      } else {\n        throw new Meteor.Error(403, \"Invalid date\");\n      }\n    },\n    setGoalReviewedOn: function (rdate) {\n      //mentors and admins\n      if (!this.userIsAdmin() && !this.userIsMentor()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      if (this.setDateField(\"reviewedOnDate\", rdate)) {\n        this.save();\n      } else {\n        throw new Meteor.Error(403, \"Invalid date\");\n      }\n    },\n    addComment: function (commentTxt) {\n      //mentors, admins, and assignees\n      if (!this.userIsAdmin() && !this.userIsMentor() && !this.userIsAssigned()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      this.goalComments.push(new GoalComment({\n        userId: Meteor.userId(),\n        date: new Date(),\n        text: commentTxt\n      }));\n      this.save();\n    },\n    addReviewComment: function (commentTxt) {\n      //mentors and admins\n      if (!this.userIsAdmin() && !this.userIsMentor()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      this.reviewComments.push(new GoalComment({\n        userId: Meteor.userId(),\n        date: new Date(),\n        text: commentTxt\n      }));\n      this.save();\n    },\n    createNewGoal: function () {\n      //admins only\n      if (!this.userIsAdmin()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      } //\n\n    },\n    setTitle: function (title) {\n      //admins only\n      if (!this.userIsAdmin()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      this.title = title;\n      this.save();\n    },\n    setDescription: function (descr) {\n      //admins only\n      if (!this.userIsAdmin()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      this.description = descr;\n      this.save();\n    },\n    setAssignedTo: function (ulist) {\n      //admins only\n      if (!this.userIsAdmin()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      this.notifyNew(this.assignedTo, ulist);\n      this.assignedTo = ulist;\n      this.save();\n    },\n    setMentors: function (ulist) {\n      //admins only\n      if (!this.userIsAdmin()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      this.notifyNew(this.mentors, ulist);\n      this.mentors = ulist;\n      this.save();\n    },\n    setAdmins: function (ulist) {\n      //admins only\n      if (!this.userIsAdmin()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      this.notifyNew(this.admins, ulist);\n      this.admins = ulist;\n      this.save();\n    },\n    getUserFullName: function (userId) {\n      var invocation = DDP._CurrentInvocation.get();\n\n      if (invocation.isSimulation) {\n        return \"George\";\n      }\n\n      var u = User.findOne({\n        _id: userId\n      });\n\n      if (!u) {\n        return \"Michael\";\n      }\n\n      var name = u.MyProfile.firstName + \" \" + u.MyProfile.lastName;\n      return name;\n    },\n    updateFromObj: function (updObj) {\n      var permError = false;\n\n      for (var fld in meteorBabelHelpers.sanitizeForInObject(updObj)) {\n        if (this[fld] !== updObj[fld] || Array.isArray(updObj[fld]) && _.isEqual(this[fld], updObj[fld])) {\n          if (this.hasModifyPerm(fld)) {\n            if (fld === \"assignedTo\" || fld === \"mentors\" || fld === \"admins\") {\n              this.notifyNew(this[fld], updObj[fld]);\n            }\n\n            this[fld] = updObj[fld];\n          } else {\n            permError = true;\n          }\n        }\n      }\n\n      this.save();\n\n      if (permError) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n    }\n  }\n});","map":{"version":3,"sources":["imports/api/individual_goals/individual_goals.js"],"names":["module","export","IndividualGoal","Meteor","watch","require","v","Mongo","User","Class","Enum","UserNotify","GoalComment","create","name","collection","Collection","fields","userId","type","String","title","description","parentId","assignedToStr","reachedDate","Date","optional","startDate","dueDate","reviewDate","reviewedOnDate","goalComments","reviewComments","teamId","privacy","createdBy","behaviors","timestamp","helpers","getGoalRoleGroup","teamName","_id","userIsAdmin","Roles","userIsInRole","userIsMentor","userIsAssigned","setDateField","fieldName","rdate","getUserFullNameX","u","findOne","MyProfile","firstName","lastName","hasModifyPerm","notifyNew","oldList","newList","diffList","_","difference","i","length","add","body","action","events","beforeSave","e","meteorMethods","setDueDate","Error","save","setGoalReached","setReviewDate","setGoalReviewedOn","addComment","commentTxt","push","date","text","addReviewComment","createNewGoal","setTitle","setDescription","descr","setAssignedTo","ulist","assignedTo","setMentors","mentors","setAdmins","admins","getUserFullName","invocation","DDP","_CurrentInvocation","get","isSimulation","updateFromObj","updObj","permError","fld","Array","isArray","isEqual"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Mongo } from 'meteor/mongo';\nimport { User } from '../users/users.js';\nimport { Class, Enum } from 'meteor/jagi:astronomy';\nimport { UserNotify } from '/imports/api/user_notify/user_notify.js';\nimport { GoalComment } from '/imports/api/team_goals/team_goals.js';\n\nconst IndividualGoal = Class.create({\n    name: 'IndividualGoal',\n    collection: new Mongo.Collection('individual_goal'),\n    fields: {\n        userId: {\n            type: String,\n            default: ''\n        },\n        title: {\n            type: String,\n            default: ''\n        },\n        description: {\n            type: String,\n            default: ''\n        },\n        parentId: {\n            type: String,\n            default: ''\n        },\n        assignedToStr: {\n            type: String,\n            transient: true\n        },\n        reachedDate: {\n            type: Date,\n            optional: true\n        },\n        startDate: {\n            type: Date,\n            optional: true\n        },\n        dueDate: {\n            type: Date,\n            optional: true\n        },\n        reviewDate: {\n            type: Date,\n            optional: true\n        },\n        reviewedOnDate: {\n            type: Date,\n            optional: true\n        },\n        goalComments: {\n            type: [GoalComment],\n            default: []\n        },\n        reviewComments: {\n            type: [GoalComment],\n            default: []\n        },\n        teamId: {\n            type: String,\n            default: \"\"\n        },\n        privacy: {\n            type: String,\n            default: 'private'\n        },\n        createdBy: {\n            type: String,\n            default: ''\n        }\n    },\n    behaviors: {\n        timestamp: {}\n    },\n    helpers: {\n        getGoalRoleGroup() {\n            return this.teamName + '+' + this._id;\n        },\n        userIsAdmin() {\n            if (\n              Roles.userIsInRole(Meteor.userId(), 'admin', this.teamName)\n             ||\n              Roles.userIsInRole(Meteor.userId(), 'admin', this.getGoalRoleGroup())\n            ) {\n                //user is either a global admin, a team admin, or a goal admin\n                return true;\n            } else {\n                return false;\n            }\n        },\n        userIsMentor() {\n            if (\n                Roles.userIsInRole(Meteor.userId(), 'mentor', this.getGoalRoleGroup())\n            ) {\n                //user is a mentor for this goal\n                return true;\n            } else {\n                return false;\n            }\n        },\n        userIsAssigned() {\n            if (\n                Roles.userIsInRole(Meteor.userId(), 'assigned', this.getGoalRoleGroup())\n            ) {\n                //user is assigned to this goal\n                return true;\n            } else {\n                return false;\n            }\n        },\n        setDateField(fieldName, rdate) {\n            if ( typeof rdate === \"undefined\") {\n                rdate = new Date();\n            } else if ( !(rdate instanceof Date) ) {\n                return false;\n            }\n            this[fieldName] = rdate;\n            return true;\n        },\n        getUserFullNameX(userId) {\n            let u = User.findOne( {_id: userId} );\n            if (!u) {\n                return \"Michael\";\n            }\n            let name = u.MyProfile.firstName + \" \" + u.MyProfile.lastName;\n            return name;\n        },\n        hasModifyPerm(fieldName) {\n            switch (fieldName) {\n            //admins-only fields\n            case 'dueDate':\n            case 'startDate':\n            case 'reachedDate':\n            case 'reviewDate':\n            case 'title':\n            case 'description':\n            case 'assignedTo':\n            case 'mentors':\n            case 'admins':\n            case 'subgoals':\n                return this.userIsAdmin();\n                break;\n            //admins and mentors\n            case 'reviewedOnDate':\n            case 'reviewComments':\n                return this.userIsAdmin() || this.userIsMentor();\n                break;\n            //anyone assigned to the goal\n            case 'goalComments':\n                return this.userIsAdmin() || this.userIsMentor() || this.userIsAssigned();\n                break;\n            case 'teamId':\n            case 'privacy':\n                return true;\n                break;\n            default:\n                return false;\n                break;\n            }\n        },\n        notifyNew(oldList,newList) {\n            let diffList = _.difference(newList,oldList);\n            for (let i = 0; i < diffList.length; i++) {\n                UserNotify.add({\n                    userId: diffList[i],\n                    title: 'Goals',\n                    body: 'You have been added to goal '+this.title,\n                    action: 'teamgoals:'+this.teamName\n                });\n            }\n        }\n    },\n    events: {\n        beforeSave(e) {\n            /*\n            let egoal = e.currentTarget;\n\n            //any user added to a goal is automatically added to the 'view-goals' role for the team\n            //if they are already in that role, this should just ignore the redundant addUser\n            let flds = [\"assignedTo\",\"mentors\",\"admins\"];\n            for (let i in flds) {\n                if (Array.isArray(egoal[flds[i]]) && egoal[flds[i]].length > 0) {\n                    Roles.addUsersToRoles(egoal[flds[i]], 'view-goals', egoal.teamName);\n                }\n            }\n            */\n        },\n    },\n    meteorMethods: {\n        setDueDate(rdate) {\n            //admins only\n            if ( !this.userIsAdmin() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            if ( this.setDateField(\"dueDate\", rdate) ) {\n                this.save();\n            } else {\n                throw new Meteor.Error(403, \"Invalid date\");\n            }\n        },\n        setGoalReached(rdate) {\n            //admins only\n            if ( !this.userIsAdmin() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            if ( this.setDateField(\"reachedDate\", rdate) ) {\n                this.save();\n            } else {\n                throw new Meteor.Error(403, \"Invalid date\");\n            }\n        },\n        setReviewDate(rdate) {\n            //admins only\n            if ( !this.userIsAdmin() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            if ( this.setDateField(\"reviewDate\", rdate) ) {\n                this.save();\n            } else {\n                throw new Meteor.Error(403, \"Invalid date\");\n            }\n        },\n        setGoalReviewedOn(rdate) {\n            //mentors and admins\n            if ( !this.userIsAdmin() && !this.userIsMentor()) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            if ( this.setDateField(\"reviewedOnDate\", rdate) ) {\n                this.save();\n            } else {\n                throw new Meteor.Error(403, \"Invalid date\");\n            }\n        },\n        addComment(commentTxt) {\n            //mentors, admins, and assignees\n            if ( !this.userIsAdmin() && !this.userIsMentor() && !this.userIsAssigned() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            this.goalComments.push(\n                new GoalComment( {\n                    userId: Meteor.userId(),\n                    date: new Date(),\n                    text: commentTxt,\n                } )\n            );\n            this.save();\n        },\n        addReviewComment(commentTxt) {\n            //mentors and admins\n            if ( !this.userIsAdmin() && !this.userIsMentor() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            this.reviewComments.push(\n                new GoalComment( {\n                    userId: Meteor.userId(),\n                    date: new Date(),\n                    text: commentTxt,\n                } )\n            );\n            this.save();\n        },\n        createNewGoal() {\n            //admins only\n            if ( !this.userIsAdmin() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            //\n        },\n        setTitle(title) {\n            //admins only\n            if ( !this.userIsAdmin() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            this.title = title;\n            this.save();\n        },\n        setDescription(descr) {\n            //admins only\n            if ( !this.userIsAdmin() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            this.description = descr;\n            this.save();\n        },\n        setAssignedTo(ulist) {\n            //admins only\n            if ( !this.userIsAdmin() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            this.notifyNew(this.assignedTo,ulist);\n            this.assignedTo = ulist;\n            this.save();\n        },\n        setMentors(ulist) {\n            //admins only\n            if ( !this.userIsAdmin() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n            this.notifyNew(this.mentors,ulist);\n            this.mentors = ulist;\n            this.save();\n        },\n        setAdmins(ulist) {\n            //admins only\n            if ( !this.userIsAdmin() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            this.notifyNew(this.admins,ulist);\n            this.admins = ulist;\n            this.save();\n        },\n        getUserFullName(userId) {\n            const invocation = DDP._CurrentInvocation.get();\n            if (invocation.isSimulation) {\n                return \"George\";\n            }\n            let u = User.findOne( {_id: userId} );\n            if (!u) {\n                return \"Michael\";\n            }\n            let name = u.MyProfile.firstName + \" \" + u.MyProfile.lastName;\n            return name;\n        },\n        updateFromObj(updObj) {\n            let permError = false;\n\n            for (let fld in updObj) {\n                if (\n                  this[fld] !== updObj[fld] ||\n                  (Array.isArray(updObj[fld]) && _.isEqual(this[fld], updObj[fld]))\n                ) {\n                    if (this.hasModifyPerm(fld)) {\n                        if (fld === \"assignedTo\" || fld === \"mentors\" || fld === \"admins\") {\n                            this.notifyNew(this[fld],updObj[fld]);\n                        }\n                        this[fld] = updObj[fld];\n                    } else {\n                        permError = true;\n                    }\n                }\n            }\n            this.save();\n            if (permError) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n        }\n    }\n});\n\nexport { IndividualGoal };\n"]},"sourceType":"script","hash":"b0ffdd6c0a0fb8c6082f408476bc6af0d561ea2f"}
