{"metadata":{},"options":{"plugins":[{"key":"base$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$1$1","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"base$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$2","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$3","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":true}},{"key":"base$0$4","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$8","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"base$0$9","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$10","visitor":{"_exploded":{},"_verified":{},"PrivateName":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}}],"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\imports\\api\\learn_share\\learn_share.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining","pipelineOperator","throwExpressions","jsx",["flow",{}],["flow",{}],"objectRestSpread","objectRestSpread","dynamicImport","asyncGenerators","classProperties","classPrivateProperties"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"sourceFileName":"imports/api/learn_share/learn_share.js","filename":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\imports\\api\\learn_share\\learn_share.js","passPerPreset":false,"envName":"development","cwd":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan","root":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan","presets":[],"generatorOpts":{"filename":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\imports\\api\\learn_share\\learn_share.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/api/learn_share/learn_share.js"}},"code":"module.export({\n  LearnShareSession: () => LearnShareSession\n});\nlet Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet Mongo;\nmodule.watch(require(\"meteor/mongo\"), {\n  Mongo(v) {\n    Mongo = v;\n  }\n\n}, 1);\nlet Class, Enum;\nmodule.watch(require(\"meteor/jagi:astronomy\"), {\n  Class(v) {\n    Class = v;\n  },\n\n  Enum(v) {\n    Enum = v;\n  }\n\n}, 2);\nlet User;\nmodule.watch(require(\"/imports/api/users/users.js\"), {\n  User(v) {\n    User = v;\n  }\n\n}, 3);\nlet UserNotify;\nmodule.watch(require(\"/imports/api/user_notify/user_notify.js\"), {\n  UserNotify(v) {\n    UserNotify = v;\n  }\n\n}, 4);\nvar fs = {};\n\nif (Meteor.isServer) {\n  fs = Npm.require('fs');\n}\n\nconst LSUser = Class.create({\n  name: 'LSUser',\n  fields: {\n    id: {\n      type: String,\n      default: ''\n    },\n    name: {\n      type: String,\n      default: 'John Doe'\n    }\n  }\n});\nconst LearnShareSession = Class.create({\n  name: \"LearnShareSession\",\n  collection: new Mongo.Collection('learn_share'),\n  fields: {\n    title: {\n      type: String,\n      default: \"unnamed Learn/Share session\"\n    },\n    notes: {\n      type: String,\n      default: \"duly noted\"\n    },\n    participants: {\n      type: [LSUser],\n      default: []\n    },\n    guests: {\n      type: [LSUser],\n      default: []\n    },\n    presenters: {\n      type: [LSUser],\n      default: []\n    },\n    state: {\n      type: String,\n      default: \"active\"\n    },\n    skypeUrl: {\n      type: String,\n      default: \"\"\n    },\n    teamId: {\n      type: String,\n      default: \"\"\n    }\n  },\n  behaviors: {\n    timestamp: {}\n  },\n  meteorMethods: {\n    addPresenter: function (user) {\n      if (\"locked\" === this.state) {\n        return;\n      }\n\n      var lsUser = new LSUser(user); //check for duplicate\n\n      if (typeof _.find(this.presenters, function (o) {\n        return o.id === lsUser.id;\n      }) !== \"undefined\") {\n        return false;\n      }\n\n      this.presenters.push(lsUser);\n      return this.save();\n    },\n    addParticipant: function (user) {\n      if (\"locked\" === this.state) {\n        return;\n      }\n\n      var lsUser = new LSUser(user); //check for duplicate\n\n      if (typeof _.find(this.participants, function (o) {\n        return o.id === lsUser.id;\n      }) !== \"undefined\") {\n        return false;\n      }\n\n      this.participants.push(lsUser);\n      UserNotify.add({\n        userId: lsUser.id,\n        title: 'Learn/Share',\n        body: 'You have been added to a Learn/Share session',\n        action: 'learnshare:' + this._id\n      });\n      return this.save();\n    },\n    removeParticipant: function (userId) {\n      if (\"locked\" === this.state) {\n        return;\n      }\n\n      this.participants = _.filter(this.participants, function (o) {\n        return o.id !== userId;\n      });\n      return this.save();\n    },\n    removeGuest: function (userId) {\n      if (\"locked\" === this.state) {\n        return;\n      }\n\n      this.guests = _.filter(this.guests, function (o) {\n        return o.id !== userId;\n      });\n      return this.save();\n    },\n    removePresenter: function (userId) {\n      if (\"locked\" === this.state) {\n        return;\n      }\n\n      this.presenters = _.filter(this.presenters, function (o) {\n        return o.id !== userId;\n      });\n      return this.save();\n    },\n    addParticipantSelf: function () {\n      if (\"locked\" === this.state) {\n        return;\n      }\n\n      if (Meteor.userId()) {\n        //check for duplicate\n        if (typeof _.find(this.participants, function (o) {\n          return o.id === Meteor.userId();\n        }) === \"undefined\") {\n          let u = User.findOne({\n            _id: Meteor.userId()\n          });\n\n          if (!u) {\n            throw new Meteor.Error(403, \"You are not authorized\");\n          } else {\n            let lsu = new LSUser({\n              id: Meteor.userId(),\n              name: u.MyProfile.firstName + \" \" + u.MyProfile.lastName\n            });\n            this.participants.push(lsu);\n            this.save();\n          }\n        }\n      } else {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n    },\n    saveGuest: function (guestId, guestName) {\n      if (\"locked\" === this.state) {\n        return;\n      }\n\n      let guestObj = _.find(this.guests, function (o) {\n        return o.id === guestId;\n      });\n\n      if (\"undefined\" !== typeof guestObj) {\n        console.log(\"already a guest\");\n        this.guests = _.filter(this.guests, function (o) {\n          return o.id !== guestId;\n        });\n        guestObj.name = guestName;\n      } else {\n        console.log(\"not a guest\");\n        guestObj = new LSUser({\n          id: guestId,\n          name: guestName\n        });\n      }\n\n      this.guests.push(guestObj);\n      this.save();\n    },\n    saveText: function (title, notes) {\n      if (\"locked\" === this.state) {\n        return;\n      }\n\n      if (Roles.userIsInRole(Meteor.userId(), ['admin', 'learn-share-host'], Roles.GLOBAL_GROUP)) {\n        this.title = title;\n        this.notes = notes;\n        this.save();\n      } else {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n    },\n    lockSession: function (title, notes) {\n      if (Roles.userIsInRole(Meteor.userId(), ['admin', 'learn-share-host'], Roles.GLOBAL_GROUP)) {\n        this.state = \"locked\";\n        this.save();\n      } else {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n    },\n    unlockSession: function (title, notes) {\n      if (Roles.userIsInRole(Meteor.userId(), ['admin', 'learn-share-host'], Roles.GLOBAL_GROUP)) {\n        this.state = \"active\";\n        this.save();\n      } else {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n    },\n    setSkypeUrl: function (url) {\n      if (Roles.userIsInRole(Meteor.userId(), ['admin', 'learn-share-host'], Roles.GLOBAL_GROUP)) {\n        this.skypeUrl = url;\n        this.save();\n      }\n    },\n\n    uploadRecording(fileInfo, fileData) {\n      if (Meteor.isServer && Roles.userIsInRole(Meteor.userId(), ['admin', 'learn-share-host'], Roles.GLOBAL_GROUP)) {\n        let uploadPath = '/uploads/';\n        fs.writeFile(uploadPath + this._id + \".mp4\", fileData, 'binary', err => {\n          console.log(\"File written.\", err);\n        });\n      }\n    }\n\n  }\n});","map":{"version":3,"sources":["imports/api/learn_share/learn_share.js"],"names":["module","export","LearnShareSession","Meteor","watch","require","v","Mongo","Class","Enum","User","UserNotify","fs","isServer","Npm","LSUser","create","name","fields","id","type","String","default","collection","Collection","title","notes","participants","guests","presenters","state","skypeUrl","teamId","behaviors","timestamp","meteorMethods","addPresenter","user","lsUser","_","find","o","push","save","addParticipant","add","userId","body","action","_id","removeParticipant","filter","removeGuest","removePresenter","addParticipantSelf","u","findOne","Error","lsu","MyProfile","firstName","lastName","saveGuest","guestId","guestName","guestObj","console","log","saveText","Roles","userIsInRole","GLOBAL_GROUP","lockSession","unlockSession","setSkypeUrl","url","uploadRecording","fileInfo","fileData","uploadPath","writeFile","err"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Mongo } from 'meteor/mongo';\nimport { Class, Enum } from 'meteor/jagi:astronomy';\nimport { User } from '/imports/api/users/users.js';\nimport { UserNotify } from '/imports/api/user_notify/user_notify.js';\n\nvar fs = {};\nif (Meteor.isServer) {\n    fs = Npm.require('fs');\n}\n\nconst LSUser = Class.create({\n    name: 'LSUser',\n    fields: {\n        id: {\n            type: String,\n            default: ''\n        },\n        name: {\n            type: String,\n            default: 'John Doe'\n        }\n    }\n});\n\nconst LearnShareSession = Class.create({\n    name: \"LearnShareSession\",\n    collection: new Mongo.Collection('learn_share'),\n    fields: {\n        title: {\n            type: String,\n            default: \"unnamed Learn/Share session\"\n        },\n        notes: {\n            type: String,\n            default: \"duly noted\"\n        },\n        participants: {\n            type: [LSUser],\n            default: []\n        },\n        guests: {\n            type: [LSUser],\n            default: []\n        },\n        presenters: {\n            type: [LSUser],\n            default: []\n        },\n        state: {\n            type: String,\n            default: \"active\"\n        },\n        skypeUrl: {\n            type: String,\n            default: \"\"\n        },\n        teamId: {\n            type: String,\n            default: \"\"\n        }\n    },\n    behaviors: {\n        timestamp: {}\n    },\n    meteorMethods: {\n        addPresenter: function (user) {\n            if (\"locked\" === this.state) {\n                return;\n            }\n            var lsUser = new LSUser(user);\n\n            //check for duplicate\n            if (typeof _.find(this.presenters, function(o) {return o.id===lsUser.id;}) !== \"undefined\") {\n                return false;\n            }\n            this.presenters.push(lsUser);\n            return this.save();\n        },\n        addParticipant: function (user) {\n            if (\"locked\" === this.state) {\n                return;\n            }\n            var lsUser = new LSUser(user);\n\n            //check for duplicate\n            if (typeof _.find(this.participants, function(o) {return o.id===lsUser.id;}) !== \"undefined\") {\n                return false;\n            }\n            this.participants.push(lsUser);\n            UserNotify.add({\n                userId: lsUser.id,\n                title: 'Learn/Share',\n                body: 'You have been added to a Learn/Share session',\n                action: 'learnshare:'+this._id\n            });\n            return this.save();\n        },\n        removeParticipant: function (userId) {\n            if (\"locked\" === this.state) {\n                return;\n            }\n            this.participants = _.filter(this.participants, function (o) {return o.id!==userId});\n            return this.save();\n        },\n        removeGuest: function (userId) {\n            if (\"locked\" === this.state) {\n                return;\n            }\n            this.guests = _.filter(this.guests, function (o) {return o.id!==userId});\n            return this.save();\n        },\n        removePresenter: function (userId) {\n            if (\"locked\" === this.state) {\n                return;\n            }\n            this.presenters = _.filter(this.presenters, function (o) {return o.id!==userId});\n            return this.save();\n        },\n        addParticipantSelf: function () {\n            if (\"locked\" === this.state) {\n                return;\n            }\n            if (Meteor.userId()) {\n                //check for duplicate\n                if (typeof _.find(this.participants, function(o) {return o.id===Meteor.userId();}) === \"undefined\") {\n                    let u = User.findOne( {_id: Meteor.userId()} );\n                    if (!u) {\n                        throw new Meteor.Error(403, \"You are not authorized\");\n                    } else {\n                        let lsu = new LSUser({\n                            id: Meteor.userId(),\n                            name: u.MyProfile.firstName + \" \" + u.MyProfile.lastName\n                        })\n                        this.participants.push(lsu);\n                        this.save();\n                    }\n                }\n            } else {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n        },\n        saveGuest: function(guestId, guestName) {\n            if (\"locked\" === this.state) {\n                return;\n            }\n            let guestObj = _.find(this.guests, function(o) {return o.id===guestId;});\n            if (\"undefined\" !== typeof guestObj) {\n                console.log(\"already a guest\");\n                this.guests = _.filter(this.guests, function(o) {return o.id!==guestId});\n                guestObj.name = guestName;\n            } else {\n                console.log(\"not a guest\");\n                guestObj = new LSUser({id: guestId, name: guestName});\n            }\n            this.guests.push(guestObj);\n            this.save();\n        },\n        saveText: function (title, notes) {\n            if (\"locked\" === this.state) {\n                return;\n            }\n            if (Roles.userIsInRole(Meteor.userId(), ['admin','learn-share-host'], Roles.GLOBAL_GROUP)) {\n                this.title = title;\n                this.notes = notes;\n                this.save();\n            } else {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n        },\n        lockSession: function (title, notes) {\n            if (Roles.userIsInRole(Meteor.userId(), ['admin','learn-share-host'], Roles.GLOBAL_GROUP)) {\n                this.state = \"locked\";\n                this.save();\n            } else {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n        },\n        unlockSession: function (title, notes) {\n            if (Roles.userIsInRole(Meteor.userId(), ['admin','learn-share-host'], Roles.GLOBAL_GROUP)) {\n                this.state = \"active\";\n                this.save();\n            } else {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n        },\n        setSkypeUrl: function (url) {\n            if (Roles.userIsInRole(Meteor.userId(), ['admin','learn-share-host'], Roles.GLOBAL_GROUP)) {\n                this.skypeUrl = url;\n                this.save();\n            }\n        },\n        uploadRecording(fileInfo, fileData) {\n            if (Meteor.isServer && Roles.userIsInRole(Meteor.userId(), ['admin','learn-share-host'], Roles.GLOBAL_GROUP)) {\n                let uploadPath = '/uploads/';\n                fs.writeFile(uploadPath+this._id+\".mp4\", fileData, 'binary', (err) => {\n                    console.log(\"File written.\", err);\n                });\n            }\n        }\n    }\n});\n\nexport { LearnShareSession };\n"]},"sourceType":"script","hash":"94b7b5c93a35b998d73f624c2ff4d49292041bb8"}
