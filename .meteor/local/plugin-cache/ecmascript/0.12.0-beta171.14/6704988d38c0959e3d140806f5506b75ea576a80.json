{"metadata":{},"options":{"plugins":[{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$2","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":false}},{"key":"base$0$3","visitor":{"_exploded":{},"_verified":{},"PrivateName":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}},{"key":"base$0$4","visitor":{"FunctionExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"ForInStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$6","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$0$1$1","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$0","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$2","visitor":{"ArrowFunctionExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$3","visitor":{"BlockStatement":{"enter":[null]},"SwitchCase":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$4","visitor":{"VariableDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"_exploded":true,"BlockStatement":{"enter":[null]},"SwitchStatement":{"enter":[null]},"Program":{"enter":[null]},"_verified":true,"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$5","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$6","visitor":{"ObjectExpression":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$7","visitor":{"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"VariableDeclaration":{"enter":[null]},"_exploded":true,"_verified":true,"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$8","visitor":{"ForOfStatement":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$9","visitor":{"NumericLiteral":{"enter":[null]},"StringLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$10","visitor":{"ObjectExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$11","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$12","visitor":{"ObjectMethod":{"enter":[null]},"ObjectProperty":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$13","visitor":{"ArrayExpression":{"enter":[null]},"CallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$14","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$15","visitor":{"TaggedTemplateExpression":{"enter":[null]},"TemplateLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"loose":true}},{"key":"base$0$0$16","visitor":{"UnaryExpression":{"enter":[null]},"_exploded":true,"_verified":true,"BlockStatement":{"enter":[null]},"CatchClause":{"enter":[null]},"DoWhileStatement":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForStatement":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"Program":{"enter":[null]},"ObjectMethod":{"enter":[null]},"SwitchStatement":{"enter":[null]},"WhileStatement":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"ForOfStatement":{"enter":[null]},"ClassMethod":{"enter":[null]}},"options":{}},{"key":"base$0$0$17","visitor":{"RegExpLiteral":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$18","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$19","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"base$0$0$20","visitor":{"ObjectProperty":{"exit":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$21","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$0$22","visitor":{"AssignmentExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0$23","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"regenerator-transform","visitor":{"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{}}],"presets":[],"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\imports\\api\\team_goals\\team_goals.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining","pipelineOperator","throwExpressions","dynamicImport","classProperties","classPrivateProperties","jsx",["flow",{}],"asyncGenerators","objectRestSpread","objectRestSpread",["flow",{}],"asyncGenerators"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"sourceFileName":"imports/api/team_goals/team_goals.js","filename":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\imports\\api\\team_goals\\team_goals.js","passPerPreset":false,"envName":"development","cwd":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan","root":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan","generatorOpts":{"filename":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\imports\\api\\team_goals\\team_goals.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/api/team_goals/team_goals.js"}},"code":"module.export({\n  TeamGoal: function () {\n    return TeamGoal;\n  },\n  GoalComment: function () {\n    return GoalComment;\n  }\n});\nvar Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor: function (v) {\n    Meteor = v;\n  }\n}, 0);\nvar Mongo;\nmodule.watch(require(\"meteor/mongo\"), {\n  Mongo: function (v) {\n    Mongo = v;\n  }\n}, 1);\nvar User;\nmodule.watch(require(\"../users/users.js\"), {\n  User: function (v) {\n    User = v;\n  }\n}, 2);\nvar Class, Enum;\nmodule.watch(require(\"meteor/jagi:astronomy\"), {\n  Class: function (v) {\n    Class = v;\n  },\n  Enum: function (v) {\n    Enum = v;\n  }\n}, 3);\nvar UserNotify;\nmodule.watch(require(\"/imports/api/user_notify/user_notify.js\"), {\n  UserNotify: function (v) {\n    UserNotify = v;\n  }\n}, 4);\nvar GoalComment = Class.create({\n  name: 'GoalComment',\n  fields: {\n    userId: {\n      type: String,\n      \"default\": function () {\n        return Meteor.userId();\n      }\n    },\n    date: {\n      type: Date,\n      \"default\": function () {\n        return new Date();\n      }\n    },\n    text: {\n      type: String,\n      \"default\": ''\n    }\n  }\n});\nvar TeamGoal = Class.create({\n  name: 'TeamGoal',\n  collection: new Mongo.Collection('team_goal'),\n  fields: {\n    teamName: {\n      type: String,\n      \"default\": ''\n    },\n    title: {\n      type: String,\n      \"default\": ''\n    },\n    description: {\n      type: String,\n      \"default\": ''\n    },\n    parentId: {\n      type: String,\n      \"default\": ''\n    },\n    assignedTo: {\n      type: [String],\n      \"default\": []\n    },\n    mentors: {\n      type: [String],\n      \"default\": []\n    },\n    assignedToStr: {\n      type: String,\n      \"transient\": true\n    },\n    mentorsStr: {\n      type: String,\n      \"transient\": true\n    },\n    adminsStr: {\n      type: String,\n      \"transient\": true\n    },\n    admins: {\n      type: [String],\n      \"default\": []\n    },\n    reachedDate: {\n      type: Date,\n      optional: true\n    },\n    startDate: {\n      type: Date,\n      optional: true\n    },\n    dueDate: {\n      type: Date,\n      optional: true\n    },\n    reviewDate: {\n      type: Date,\n      optional: true\n    },\n    reviewedOnDate: {\n      type: Date,\n      optional: true\n    },\n    goalComments: {\n      type: [GoalComment],\n      \"default\": []\n    },\n    reviewComments: {\n      type: [GoalComment],\n      \"default\": []\n    }\n  },\n  behaviors: {\n    timestamp: {}\n  },\n  helpers: {\n    getGoalRoleGroup: function () {\n      return this.teamName + '+' + this._id;\n    },\n    userIsAdmin: function () {\n      if (Roles.userIsInRole(Meteor.userId(), 'admin', this.teamName) || Roles.userIsInRole(Meteor.userId(), 'admin', this.getGoalRoleGroup())) {\n        //user is either a global admin, a team admin, or a goal admin\n        return true;\n      } else {\n        return false;\n      }\n    },\n    userIsMentor: function () {\n      if (Roles.userIsInRole(Meteor.userId(), 'mentor', this.getGoalRoleGroup())) {\n        //user is a mentor for this goal\n        return true;\n      } else {\n        return false;\n      }\n    },\n    userIsAssigned: function () {\n      if (Roles.userIsInRole(Meteor.userId(), 'assigned', this.getGoalRoleGroup())) {\n        //user is assigned to this goal\n        return true;\n      } else {\n        return false;\n      }\n    },\n    setDateField: function (fieldName, rdate) {\n      if (typeof rdate === \"undefined\") {\n        rdate = new Date();\n      } else if (!(rdate instanceof Date)) {\n        return false;\n      }\n\n      this[fieldName] = rdate;\n      return true;\n    },\n    getUserFullNameX: function (userId) {\n      var u = User.findOne({\n        _id: userId\n      });\n\n      if (!u) {\n        return \"Michael\";\n      }\n\n      var name = u.MyProfile.firstName + \" \" + u.MyProfile.lastName;\n      return name;\n    },\n    hasModifyPerm: function (fieldName) {\n      switch (fieldName) {\n        //admins-only fields\n        case 'dueDate':\n        case 'startDate':\n        case 'reachedDate':\n        case 'reviewDate':\n        case 'title':\n        case 'description':\n        case 'assignedTo':\n        case 'mentors':\n        case 'admins':\n        case 'subgoals':\n          return this.userIsAdmin();\n          break;\n        //admins and mentors\n\n        case 'reviewedOnDate':\n        case 'reviewComments':\n          return this.userIsAdmin() || this.userIsMentor();\n          break;\n        //anyone assigned to the goal\n\n        case 'goalComments':\n          return this.userIsAdmin() || this.userIsMentor() || this.userIsAssigned();\n          break;\n\n        default:\n          return false;\n          break;\n      }\n    },\n    notifyNew: function (oldList, newList) {\n      var diffList = _.difference(newList, oldList);\n\n      for (var i = 0; i < diffList.length; i++) {\n        UserNotify.add({\n          userId: diffList[i],\n          title: 'Team Goals',\n          body: 'You have been added to goal ' + this.title,\n          action: 'teamgoals:' + this.teamName\n        });\n      }\n    }\n  },\n  events: {\n    beforeSave: function (e) {\n      var egoal = e.currentTarget; //any user added to a goal is automatically added to the 'view-goals' role for the team\n      //if they are already in that role, this should just ignore the redundant addUser\n\n      var flds = [\"assignedTo\", \"mentors\", \"admins\"];\n\n      for (var i in meteorBabelHelpers.sanitizeForInObject(flds)) {\n        if (Array.isArray(egoal[flds[i]]) && egoal[flds[i]].length > 0) {\n          Roles.addUsersToRoles(egoal[flds[i]], 'view-goals', egoal.teamName);\n        }\n      }\n    }\n  },\n  meteorMethods: {\n    setDueDate: function (rdate) {\n      //admins only\n      if (!this.userIsAdmin()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      if (this.setDateField(\"dueDate\", rdate)) {\n        this.save();\n      } else {\n        throw new Meteor.Error(403, \"Invalid date\");\n      }\n    },\n    setGoalReached: function (rdate) {\n      //admins only\n      if (!this.userIsAdmin()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      if (this.setDateField(\"reachedDate\", rdate)) {\n        this.save();\n      } else {\n        throw new Meteor.Error(403, \"Invalid date\");\n      }\n    },\n    setReviewDate: function (rdate) {\n      //admins only\n      if (!this.userIsAdmin()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      if (this.setDateField(\"reviewDate\", rdate)) {\n        this.save();\n      } else {\n        throw new Meteor.Error(403, \"Invalid date\");\n      }\n    },\n    setGoalReviewedOn: function (rdate) {\n      //mentors and admins\n      if (!this.userIsAdmin() && !this.userIsMentor()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      if (this.setDateField(\"reviewedOnDate\", rdate)) {\n        this.save();\n      } else {\n        throw new Meteor.Error(403, \"Invalid date\");\n      }\n    },\n    addComment: function (commentTxt) {\n      //mentors, admins, and assignees\n      if (!this.userIsAdmin() && !this.userIsMentor() && !this.userIsAssigned()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      this.goalComments.push(new GoalComment({\n        userId: Meteor.userId(),\n        date: new Date(),\n        text: commentTxt\n      }));\n      this.save();\n    },\n    addReviewComment: function (commentTxt) {\n      //mentors and admins\n      if (!this.userIsAdmin() && !this.userIsMentor()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      this.reviewComments.push(new GoalComment({\n        userId: Meteor.userId(),\n        date: new Date(),\n        text: commentTxt\n      }));\n      this.save();\n    },\n    createNewGoal: function () {\n      //admins only\n      if (!this.userIsAdmin()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      } //\n\n    },\n    setTitle: function (title) {\n      //admins only\n      if (!this.userIsAdmin()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      this.title = title;\n      this.save();\n    },\n    setDescription: function (descr) {\n      //admins only\n      if (!this.userIsAdmin()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      this.description = descr;\n      this.save();\n    },\n    setAssignedTo: function (ulist) {\n      //admins only\n      if (!this.userIsAdmin()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      this.notifyNew(this.assignedTo, ulist);\n      this.assignedTo = ulist;\n      this.save();\n    },\n    setMentors: function (ulist) {\n      //admins only\n      if (!this.userIsAdmin()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      this.notifyNew(this.mentors, ulist);\n      this.mentors = ulist;\n      this.save();\n    },\n    setAdmins: function (ulist) {\n      //admins only\n      if (!this.userIsAdmin()) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n\n      this.notifyNew(this.admins, ulist);\n      this.admins = ulist;\n      this.save();\n    },\n    getUserFullName: function (userId) {\n      var invocation = DDP._CurrentInvocation.get();\n\n      if (invocation.isSimulation) {\n        return \"George\";\n      }\n\n      var u = User.findOne({\n        _id: userId\n      });\n\n      if (!u) {\n        return \"Michael\";\n      }\n\n      var name = u.MyProfile.firstName + \" \" + u.MyProfile.lastName;\n      return name;\n    },\n    updateFromObj: function (updObj) {\n      var permError = false;\n\n      for (var fld in meteorBabelHelpers.sanitizeForInObject(updObj)) {\n        if (this[fld] !== updObj[fld] || Array.isArray(updObj[fld]) && _.isEqual(this[fld], updObj[fld])) {\n          if (this.hasModifyPerm(fld)) {\n            if (fld === \"assignedTo\" || fld === \"mentors\" || fld === \"admins\") {\n              this.notifyNew(this[fld], updObj[fld]);\n            }\n\n            this[fld] = updObj[fld];\n          } else {\n            permError = true;\n          }\n        }\n      }\n\n      this.save();\n\n      if (permError) {\n        throw new Meteor.Error(403, \"You are not authorized\");\n      }\n    }\n  }\n});","map":{"version":3,"sources":["imports/api/team_goals/team_goals.js"],"names":["module","export","TeamGoal","GoalComment","Meteor","watch","require","v","Mongo","User","Class","Enum","UserNotify","create","name","fields","userId","type","String","date","Date","text","collection","Collection","teamName","title","description","parentId","assignedTo","mentors","assignedToStr","mentorsStr","adminsStr","admins","reachedDate","optional","startDate","dueDate","reviewDate","reviewedOnDate","goalComments","reviewComments","behaviors","timestamp","helpers","getGoalRoleGroup","_id","userIsAdmin","Roles","userIsInRole","userIsMentor","userIsAssigned","setDateField","fieldName","rdate","getUserFullNameX","u","findOne","MyProfile","firstName","lastName","hasModifyPerm","notifyNew","oldList","newList","diffList","_","difference","i","length","add","body","action","events","beforeSave","e","egoal","currentTarget","flds","Array","isArray","addUsersToRoles","meteorMethods","setDueDate","Error","save","setGoalReached","setReviewDate","setGoalReviewedOn","addComment","commentTxt","push","addReviewComment","createNewGoal","setTitle","setDescription","descr","setAssignedTo","ulist","setMentors","setAdmins","getUserFullName","invocation","DDP","_CurrentInvocation","get","isSimulation","updateFromObj","updObj","permError","fld","isEqual"],"mappings":"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","sourcesContent":["import { Meteor } from 'meteor/meteor';\nimport { Mongo } from 'meteor/mongo';\nimport { User } from '../users/users.js';\nimport { Class, Enum } from 'meteor/jagi:astronomy';\nimport { UserNotify } from '/imports/api/user_notify/user_notify.js';\n\nconst GoalComment = Class.create({\n    name: 'GoalComment',\n    fields: {\n        userId: {\n            type: String,\n            default: function() { return Meteor.userId(); }\n        },\n        date: {\n            type: Date,\n            default: function() { return new Date(); }\n        },\n        text: {\n            type: String,\n            default: ''\n        }\n    }\n});\n\nconst TeamGoal = Class.create({\n    name: 'TeamGoal',\n    collection: new Mongo.Collection('team_goal'),\n    fields: {\n        teamName: {\n            type: String,\n            default: ''\n        },\n        title: {\n            type: String,\n            default: ''\n        },\n        description: {\n            type: String,\n            default: ''\n        },\n        parentId: {\n            type: String,\n            default: ''\n        },\n        assignedTo: {\n            type: [String],\n            default: []\n        },\n        mentors: {\n            type: [String],\n            default: []\n        },\n        assignedToStr: {\n            type: String,\n            transient: true\n        },\n        mentorsStr: {\n            type: String,\n            transient: true\n        },\n        adminsStr: {\n            type: String,\n            transient: true\n        },\n        admins: {\n            type: [String],\n            default: []\n        },\n        reachedDate: {\n            type: Date,\n            optional: true\n        },\n        startDate: {\n            type: Date,\n            optional: true\n        },\n        dueDate: {\n            type: Date,\n            optional: true\n        },\n        reviewDate: {\n            type: Date,\n            optional: true\n        },\n        reviewedOnDate: {\n            type: Date,\n            optional: true\n        },\n        goalComments: {\n            type: [GoalComment],\n            default: []\n        },\n        reviewComments: {\n            type: [GoalComment],\n            default: []\n        }\n    },\n    behaviors: {\n        timestamp: {}\n    },\n    helpers: {\n        getGoalRoleGroup() {\n            return this.teamName + '+' + this._id;\n        },\n        userIsAdmin() {\n            if (\n              Roles.userIsInRole(Meteor.userId(), 'admin', this.teamName)\n             ||\n              Roles.userIsInRole(Meteor.userId(), 'admin', this.getGoalRoleGroup())\n            ) {\n                //user is either a global admin, a team admin, or a goal admin\n                return true;\n            } else {\n                return false;\n            }\n        },\n        userIsMentor() {\n            if (\n                Roles.userIsInRole(Meteor.userId(), 'mentor', this.getGoalRoleGroup())\n            ) {\n                //user is a mentor for this goal\n                return true;\n            } else {\n                return false;\n            }\n        },\n        userIsAssigned() {\n            if (\n                Roles.userIsInRole(Meteor.userId(), 'assigned', this.getGoalRoleGroup())\n            ) {\n                //user is assigned to this goal\n                return true;\n            } else {\n                return false;\n            }\n        },\n        setDateField(fieldName, rdate) {\n            if ( typeof rdate === \"undefined\") {\n                rdate = new Date();\n            } else if ( !(rdate instanceof Date) ) {\n                return false;\n            }\n            this[fieldName] = rdate;\n            return true;\n        },\n        getUserFullNameX(userId) {\n            let u = User.findOne( {_id: userId} );\n            if (!u) {\n                return \"Michael\";\n            }\n            let name = u.MyProfile.firstName + \" \" + u.MyProfile.lastName;\n            return name;\n        },\n        hasModifyPerm(fieldName) {\n            switch (fieldName) {\n            //admins-only fields\n            case 'dueDate':\n            case 'startDate':\n            case 'reachedDate':\n            case 'reviewDate':\n            case 'title':\n            case 'description':\n            case 'assignedTo':\n            case 'mentors':\n            case 'admins':\n            case 'subgoals':\n                return this.userIsAdmin();\n                break;\n            //admins and mentors\n            case 'reviewedOnDate':\n            case 'reviewComments':\n                return this.userIsAdmin() || this.userIsMentor();\n                break;\n            //anyone assigned to the goal\n            case 'goalComments':\n                return this.userIsAdmin() || this.userIsMentor() || this.userIsAssigned();\n                break;\n            default:\n                return false;\n                break;\n            }\n        },\n        notifyNew(oldList,newList) {\n            let diffList = _.difference(newList,oldList);\n            for (let i = 0; i < diffList.length; i++) {\n                UserNotify.add({\n                    userId: diffList[i],\n                    title: 'Team Goals',\n                    body: 'You have been added to goal '+this.title,\n                    action: 'teamgoals:'+this.teamName\n                });\n            }\n        }\n    },\n    events: {\n        beforeSave(e) {\n            let egoal = e.currentTarget;\n\n            //any user added to a goal is automatically added to the 'view-goals' role for the team\n            //if they are already in that role, this should just ignore the redundant addUser\n            let flds = [\"assignedTo\",\"mentors\",\"admins\"];\n            for (let i in flds) {\n                if (Array.isArray(egoal[flds[i]]) && egoal[flds[i]].length > 0) {\n                    Roles.addUsersToRoles(egoal[flds[i]], 'view-goals', egoal.teamName);\n                }\n            }\n        },\n    },\n    meteorMethods: {\n        setDueDate(rdate) {\n            //admins only\n            if ( !this.userIsAdmin() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            if ( this.setDateField(\"dueDate\", rdate) ) {\n                this.save();\n            } else {\n                throw new Meteor.Error(403, \"Invalid date\");\n            }\n        },\n        setGoalReached(rdate) {\n            //admins only\n            if ( !this.userIsAdmin() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            if ( this.setDateField(\"reachedDate\", rdate) ) {\n                this.save();\n            } else {\n                throw new Meteor.Error(403, \"Invalid date\");\n            }\n        },\n        setReviewDate(rdate) {\n            //admins only\n            if ( !this.userIsAdmin() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            if ( this.setDateField(\"reviewDate\", rdate) ) {\n                this.save();\n            } else {\n                throw new Meteor.Error(403, \"Invalid date\");\n            }\n        },\n        setGoalReviewedOn(rdate) {\n            //mentors and admins\n            if ( !this.userIsAdmin() && !this.userIsMentor()) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            if ( this.setDateField(\"reviewedOnDate\", rdate) ) {\n                this.save();\n            } else {\n                throw new Meteor.Error(403, \"Invalid date\");\n            }\n        },\n        addComment(commentTxt) {\n            //mentors, admins, and assignees\n            if ( !this.userIsAdmin() && !this.userIsMentor() && !this.userIsAssigned() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            this.goalComments.push(\n                new GoalComment( {\n                    userId: Meteor.userId(),\n                    date: new Date(),\n                    text: commentTxt,\n                } )\n            );\n            this.save();\n        },\n        addReviewComment(commentTxt) {\n            //mentors and admins\n            if ( !this.userIsAdmin() && !this.userIsMentor() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            this.reviewComments.push(\n                new GoalComment( {\n                    userId: Meteor.userId(),\n                    date: new Date(),\n                    text: commentTxt,\n                } )\n            );\n            this.save();\n        },\n        createNewGoal() {\n            //admins only\n            if ( !this.userIsAdmin() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            //\n        },\n        setTitle(title) {\n            //admins only\n            if ( !this.userIsAdmin() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            this.title = title;\n            this.save();\n        },\n        setDescription(descr) {\n            //admins only\n            if ( !this.userIsAdmin() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            this.description = descr;\n            this.save();\n        },\n        setAssignedTo(ulist) {\n            //admins only\n            if ( !this.userIsAdmin() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            this.notifyNew(this.assignedTo,ulist);\n            this.assignedTo = ulist;\n            this.save();\n        },\n        setMentors(ulist) {\n            //admins only\n            if ( !this.userIsAdmin() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n            this.notifyNew(this.mentors,ulist);\n            this.mentors = ulist;\n            this.save();\n        },\n        setAdmins(ulist) {\n            //admins only\n            if ( !this.userIsAdmin() ) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n\n            this.notifyNew(this.admins,ulist);\n            this.admins = ulist;\n            this.save();\n        },\n        getUserFullName(userId) {\n            const invocation = DDP._CurrentInvocation.get();\n            if (invocation.isSimulation) {\n                return \"George\";\n            }\n            let u = User.findOne( {_id: userId} );\n            if (!u) {\n                return \"Michael\";\n            }\n            let name = u.MyProfile.firstName + \" \" + u.MyProfile.lastName;\n            return name;\n        },\n        updateFromObj(updObj) {\n            let permError = false;\n\n            for (let fld in updObj) {\n                if (\n                  this[fld] !== updObj[fld] ||\n                  (Array.isArray(updObj[fld]) && _.isEqual(this[fld], updObj[fld]))\n                ) {\n                    if (this.hasModifyPerm(fld)) {\n                        if (fld === \"assignedTo\" || fld === \"mentors\" || fld === \"admins\") {\n                            this.notifyNew(this[fld],updObj[fld]);\n                        }\n                        this[fld] = updObj[fld];\n                    } else {\n                        permError = true;\n                    }\n                }\n            }\n            this.save();\n            if (permError) {\n                throw new Meteor.Error(403, \"You are not authorized\");\n            }\n        }\n    }\n});\n\nexport { TeamGoal, GoalComment };\n"]},"sourceType":"script","hash":"6704988d38c0959e3d140806f5506b75ea576a80"}
