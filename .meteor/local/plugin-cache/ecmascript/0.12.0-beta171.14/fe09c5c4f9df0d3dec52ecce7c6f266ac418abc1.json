{"metadata":{},"options":{"plugins":[{"key":"base$1$0","visitor":{"_exploded":{},"_verified":{},"JSXNamespacedName":{"enter":[null]},"JSXElement":{"exit":[null]},"JSXFragment":{"exit":[null]},"Program":{"enter":[null],"exit":[null]},"JSXAttribute":{"enter":[null]}},"options":{"pragma":"React.createElement","pragmaFrag":"React.Fragment","throwIfNamespace":true,"useBuiltIns":false}},{"key":"base$1$1","visitor":{"ExportDefaultDeclaration":{"enter":[null]},"CallExpression":{"enter":[null]},"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$0","visitor":{"Program":{"enter":[null]},"_exploded":true,"_verified":true},"options":{"generateLetDeclarations":true,"enforceStrictMode":false}},{"key":"base$0$1","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$2","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]},"ImportDeclaration":{"enter":[null,null]},"ClassProperty":{"enter":[null]},"AssignmentPattern":{"enter":[null]},"TypeCastExpression":{"enter":[null,null]},"CallExpression":{"enter":[null]},"OptionalCallExpression":{"enter":[null]},"NewExpression":{"enter":[null]},"ImportSpecifier":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"AnyTypeAnnotation":{"enter":[null]},"ArrayTypeAnnotation":{"enter":[null]},"BooleanTypeAnnotation":{"enter":[null]},"BooleanLiteralTypeAnnotation":{"enter":[null]},"NullLiteralTypeAnnotation":{"enter":[null]},"ClassImplements":{"enter":[null]},"DeclareClass":{"enter":[null]},"DeclareFunction":{"enter":[null]},"DeclareInterface":{"enter":[null]},"DeclareModule":{"enter":[null]},"DeclareModuleExports":{"enter":[null]},"DeclareTypeAlias":{"enter":[null]},"DeclareOpaqueType":{"enter":[null]},"DeclareVariable":{"enter":[null]},"DeclareExportDeclaration":{"enter":[null]},"DeclareExportAllDeclaration":{"enter":[null]},"DeclaredPredicate":{"enter":[null]},"ExistsTypeAnnotation":{"enter":[null]},"FunctionTypeAnnotation":{"enter":[null]},"FunctionTypeParam":{"enter":[null]},"GenericTypeAnnotation":{"enter":[null]},"InferredPredicate":{"enter":[null]},"InterfaceExtends":{"enter":[null]},"InterfaceDeclaration":{"enter":[null]},"InterfaceTypeAnnotation":{"enter":[null]},"IntersectionTypeAnnotation":{"enter":[null]},"MixedTypeAnnotation":{"enter":[null]},"EmptyTypeAnnotation":{"enter":[null]},"NullableTypeAnnotation":{"enter":[null]},"NumberLiteralTypeAnnotation":{"enter":[null]},"NumberTypeAnnotation":{"enter":[null]},"ObjectTypeAnnotation":{"enter":[null]},"ObjectTypeInternalSlot":{"enter":[null]},"ObjectTypeCallProperty":{"enter":[null]},"ObjectTypeIndexer":{"enter":[null]},"ObjectTypeProperty":{"enter":[null]},"ObjectTypeSpreadProperty":{"enter":[null]},"OpaqueType":{"enter":[null]},"QualifiedTypeIdentifier":{"enter":[null]},"StringLiteralTypeAnnotation":{"enter":[null]},"StringTypeAnnotation":{"enter":[null]},"ThisTypeAnnotation":{"enter":[null]},"TupleTypeAnnotation":{"enter":[null]},"TypeofTypeAnnotation":{"enter":[null]},"TypeAlias":{"enter":[null]},"TypeAnnotation":{"enter":[null]},"TypeParameter":{"enter":[null]},"TypeParameterDeclaration":{"enter":[null]},"TypeParameterInstantiation":{"enter":[null]},"UnionTypeAnnotation":{"enter":[null]},"Variance":{"enter":[null]},"VoidTypeAnnotation":{"enter":[null]},"ExportAllDeclaration":{"enter":[null]},"ExportDefaultDeclaration":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]}},"options":{}},{"key":"base$0$3","visitor":{"CallExpression":{"enter":[null]},"BinaryExpression":{"enter":[null]},"MemberExpression":{"enter":[null],"exit":[null]},"_exploded":true,"_verified":true,"Identifier":{"enter":[null]},"JSXIdentifier":{"enter":[null]}},"options":{"polyfill":false,"useBuiltIns":true}},{"key":"base$0$4","visitor":{"_exploded":true,"_verified":true},"options":{}},{"key":"base$0$5","visitor":{"_exploded":{},"_verified":{},"VariableDeclarator":{"enter":[null]},"ExportNamedDeclaration":{"enter":[null]},"CatchClause":{"enter":[null]},"AssignmentExpression":{"enter":[null]},"ObjectExpression":{"enter":[null]},"FunctionDeclaration":{"enter":[null]},"FunctionExpression":{"enter":[null]},"ObjectMethod":{"enter":[null]},"ArrowFunctionExpression":{"enter":[null]},"ClassMethod":{"enter":[null]},"ForInStatement":{"enter":[null]},"ForOfStatement":{"enter":[null]}},"options":{}},{"key":"transform-meteor-async-await","visitor":{"AwaitExpression":{"enter":[null]},"_exploded":true,"_verified":true,"FunctionDeclaration":{"exit":[null]},"FunctionExpression":{"exit":[null]},"ObjectMethod":{"exit":[null]},"ArrowFunctionExpression":{"exit":[null]},"ClassMethod":{"exit":[null]}},"options":{"useNativeAsyncAwait":false}},{"key":"transform-meteor-dynamic-import","visitor":{"_exploded":{},"_verified":{},"CallExpression":{"enter":[null]}},"options":{}},{"key":"base$0$8","visitor":{"_exploded":{},"_verified":{},"Program":{"enter":[null]}},"options":{}},{"key":"base$0$9","visitor":{"Program":{"exit":[null]},"_exploded":true,"_verified":true},"options":{"allowTopLevelThis":true,"strictMode":false,"loose":true}},{"key":"base$0$10","visitor":{"_exploded":{},"_verified":{},"PrivateName":{"enter":[null]},"ClassDeclaration":{"enter":[null]},"ClassExpression":{"enter":[null]}},"options":{"loose":true}}],"compact":false,"sourceMaps":true,"ast":true,"babelrc":false,"configFile":false,"parserOpts":{"sourceType":"module","sourceFileName":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\imports\\api\\type_readings\\server\\publications.js","plugins":["*","flow","jsx","asyncGenerators","bigInt","classPrivateMethods","classPrivateProperties","classProperties","doExpressions","dynamicImport","exportDefaultFrom","exportExtensions","exportNamespaceFrom","functionBind","functionSent","importMeta","nullishCoalescingOperator","numericSeparator","objectRestSpread","optionalCatchBinding","optionalChaining","pipelineOperator","throwExpressions","jsx",["flow",{}],["flow",{}],"objectRestSpread","objectRestSpread","dynamicImport","asyncGenerators","classProperties","classPrivateProperties"],"allowImportExportEverywhere":true,"allowReturnOutsideFunction":true,"strictMode":false},"sourceFileName":"imports/api/type_readings/server/publications.js","filename":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\imports\\api\\type_readings\\server\\publications.js","passPerPreset":false,"envName":"development","cwd":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan","root":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan","presets":[],"generatorOpts":{"filename":"C:\\Users\\wayne\\src\\kwaiette\\tmp\\padawan\\imports\\api\\type_readings\\server\\publications.js","comments":true,"compact":false,"sourceMaps":true,"sourceFileName":"imports/api/type_readings/server/publications.js"}},"code":"let Meteor;\nmodule.watch(require(\"meteor/meteor\"), {\n  Meteor(v) {\n    Meteor = v;\n  }\n\n}, 0);\nlet TypeReading, ReadingRange;\nmodule.watch(require(\"../type_readings.js\"), {\n  TypeReading(v) {\n    TypeReading = v;\n  },\n\n  ReadingRange(v) {\n    ReadingRange = v;\n  }\n\n}, 1);\nlet User, MyersBriggs, Answer, UserType, Profile;\nmodule.watch(require(\"../../users/users.js\"), {\n  User(v) {\n    User = v;\n  },\n\n  MyersBriggs(v) {\n    MyersBriggs = v;\n  },\n\n  Answer(v) {\n    Answer = v;\n  },\n\n  UserType(v) {\n    UserType = v;\n  },\n\n  Profile(v) {\n    Profile = v;\n  }\n\n}, 2);\nlet MyersBriggsCategory;\nmodule.watch(require(\"../../questions/questions.js\"), {\n  MyersBriggsCategory(v) {\n    MyersBriggsCategory = v;\n  }\n\n}, 3);\nMeteor.publishComposite('typereadings.getAll', function () {\n  if (!Roles.userIsInRole(this.userId, ['admin'], Roles.GLOBAL_GROUP)) {\n    return this.ready();\n  }\n\n  var qry = {};\n  console.log(\"Publication 'typereadings.getAll': \", this.userId, qry);\n  return {\n    find() {\n      return TypeReading.find(qry, {\n        defaults: true,\n        sort: {\n          \"TypeReadingCategories.Range.low\": 1,\n          \"TypeReadingCategories.Range.Delta\": -1\n        }\n      });\n    },\n\n    children: [{\n      find(typereading) {\n        return User.find({\n          _id: typereading.CreatedBy\n        }, {\n          limit: 1\n        });\n      }\n\n    }]\n  };\n});\nMeteor.publishComposite('typereadings.byCategory', function (category) {\n  if (!Roles.userIsInRole(this.userId, ['admin'], Roles.GLOBAL_GROUP)) {\n    return this.ready();\n  }\n\n  var qry = {};\n  qry[\"TypeReadingCategories.\" + category + \".Range.low\"] = {\n    $gte: -100\n  };\n  console.log(\"Publication 'typereadings.byCategory': \", category, this.userId, qry);\n  return {\n    find() {\n      return TypeReading.find(qry, {\n        defaults: true,\n        sort: {\n          \"TypeReadingCategories.Range.low\": 1,\n          \"TypeReadingCategories.Range.Delta\": -1\n        }\n      });\n    },\n\n    children: [{\n      find(typereading) {\n        return User.find({\n          _id: typereading.CreatedBy\n        }, {\n          limit: 1\n        });\n      }\n\n    }]\n  };\n});\nMeteor.publish('typereadings.myReadings', function (userId, refresh) {\n  //console.log(userId, this.userId);\n  //if(this.userId !== userId && !Roles.userIsInRole(this.userId, ['admin'], Roles.GLOBAL_GROUP)) { return this.ready(); }\n  if (typeof userId === \"undefined\") {\n    return this.ready();\n  }\n\n  console.log(\"Publication 'typereadings.myReadings': \", this.userId, userId);\n  let self = this;\n  let user = User.findOne({\n    _id: userId\n  });\n\n  if (!user) {\n    return;\n  } //console.log(self, user);\n\n\n  let observe = {\n    added: function (id, fields) {\n      self.added('type_readings', id, fields);\n    },\n    changed: function (id, fields) {\n      self.removed(\"type_readings\", id);\n    },\n    removed: function (id) {\n      self.removed('type_readings', id);\n    }\n  };\n  let userType = user.MyProfile.UserType.Personality;\n  let handle = TypeReading.find({\n    $and: [{\n      $or: [{\n        $or: [{\n          \"TypeReadingCategories.0\": {\n            $type: 10\n          }\n        }, {\n          \"TypeReadingCategories.0\": {\n            $exists: false\n          }\n        }]\n      }, {\n        $and: [{\n          'TypeReadingCategories.0.Range.low': {\n            $lte: userType['IE'].Value\n          }\n        }, {\n          'TypeReadingCategories.0.Range.high': {\n            $gte: userType['IE'].Value\n          }\n        }]\n      }]\n    }, {\n      $or: [{\n        $or: [{\n          \"TypeReadingCategories.1\": {\n            $type: 10\n          }\n        }, {\n          \"TypeReadingCategories.1\": {\n            $exists: false\n          }\n        }]\n      }, {\n        $and: [{\n          'TypeReadingCategories.1.Range.low': {\n            $lte: userType['NS'].Value\n          }\n        }, {\n          'TypeReadingCategories.1.Range.high': {\n            $gte: userType['NS'].Value\n          }\n        }]\n      }]\n    }, {\n      $or: [{\n        $or: [{\n          \"TypeReadingCategories.2\": {\n            $type: 10\n          }\n        }, {\n          \"TypeReadingCategories.2\": {\n            $exists: false\n          }\n        }]\n      }, {\n        $and: [{\n          'TypeReadingCategories.2.Range.low': {\n            $lte: userType['TF'].Value\n          }\n        }, {\n          'TypeReadingCategories.2.Range.high': {\n            $gte: userType['TF'].Value\n          }\n        }]\n      }]\n    }, {\n      $or: [{\n        $or: [{\n          \"TypeReadingCategories.3\": {\n            $type: 10\n          }\n        }, {\n          \"TypeReadingCategories.3\": {\n            $exists: false\n          }\n        }]\n      }, {\n        $and: [{\n          'TypeReadingCategories.3.Range.low': {\n            $lte: userType['JP'].Value\n          }\n        }, {\n          'TypeReadingCategories.3.Range.high': {\n            $gte: userType['JP'].Value\n          }\n        }]\n      }]\n    }, {\n      'Categories.Categories': {\n        $elemMatch: {\n          $in: user.MyProfile.Categories.Categories\n        }\n      }\n    }, {\n      'Enabled': true\n    }]\n  }, {\n    defaults: true,\n    sort: {\n      'TypeReadingCategories.MyersBriggsCategory': 1,\n      'TypeReadingCategories.Range.Delta': -1\n    }\n  }).observeChanges(observe);\n  self.ready();\n  self.onStop(function () {\n    handle.stop();\n  });\n});","map":{"version":3,"sources":["imports/api/type_readings/server/publications.js"],"names":["Meteor","module","watch","require","v","TypeReading","ReadingRange","User","MyersBriggs","Answer","UserType","Profile","MyersBriggsCategory","publishComposite","Roles","userIsInRole","userId","GLOBAL_GROUP","ready","qry","console","log","find","defaults","sort","children","typereading","_id","CreatedBy","limit","category","$gte","publish","refresh","self","user","findOne","observe","added","id","fields","changed","removed","userType","MyProfile","Personality","handle","$and","$or","$type","$exists","$lte","Value","$elemMatch","$in","Categories","observeChanges","onStop","stop"],"mappings":"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","sourcesContent":["// All type-reading-related publications\n\nimport { Meteor } from 'meteor/meteor';\nimport { TypeReading, ReadingRange } from '../type_readings.js';\nimport { User, MyersBriggs, Answer, UserType, Profile } from '../../users/users.js';\nimport { MyersBriggsCategory } from \"../../questions/questions.js\";\nMeteor.publishComposite('typereadings.getAll', function () {\n    if(!Roles.userIsInRole(this.userId, ['admin'], Roles.GLOBAL_GROUP)) { return this.ready(); }\n    var qry = {};\n    console.log(\"Publication 'typereadings.getAll': \", this.userId, qry);\n    return {\n        find() {\n            return TypeReading.find(qry, {\n                defaults: true,\n                sort: { \"TypeReadingCategories.Range.low\":1, \"TypeReadingCategories.Range.Delta\": -1 }\n            });\n        },\n        children: [{\n            find(typereading) {\n                return User.find({ _id: typereading.CreatedBy }, { limit: 1 });\n            }\n        }]\n    };\n});\nMeteor.publishComposite('typereadings.byCategory', function (category) {\n    if(!Roles.userIsInRole(this.userId, ['admin'], Roles.GLOBAL_GROUP)) { return this.ready(); }\n    var qry = {};\n    qry[\"TypeReadingCategories.\"+category+\".Range.low\"] = { $gte: -100 };\n    console.log(\"Publication 'typereadings.byCategory': \", category, this.userId, qry);\n    return {\n        find() {\n            return TypeReading.find(qry, {\n                defaults: true,\n                sort: { \"TypeReadingCategories.Range.low\":1,\"TypeReadingCategories.Range.Delta\": -1 }\n            });\n        },\n        children: [{\n            find(typereading) {\n                return User.find({ _id: typereading.CreatedBy }, { limit: 1 });\n            }\n        }]\n    };\n});\nMeteor.publish('typereadings.myReadings', function (userId, refresh) {\n    //console.log(userId, this.userId);\n    //if(this.userId !== userId && !Roles.userIsInRole(this.userId, ['admin'], Roles.GLOBAL_GROUP)) { return this.ready(); }\n    if (typeof userId === \"undefined\") {\n        return this.ready();\n    }\n    console.log(\"Publication 'typereadings.myReadings': \", this.userId, userId);\n    let self = this;\n    let user = User.findOne({_id:userId});\n\n    if (!user) {\n        return;\n    }\n    //console.log(self, user);\n    let observe = {\n        added: function(id, fields) {\n            self.added('type_readings', id, fields);\n        },\n        changed: function(id, fields) {\n            self.removed(\"type_readings\", id);\n        },\n        removed: function(id) {\n            self.removed('type_readings', id);\n        }\n    };\n    let userType = user.MyProfile.UserType.Personality;\n    let handle = TypeReading.find({\n        $and : [\n            { $or: [\n                { $or : [ { \"TypeReadingCategories.0\": { $type: 10 } }, { \"TypeReadingCategories.0\" : {$exists: false}} ] },\n                { $and : [\n                    { 'TypeReadingCategories.0.Range.low' : { $lte: userType['IE'].Value }},\n                    { 'TypeReadingCategories.0.Range.high' : { $gte: userType['IE'].Value }}\n                ]}\n            ]},\n            { $or: [\n                { $or : [ { \"TypeReadingCategories.1\": { $type: 10 } }, { \"TypeReadingCategories.1\" : {$exists: false}} ] },\n                { $and : [\n                    { 'TypeReadingCategories.1.Range.low' : { $lte: userType['NS'].Value }},\n                    { 'TypeReadingCategories.1.Range.high' : { $gte: userType['NS'].Value }}\n                ]}\n            ]},\n            { $or: [\n                { $or : [ { \"TypeReadingCategories.2\": { $type: 10 } }, { \"TypeReadingCategories.2\" : {$exists: false}} ] },\n                { $and : [\n                    { 'TypeReadingCategories.2.Range.low' : { $lte: userType['TF'].Value }},\n                    { 'TypeReadingCategories.2.Range.high' : { $gte: userType['TF'].Value }}\n                ]}\n            ]},\n            { $or: [\n                { $or : [ { \"TypeReadingCategories.3\": { $type: 10 } }, { \"TypeReadingCategories.3\" : {$exists: false}} ] },\n                { $and : [\n                    { 'TypeReadingCategories.3.Range.low' : { $lte: userType['JP'].Value }},\n                    { 'TypeReadingCategories.3.Range.high' : { $gte: userType['JP'].Value }}\n                ]}\n            ]},\n            { 'Categories.Categories': { $elemMatch: { $in: user.MyProfile.Categories.Categories } } },\n            { 'Enabled': true }\n        ]\n    },{\n        defaults: true,\n        sort: { 'TypeReadingCategories.MyersBriggsCategory':1, 'TypeReadingCategories.Range.Delta': -1 }\n    }).observeChanges(observe);\n\n    self.ready();\n    self.onStop(function() {\n        handle.stop();\n    });\n});\n"]},"sourceType":"script","hash":"fe09c5c4f9df0d3dec52ecce7c6f266ac418abc1"}
